export const drawRotated = (src, srcCx, srcCy, dest, destCx, destCy, radians) => {
    const srcData = src.data;
    const destData = dest.data;
    const srcWidth = src.width;
    const srcHeight = src.height;
    const destWidth = dest.width;
    const destHeight = dest.height;
    const cos = Math.cos(radians);
    const sin = Math.sin(radians);
    const [minX, minY, maxX, maxY] = computeRotatedBoundingBox(srcWidth, srcHeight, srcCx, srcCy, destCx, destCy, radians, destWidth, destHeight);
    for (let dy = minY; dy < maxY; dy++) {
        for (let dx = minX; dx < maxX; dx++) {
            const x = dx - destCx;
            const y = dy - destCy;
            const sxFloat = x * cos + y * sin + srcCx;
            const syFloat = -x * sin + y * cos + srcCy;
            const sx = Math.round(sxFloat);
            const sy = Math.round(syFloat);
            if (sx >= 0 && sx < srcWidth && sy >= 0 && sy < srcHeight) {
                const srcIndex = (sy * srcWidth + sx) * 4;
                const destIndex = (dy * destWidth + dx) * 4;
                destData[destIndex + 0] = srcData[srcIndex + 0];
                destData[destIndex + 1] = srcData[srcIndex + 1];
                destData[destIndex + 2] = srcData[srcIndex + 2];
                destData[destIndex + 3] = srcData[srcIndex + 3];
            }
        }
    }
    return dest;
};
export const computeRotatedBoundingBox = (srcWidth, srcHeight, srcCx, srcCy, destCx, destCy, radians, destWidth, destHeight) => {
    const cos = Math.cos(radians);
    const sin = Math.sin(radians);
    const corners = [
        [0, 0],
        [srcWidth, 0],
        [srcWidth, srcHeight],
        [0, srcHeight]
    ];
    let minX = Infinity;
    let minY = Infinity;
    let maxX = -Infinity;
    let maxY = -Infinity;
    for (const corner of corners) {
        const lx = corner[0] - srcCx;
        const ly = corner[1] - srcCy;
        const rx = lx * cos - ly * sin;
        const ry = lx * sin + ly * cos;
        const dx = rx + destCx;
        const dy = ry + destCy;
        if (dx < minX)
            minX = dx;
        if (dx > maxX)
            maxX = dx;
        if (dy < minY)
            minY = dy;
        if (dy > maxY)
            maxY = dy;
    }
    let intMinX = Math.floor(minX);
    let intMinY = Math.floor(minY);
    let intMaxX = Math.ceil(maxX);
    let intMaxY = Math.ceil(maxY);
    intMinX = Math.max(0, Math.min(intMinX, destWidth - 1));
    intMinY = Math.max(0, Math.min(intMinY, destHeight - 1));
    intMaxX = Math.max(0, Math.min(intMaxX, destWidth));
    intMaxY = Math.max(0, Math.min(intMaxY, destHeight));
    return [intMinX, intMinY, intMaxX, intMaxY];
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm90YXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9pbWFnZS9yb3RhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLENBQ3pCLEdBQWMsRUFBRSxLQUFhLEVBQUUsS0FBYSxFQUM1QyxJQUFlLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFDL0MsT0FBZSxFQUNmLEVBQUU7SUFDRixNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFBO0lBQ3hCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7SUFFMUIsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQTtJQUMxQixNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFBO0lBQzVCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7SUFDNUIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQTtJQUU5QixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQzdCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUE7SUFFN0IsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLHlCQUF5QixDQUN4RCxRQUFRLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQzFELFNBQVMsRUFBRSxVQUFVLENBQ3RCLENBQUE7SUFFRCxLQUFLLElBQUksRUFBRSxHQUFHLElBQUksRUFBRSxFQUFFLEdBQUcsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDcEMsS0FBSyxJQUFJLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxHQUFHLElBQUksRUFBRSxFQUFF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QUFHLEVBQUUsR0FBRyxNQUFNLENBQUE7UUFDdEIsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLE1BQU0sQ0FBQTtRQUV0QixJQUFJLEVBQUUsR0FBRyxJQUFJO1lBQUUsSUFBSSxHQUFHLEVBQUUsQ0FBQTtRQUN4QixJQUFJLEVBQUUsR0FBRyxJQUFJO1lBQUUsSUFBSSxHQUFHLEVBQUUsQ0FBQTtRQUN4QixJQUFJLEVBQUUsR0FBRyxJQUFJO1lBQUUsSUFBSSxHQUFHLEVBQUUsQ0FBQTtRQUN4QixJQUFJLEVBQUUsR0FBRyxJQUFJO1lBQUUsSUFBSSxHQUFHLEVBQUUsQ0FBQTtJQUMxQixDQUFDO0lBRUQsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUM5QixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQzlCLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDN0IsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUU3QixPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsU0FBUyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDdkQsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ3hELE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFBO0lBQ25ELE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFBO0lBRXBELE9BQU8sQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQTtBQUM3QyxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgZHJhd1JvdGF0ZWQgPSAoXHJcbiAgc3JjOiBJbWFnZURhdGEsIHNyY0N4OiBudW1iZXIsIHNyY0N5OiBudW1iZXIsXHJcbiAgZGVzdDogSW1hZ2VEYXRhLCBkZXN0Q3g6IG51bWJlciwgZGVzdEN5OiBudW1iZXIsXHJcbiAgcmFkaWFuczogbnVtYmVyXHJcbikgPT4ge1xyXG4gIGNvbnN0IHNyY0RhdGEgPSBzcmMuZGF0YVxyXG4gIGNvbnN0IGRlc3REYXRhID0gZGVzdC5kYXRhXHJcblxyXG4gIGNvbnN0IHNyY1dpZHRoID0gc3JjLndpZHRoXHJcbiAgY29uc3Qgc3JjSGVpZ2h0ID0gc3JjLmhlaWdodFxyXG4gIGNvbnN0IGRlc3RXaWR0aCA9IGRlc3Qud2lkdGhcclxuICBjb25zdCBkZXN0SGVpZ2h0ID0gZGVzdC5oZWlnaHRcclxuXHJcbiAgY29uc3QgY29zID0gTWF0aC5jb3MocmFkaWFucylcclxuICBjb25zdCBzaW4gPSBNYXRoLnNpbihyYWRpYW5zKVxyXG5cclxuICBjb25zdCBbbWluWCwgbWluWSwgbWF4WCwgbWF4WV0gPSBjb21wdXRlUm90YXRlZEJvdW5kaW5nQm94KFxyXG4gICAgc3JjV2lkdGgsIHNyY0hlaWdodCwgc3JjQ3gsIHNyY0N5LCBkZXN0Q3gsIGRlc3RDeSwgcmFkaWFucyxcclxuICAgIGRlc3RXaWR0aCwgZGVzdEhlaWdodFxyXG4gIClcclxuXHJcbiAgZm9yIChsZXQgZHkgPSBtaW5ZOyBkeSA8IG1heFk7IGR5KyspIHtcclxuICAgIGZvciAobGV0IGR4ID0gbWluWDsgZHggPCBtYXhYOyBkeCsrKSB7XHJcbiAgICAgIGNvbnN0IHggPSBkeCAtIGRlc3RDeFxyXG4gICAgICBjb25zdCB5ID0gZHkgLSBkZXN0Q3lcclxuXHJcbiAgICAgIGNvbnN0IHN4RmxvYXQgPSB4ICogY29zICsgeSAqIHNpbiArIHNyY0N4XHJcbiAgICAgIGNvbnN0IHN5RmxvYXQgPSAteCAqIHNpbiArIHkgKiBjb3MgKyBzcmNDeVxyXG5cclxuICAgICAgY29uc3Qgc3ggPSBNYXRoLnJvdW5kKHN4RmxvYXQpXHJcbiAgICAgIGNvbnN0IHN5ID0gTWF0aC5yb3VuZChzeUZsb2F0KVxyXG5cclxuICAgICAgaWYgKHN4ID49IDAgJiYgc3ggPCBzcmNXaWR0aCAmJiBzeSA+PSAwICYmIHN5IDwgc3JjSGVpZ2h0KSB7XHJcbiAgICAgICAgY29uc3Qgc3JjSW5kZXggPSAoc3kgKiBzcmNXaWR0aCArIHN4KSAqIDRcclxuICAgICAgICBjb25zdCBkZXN0SW5kZXggPSAoZHkgKiBkZXN0V2lkdGggKyBkeCkgKiA0XHJcblxyXG4gICAgICAgIGRlc3REYXRhW2Rlc3RJbmRleCArIDBdID0gc3JjRGF0YVtzcmNJbmRleCArIDBdXHJcbiAgICAgICAgZGVzdERhdGFbZGVzdEluZGV4ICsgMV0gPSBzcmNEYXRhW3NyY0luZGV4ICsgMV1cclxuICAgICAgICBkZXN0RGF0YVtkZXN0SW5kZXggKyAyXSA9IHNyY0RhdGFbc3JjSW5kZXggKyAyXVxyXG4gICAgICAgIGRlc3REYXRhW2Rlc3RJbmRleCArIDNdID0gc3JjRGF0YVtzcmNJbmRleCArIDNdXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBkZXN0XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBjb21wdXRlUm90YXRlZEJvdW5kaW5nQm94ID0gKFxyXG4gIHNyY1dpZHRoOiBudW1iZXIsXHJcbiAgc3JjSGVpZ2h0OiBudW1iZXIsXHJcbiAgc3JjQ3g6IG51bWJlcixcclxuICBzcmNDeTogbnVtYmVyLFxyXG4gIGRlc3RDeDogbnVtYmVyLFxyXG4gIGRlc3RDeTogbnVtYmVyLFxyXG4gIHJhZGlhbnM6IG51bWJlcixcclxuICBkZXN0V2lkdGg6IG51bWJlcixcclxuICBkZXN0SGVpZ2h0OiBudW1iZXJcclxuKSA9PiB7XHJcbiAgY29uc3QgY29zID0gTWF0aC5jb3MocmFkaWFucylcclxuICBjb25zdCBzaW4gPSBNYXRoLnNpbihyYWRpYW5zKVxyXG5cclxuICBjb25zdCBjb3JuZXJzID0gW1xyXG4gICAgWzAsIDBdLFxyXG4gICAgW3NyY1dpZHRoLCAwXSxcclxuICAgIFtzcmNXaWR0aCwgc3JjSGVpZ2h0XSxcclxuICAgIFswLCBzcmNIZWlnaHRdXHJcbiAgXVxyXG5cclxuICBsZXQgbWluWCA9IEluZmluaXR5XHJcbiAgbGV0IG1pblkgPSBJbmZpbml0eVxyXG4gIGxldCBtYXhYID0gLUluZmluaXR5XHJcbiAgbGV0IG1heFkgPSAtSW5maW5pdHlcclxuXHJcbiAgZm9yIChjb25zdCBjb3JuZXIgb2YgY29ybmVycykge1xyXG4gICAgY29uc3QgbHggPSBjb3JuZXJbMF0gLSBzcmNDeFxyXG4gICAgY29uc3QgbHkgPSBjb3JuZXJbMV0gLSBzcmNDeVxyXG5cclxuICAgIGNvbnN0IHJ4ID0gbHggKiBjb3MgLSBseSAqIHNpblxyXG4gICAgY29uc3QgcnkgPSBseCAqIHNpbiArIGx5ICogY29zXHJcblxyXG4gICAgY29uc3QgZHggPSByeCArIGRlc3RDeFxyXG4gICAgY29uc3QgZHkgPSByeSArIGRlc3RDeVxyXG5cclxuICAgIGlmIChkeCA8IG1pblgpIG1pblggPSBkeFxyXG4gICAgaWYgKGR4ID4gbWF4WCkgbWF4WCA9IGR4XHJcbiAgICBpZiAoZHkgPCBtaW5ZKSBtaW5ZID0gZHlcclxuICAgIGlmIChkeSA+IG1heFkpIG1heFkgPSBkeVxyXG4gIH1cclxuXHJcbiAgbGV0IGludE1pblggPSBNYXRoLmZsb29yKG1pblgpXHJcbiAgbGV0IGludE1pblkgPSBNYXRoLmZsb29yKG1pblkpXHJcbiAgbGV0IGludE1heFggPSBNYXRoLmNlaWwobWF4WClcclxuICBsZXQgaW50TWF4WSA9IE1hdGguY2VpbChtYXhZKVxyXG5cclxuICBpbnRNaW5YID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oaW50TWluWCwgZGVzdFdpZHRoIC0gMSkpXHJcbiAgaW50TWluWSA9IE1hdGgubWF4KDAsIE1hdGgubWluKGludE1pblksIGRlc3RIZWlnaHQgLSAxKSlcclxuICBpbnRNYXhYID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oaW50TWF4WCwgZGVzdFdpZHRoKSlcclxuICBpbnRNYXhZID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oaW50TWF4WSwgZGVzdEhlaWdodCkpXHJcblxyXG4gIHJldHVybiBbaW50TWluWCwgaW50TWluWSwgaW50TWF4WCwgaW50TWF4WV1cclxufVxyXG4iXX0=