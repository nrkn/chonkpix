export const drawRotated = (src, srcCx, srcCy, dest, destCx, destCy, radians) => {
    const srcData = src.data;
    const destData = dest.data;
    const srcWidth = src.width;
    const srcHeight = src.height;
    const destWidth = dest.width;
    const destHeight = dest.height;
    const cos = Math.cos(radians);
    const sin = Math.sin(radians);
    const [minX, minY, maxX, maxY] = computeRotatedBoundingBox(srcWidth, srcHeight, srcCx, srcCy, destCx, destCy, radians, destWidth, destHeight);
    for (let dy = minY; dy < maxY; dy++) {
        for (let dx = minX; dx < maxX; dx++) {
            const x = dx - destCx;
            const y = dy - destCy;
            const sxFloat = x * cos + y * sin + srcCx;
            const syFloat = -x * sin + y * cos + srcCy;
            const sx = Math.round(sxFloat);
            const sy = Math.round(syFloat);
            if (sx >= 0 && sx < srcWidth && sy >= 0 && sy < srcHeight) {
                const srcIndex = (sy * srcWidth + sx) * 4;
                const destIndex = (dy * destWidth + dx) * 4;
                destData[destIndex + 0] = srcData[srcIndex + 0];
                destData[destIndex + 1] = srcData[srcIndex + 1];
                destData[destIndex + 2] = srcData[srcIndex + 2];
                destData[destIndex + 3] = srcData[srcIndex + 3];
            }
        }
    }
    return dest;
};
export const drawRotatedAndPointScaled = (src, srcCx, srcCy, dest, destCx, destCy, radians, srcScale = 1) => {
    const srcWidth = src.width;
    const srcHeight = src.height;
    const destWidth = dest.width;
    const destHeight = dest.height;
    const cos = Math.cos(radians);
    const sin = Math.sin(radians);
    const [minX, minY, maxX, maxY] = computeRotatedBoundingBox(srcWidth, srcHeight, srcCx, srcCy, destCx, destCy, radians, destWidth, destHeight);
    for (let dy = minY; dy < maxY; dy++) {
        for (let dx = minX; dx < maxX; dx++) {
            const x = dx - destCx;
            const y = dy - destCy;
            const scaledX = (x / srcScale);
            const scaledY = (y / srcScale);
            const sxFloat = scaledX * cos + scaledY * sin + srcCx;
            const syFloat = -scaledX * sin + scaledY * cos + srcCy;
            const sx = Math.round(sxFloat);
            const sy = Math.round(syFloat);
            if (sx >= 0 && sx < srcWidth && sy >= 0 && sy < srcHeight) {
                const srcIndex = (sy * srcWidth + sx) * 4;
                const destIndex = (dy * destWidth + dx) * 4;
                dest.data[destIndex + 0] = src.data[srcIndex + 0];
                dest.data[destIndex + 1] = src.data[srcIndex + 1];
                dest.data[destIndex + 2] = src.data[srcIndex + 2];
                dest.data[destIndex + 3] = src.data[srcIndex + 3];
            }
        }
    }
    return dest;
};
export const computeRotatedBoundingBox = (srcWidth, srcHeight, srcCx, srcCy, destCx, destCy, radians, destWidth, destHeight) => {
    const cos = Math.cos(radians);
    const sin = Math.sin(radians);
    const corners = [
        [0, 0],
        [srcWidth, 0],
        [srcWidth, srcHeight],
        [0, srcHeight]
    ];
    let minX = Infinity;
    let minY = Infinity;
    let maxX = -Infinity;
    let maxY = -Infinity;
    for (const corner of corners) {
        const lx = corner[0] - srcCx;
        const ly = corner[1] - srcCy;
        const rx = lx * cos - ly * sin;
        const ry = lx * sin + ly * cos;
        const dx = rx + destCx;
        const dy = ry + destCy;
        if (dx < minX)
            minX = dx;
        if (dx > maxX)
            maxX = dx;
        if (dy < minY)
            minY = dy;
        if (dy > maxY)
            maxY = dy;
    }
    let intMinX = Math.floor(minX);
    let intMinY = Math.floor(minY);
    let intMaxX = Math.ceil(maxX);
    let intMaxY = Math.ceil(maxY);
    intMinX = Math.max(0, Math.min(intMinX, destWidth - 1));
    intMinY = Math.max(0, Math.min(intMinY, destHeight - 1));
    intMaxX = Math.max(0, Math.min(intMaxX, destWidth));
    intMaxY = Math.max(0, Math.min(intMaxY, destHeight));
    return [intMinX, intMinY, intMaxX, intMaxY];
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm90YXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9pbWFnZS9yb3RhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLENBQ3pCLEdBQWMsRUFBRSxLQUFhLEVBQUUsS0FBYSxFQUM1QyxJQUFlLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFDL0MsT0FBZSxFQUNmLEVBQUU7SUFDRixNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFBO0lBQ3hCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7SUFFMUIsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQTtJQUMxQixNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFBO0lBQzVCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7SUFDNUIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQTtJQUU5QixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQzdCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUE7SUFFN0IsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLHlCQUF5QixDQUN4RCxRQUFRLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQzFELFNBQVMsRUFBRSxVQUFVLENBQ3RCLENBQUE7SUFFRCxLQUFLLElBQUksRUFBRSxHQUFHLElBQUksRUFBRSxFQUFFLEdBQUcsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDcEMsS0FBSyxJQUFJLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxHQUFHLElBQUksRUFBRSxFQUFF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SSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQTtJQUVwRCxPQUFPLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUE7QUFDN0MsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGRyYXdSb3RhdGVkID0gKFxyXG4gIHNyYzogSW1hZ2VEYXRhLCBzcmNDeDogbnVtYmVyLCBzcmNDeTogbnVtYmVyLFxyXG4gIGRlc3Q6IEltYWdlRGF0YSwgZGVzdEN4OiBudW1iZXIsIGRlc3RDeTogbnVtYmVyLFxyXG4gIHJhZGlhbnM6IG51bWJlclxyXG4pID0+IHtcclxuICBjb25zdCBzcmNEYXRhID0gc3JjLmRhdGFcclxuICBjb25zdCBkZXN0RGF0YSA9IGRlc3QuZGF0YVxyXG5cclxuICBjb25zdCBzcmNXaWR0aCA9IHNyYy53aWR0aFxyXG4gIGNvbnN0IHNyY0hlaWdodCA9IHNyYy5oZWlnaHRcclxuICBjb25zdCBkZXN0V2lkdGggPSBkZXN0LndpZHRoXHJcbiAgY29uc3QgZGVzdEhlaWdodCA9IGRlc3QuaGVpZ2h0XHJcblxyXG4gIGNvbnN0IGNvcyA9IE1hdGguY29zKHJhZGlhbnMpXHJcbiAgY29uc3Qgc2luID0gTWF0aC5zaW4ocmFkaWFucylcclxuXHJcbiAgY29uc3QgW21pblgsIG1pblksIG1heFgsIG1heFldID0gY29tcHV0ZVJvdGF0ZWRCb3VuZGluZ0JveChcclxuICAgIHNyY1dpZHRoLCBzcmNIZWlnaHQsIHNyY0N4LCBzcmNDeSwgZGVzdEN4LCBkZXN0Q3ksIHJhZGlhbnMsXHJcbiAgICBkZXN0V2lkdGgsIGRlc3RIZWlnaHRcclxuICApXHJcblxyXG4gIGZvciAobGV0IGR5ID0gbWluWTsgZHkgPCBtYXhZOyBkeSsrKSB7XHJcbiAgICBmb3IgKGxldCBkeCA9IG1pblg7IGR4IDwgbWF4WDsgZHgrKykge1xyXG4gICAgICBjb25zdCB4ID0gZHggLSBkZXN0Q3hcclxuICAgICAgY29uc3QgeSA9IGR5IC0gZGVzdEN5XHJcblxyXG4gICAgICBjb25zdCBzeEZsb2F0ID0geCAqIGNvcyArIHkgKiBzaW4gKyBzcmNDeFxyXG4gICAgICBjb25zdCBzeUZsb2F0ID0gLXggKiBzaW4gKyB5ICogY29zICsgc3JjQ3lcclxuXHJcbiAgICAgIGNvbnN0IHN4ID0gTWF0aC5yb3VuZChzeEZsb2F0KVxyXG4gICAgICBjb25zdCBzeSA9IE1hdGgucm91bmQoc3lGbG9hdClcclxuXHJcbiAgICAgIGlmIChzeCA+PSAwICYmIHN4IDwgc3JjV2lkdGggJiYgc3kgPj0gMCAmJiBzeSA8IHNyY0hlaWdodCkge1xyXG4gICAgICAgIGNvbnN0IHNyY0luZGV4ID0gKHN5ICogc3JjV2lkdGggKyBzeCkgKiA0XHJcbiAgICAgICAgY29uc3QgZGVzdEluZGV4ID0gKGR5ICogZGVzdFdpZHRoICsgZHgpICogNFxyXG5cclxuICAgICAgICBkZXN0RGF0YVtkZXN0SW5kZXggKyAwXSA9IHNyY0RhdGFbc3JjSW5kZXggKyAwXVxyXG4gICAgICAgIGRlc3REYXRhW2Rlc3RJbmRleCArIDFdID0gc3JjRGF0YVtzcmNJbmRleCArIDFdXHJcbiAgICAgICAgZGVzdERhdGFbZGVzdEluZGV4ICsgMl0gPSBzcmNEYXRhW3NyY0luZGV4ICsgMl1cclxuICAgICAgICBkZXN0RGF0YVtkZXN0SW5kZXggKyAzXSA9IHNyY0RhdGFbc3JjSW5kZXggKyAzXVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gZGVzdFxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgZHJhd1JvdGF0ZWRBbmRQb2ludFNjYWxlZCA9IChcclxuICBzcmM6IEltYWdlRGF0YSwgc3JjQ3g6IG51bWJlciwgc3JjQ3k6IG51bWJlcixcclxuICBkZXN0OiBJbWFnZURhdGEsIGRlc3RDeDogbnVtYmVyLCBkZXN0Q3k6IG51bWJlcixcclxuICByYWRpYW5zOiBudW1iZXIsIHNyY1NjYWxlID0gMVxyXG4pID0+IHtcclxuICBjb25zdCBzcmNXaWR0aCA9IHNyYy53aWR0aFxyXG4gIGNvbnN0IHNyY0hlaWdodCA9IHNyYy5oZWlnaHRcclxuICBjb25zdCBkZXN0V2lkdGggPSBkZXN0LndpZHRoXHJcbiAgY29uc3QgZGVzdEhlaWdodCA9IGRlc3QuaGVpZ2h0XHJcblxyXG4gIGNvbnN0IGNvcyA9IE1hdGguY29zKHJhZGlhbnMpXHJcbiAgY29uc3Qgc2luID0gTWF0aC5zaW4ocmFkaWFucylcclxuXHJcbiAgY29uc3QgW21pblgsIG1pblksIG1heFgsIG1heFldID0gY29tcHV0ZVJvdGF0ZWRCb3VuZGluZ0JveChcclxuICAgIHNyY1dpZHRoLCBzcmNIZWlnaHQsIHNyY0N4LCBzcmNDeSwgZGVzdEN4LCBkZXN0Q3ksIHJhZGlhbnMsXHJcbiAgICBkZXN0V2lkdGgsIGRlc3RIZWlnaHRcclxuICApXHJcblxyXG4gIGZvciAobGV0IGR5ID0gbWluWTsgZHkgPCBtYXhZOyBkeSsrKSB7XHJcbiAgICBmb3IgKGxldCBkeCA9IG1pblg7IGR4IDwgbWF4WDsgZHgrKykge1xyXG4gICAgICBjb25zdCB4ID0gZHggLSBkZXN0Q3hcclxuICAgICAgY29uc3QgeSA9IGR5IC0gZGVzdEN5XHJcblxyXG4gICAgICBjb25zdCBzY2FsZWRYID0gKHggLyBzcmNTY2FsZSlcclxuICAgICAgY29uc3Qgc2NhbGVkWSA9ICh5IC8gc3JjU2NhbGUpXHJcblxyXG4gICAgICBjb25zdCBzeEZsb2F0ID0gc2NhbGVkWCAqIGNvcyArIHNjYWxlZFkgKiBzaW4gKyBzcmNDeFxyXG4gICAgICBjb25zdCBzeUZsb2F0ID0gLXNjYWxlZFggKiBzaW4gKyBzY2FsZWRZICogY29zICsgc3JjQ3lcclxuXHJcbiAgICAgIGNvbnN0IHN4ID0gTWF0aC5yb3VuZChzeEZsb2F0KVxyXG4gICAgICBjb25zdCBzeSA9IE1hdGgucm91bmQoc3lGbG9hdClcclxuXHJcbiAgICAgIGlmIChzeCA+PSAwICYmIHN4IDwgc3JjV2lkdGggJiYgc3kgPj0gMCAmJiBzeSA8IHNyY0hlaWdodCkge1xyXG4gICAgICAgIGNvbnN0IHNyY0luZGV4ID0gKHN5ICogc3JjV2lkdGggKyBzeCkgKiA0XHJcbiAgICAgICAgY29uc3QgZGVzdEluZGV4ID0gKGR5ICogZGVzdFdpZHRoICsgZHgpICogNFxyXG5cclxuICAgICAgICBkZXN0LmRhdGFbZGVzdEluZGV4ICsgMF0gPSBzcmMuZGF0YVtzcmNJbmRleCArIDBdXHJcbiAgICAgICAgZGVzdC5kYXRhW2Rlc3RJbmRleCArIDFdID0gc3JjLmRhdGFbc3JjSW5kZXggKyAxXVxyXG4gICAgICAgIGRlc3QuZGF0YVtkZXN0SW5kZXggKyAyXSA9IHNyYy5kYXRhW3NyY0luZGV4ICsgMl1cclxuICAgICAgICBkZXN0LmRhdGFbZGVzdEluZGV4ICsgM10gPSBzcmMuZGF0YVtzcmNJbmRleCArIDNdXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBkZXN0XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBjb21wdXRlUm90YXRlZEJvdW5kaW5nQm94ID0gKFxyXG4gIHNyY1dpZHRoOiBudW1iZXIsXHJcbiAgc3JjSGVpZ2h0OiBudW1iZXIsXHJcbiAgc3JjQ3g6IG51bWJlcixcclxuICBzcmNDeTogbnVtYmVyLFxyXG4gIGRlc3RDeDogbnVtYmVyLFxyXG4gIGRlc3RDeTogbnVtYmVyLFxyXG4gIHJhZGlhbnM6IG51bWJlcixcclxuICBkZXN0V2lkdGg6IG51bWJlcixcclxuICBkZXN0SGVpZ2h0OiBudW1iZXJcclxuKSA9PiB7XHJcbiAgY29uc3QgY29zID0gTWF0aC5jb3MocmFkaWFucylcclxuICBjb25zdCBzaW4gPSBNYXRoLnNpbihyYWRpYW5zKVxyXG5cclxuICBjb25zdCBjb3JuZXJzID0gW1xyXG4gICAgWzAsIDBdLFxyXG4gICAgW3NyY1dpZHRoLCAwXSxcclxuICAgIFtzcmNXaWR0aCwgc3JjSGVpZ2h0XSxcclxuICAgIFswLCBzcmNIZWlnaHRdXHJcbiAgXVxyXG5cclxuICBsZXQgbWluWCA9IEluZmluaXR5XHJcbiAgbGV0IG1pblkgPSBJbmZpbml0eVxyXG4gIGxldCBtYXhYID0gLUluZmluaXR5XHJcbiAgbGV0IG1heFkgPSAtSW5maW5pdHlcclxuXHJcbiAgZm9yIChjb25zdCBjb3JuZXIgb2YgY29ybmVycykge1xyXG4gICAgY29uc3QgbHggPSBjb3JuZXJbMF0gLSBzcmNDeFxyXG4gICAgY29uc3QgbHkgPSBjb3JuZXJbMV0gLSBzcmNDeVxyXG5cclxuICAgIGNvbnN0IHJ4ID0gbHggKiBjb3MgLSBseSAqIHNpblxyXG4gICAgY29uc3QgcnkgPSBseCAqIHNpbiArIGx5ICogY29zXHJcblxyXG4gICAgY29uc3QgZHggPSByeCArIGRlc3RDeFxyXG4gICAgY29uc3QgZHkgPSByeSArIGRlc3RDeVxyXG5cclxuICAgIGlmIChkeCA8IG1pblgpIG1pblggPSBkeFxyXG4gICAgaWYgKGR4ID4gbWF4WCkgbWF4WCA9IGR4XHJcbiAgICBpZiAoZHkgPCBtaW5ZKSBtaW5ZID0gZHlcclxuICAgIGlmIChkeSA+IG1heFkpIG1heFkgPSBkeVxyXG4gIH1cclxuXHJcbiAgbGV0IGludE1pblggPSBNYXRoLmZsb29yKG1pblgpXHJcbiAgbGV0IGludE1pblkgPSBNYXRoLmZsb29yKG1pblkpXHJcbiAgbGV0IGludE1heFggPSBNYXRoLmNlaWwobWF4WClcclxuICBsZXQgaW50TWF4WSA9IE1hdGguY2VpbChtYXhZKVxyXG5cclxuICBpbnRNaW5YID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oaW50TWluWCwgZGVzdFdpZHRoIC0gMSkpXHJcbiAgaW50TWluWSA9IE1hdGgubWF4KDAsIE1hdGgubWluKGludE1pblksIGRlc3RIZWlnaHQgLSAxKSlcclxuICBpbnRNYXhYID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oaW50TWF4WCwgZGVzdFdpZHRoKSlcclxuICBpbnRNYXhZID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oaW50TWF4WSwgZGVzdEhlaWdodCkpXHJcblxyXG4gIHJldHVybiBbaW50TWluWCwgaW50TWluWSwgaW50TWF4WCwgaW50TWF4WV1cclxufVxyXG4iXX0=