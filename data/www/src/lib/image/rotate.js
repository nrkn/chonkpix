export const drawRotated = (src, srcCx, srcCy, dest, destCx, destCy, radians) => {
    const srcData = src.data;
    const destData = dest.data;
    const srcWidth = src.width;
    const srcHeight = src.height;
    const destWidth = dest.width;
    const destHeight = dest.height;
    const cos = Math.cos(radians);
    const sin = Math.sin(radians);
    const [minX, minY, maxX, maxY] = computeRotatedBoundingBox(srcWidth, srcHeight, srcCx, srcCy, destCx, destCy, radians, destWidth, destHeight);
    for (let dy = minY; dy < maxY; dy++) {
        for (let dx = minX; dx < maxX; dx++) {
            const x = dx - destCx;
            const y = dy - destCy;
            const sxFloat = x * cos + y * sin + srcCx;
            const syFloat = -x * sin + y * cos + srcCy;
            const sx = Math.round(sxFloat);
            const sy = Math.round(syFloat);
            if (sx >= 0 && sx < srcWidth && sy >= 0 && sy < srcHeight) {
                const srcIndex = (sy * srcWidth + sx) * 4;
                const destIndex = (dy * destWidth + dx) * 4;
                destData[destIndex + 0] = srcData[srcIndex + 0];
                destData[destIndex + 1] = srcData[srcIndex + 1];
                destData[destIndex + 2] = srcData[srcIndex + 2];
                destData[destIndex + 3] = srcData[srcIndex + 3];
            }
        }
    }
    return dest;
};
export const drawRotatedAndScaled = (src, srcCx, srcCy, dest, destCx, destCy, radians, srcScale = 1) => {
    const srcWidth = src.width;
    const srcHeight = src.height;
    const destWidth = dest.width;
    const destHeight = dest.height;
    const cos = Math.cos(radians);
    const sin = Math.sin(radians);
    const [minX, minY, maxX, maxY] = computeRotatedBoundingBox(srcWidth, srcHeight, srcCx, srcCy, destCx, destCy, radians, destWidth, destHeight);
    for (let dy = minY; dy < maxY; dy++) {
        for (let dx = minX; dx < maxX; dx++) {
            const x = dx - destCx;
            const y = dy - destCy;
            // const sxFloat = x * cos + y * sin + srcCx
            // const syFloat = -x * sin + y * cos + srcCy
            // const sx = Math.round(sxFloat / srcScale)
            // const sy = Math.round(syFloat / srcScale)
            const scaledX = (x / srcScale);
            const scaledY = (y / srcScale);
            const sxFloat = scaledX * cos + scaledY * sin + srcCx;
            const syFloat = -scaledX * sin + scaledY * cos + srcCy;
            const sx = Math.round(sxFloat);
            const sy = Math.round(syFloat);
            if (sx >= 0 && sx < srcWidth && sy >= 0 && sy < srcHeight) {
                const srcIndex = (sy * srcWidth + sx) * 4;
                const destIndex = (dy * destWidth + dx) * 4;
                dest.data[destIndex + 0] = src.data[srcIndex + 0];
                dest.data[destIndex + 1] = src.data[srcIndex + 1];
                dest.data[destIndex + 2] = src.data[srcIndex + 2];
                dest.data[destIndex + 3] = src.data[srcIndex + 3];
            }
        }
    }
    return dest;
};
export const computeRotatedBoundingBox = (srcWidth, srcHeight, srcCx, srcCy, destCx, destCy, radians, destWidth, destHeight) => {
    const cos = Math.cos(radians);
    const sin = Math.sin(radians);
    const corners = [
        [0, 0],
        [srcWidth, 0],
        [srcWidth, srcHeight],
        [0, srcHeight]
    ];
    let minX = Infinity;
    let minY = Infinity;
    let maxX = -Infinity;
    let maxY = -Infinity;
    for (const corner of corners) {
        const lx = corner[0] - srcCx;
        const ly = corner[1] - srcCy;
        const rx = lx * cos - ly * sin;
        const ry = lx * sin + ly * cos;
        const dx = rx + destCx;
        const dy = ry + destCy;
        if (dx < minX)
            minX = dx;
        if (dx > maxX)
            maxX = dx;
        if (dy < minY)
            minY = dy;
        if (dy > maxY)
            maxY = dy;
    }
    let intMinX = Math.floor(minX);
    let intMinY = Math.floor(minY);
    let intMaxX = Math.ceil(maxX);
    let intMaxY = Math.ceil(maxY);
    intMinX = Math.max(0, Math.min(intMinX, destWidth - 1));
    intMinY = Math.max(0, Math.min(intMinY, destHeight - 1));
    intMaxX = Math.max(0, Math.min(intMaxX, destWidth));
    intMaxY = Math.max(0, Math.min(intMaxY, destHeight));
    return [intMinX, intMinY, intMaxX, intMaxY];
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm90YXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9pbWFnZS9yb3RhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLENBQ3pCLEdBQWMsRUFBRSxLQUFhLEVBQUUsS0FBYSxFQUM1QyxJQUFlLEVBQUUsTUFBYyxFQUFFLE1BQWMsRUFDL0MsT0FBZSxFQUNmLEVBQUU7SUFDRixNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFBO0lBQ3hCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUE7SUFFMUIsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQTtJQUMxQixNQUFNLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFBO0lBQzVCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUE7SUFDNUIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQTtJQUU5QixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQzdCLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUE7SUFFN0IsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLHlCQUF5QixDQUN4RCxRQUFRLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQzFELFNBQVMsRUFBRSxVQUFVLENBQ3RCLENBQUE7SUFFRCxLQUFLLElBQUksRUFBRSxHQUFHLElBQUksRUFBRSxFQUFFLEdBQUcsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDcEMsS0FBSyxJQUFJLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxHQUFHLElBQUksRUFBRSxFQUFF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QUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUE7SUFDbkQsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUE7SUFFcEQsT0FBTyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFBO0FBQzdDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBkcmF3Um90YXRlZCA9IChcbiAgc3JjOiBJbWFnZURhdGEsIHNyY0N4OiBudW1iZXIsIHNyY0N5OiBudW1iZXIsXG4gIGRlc3Q6IEltYWdlRGF0YSwgZGVzdEN4OiBudW1iZXIsIGRlc3RDeTogbnVtYmVyLFxuICByYWRpYW5zOiBudW1iZXJcbikgPT4ge1xuICBjb25zdCBzcmNEYXRhID0gc3JjLmRhdGFcbiAgY29uc3QgZGVzdERhdGEgPSBkZXN0LmRhdGFcblxuICBjb25zdCBzcmNXaWR0aCA9IHNyYy53aWR0aFxuICBjb25zdCBzcmNIZWlnaHQgPSBzcmMuaGVpZ2h0XG4gIGNvbnN0IGRlc3RXaWR0aCA9IGRlc3Qud2lkdGhcbiAgY29uc3QgZGVzdEhlaWdodCA9IGRlc3QuaGVpZ2h0XG5cbiAgY29uc3QgY29zID0gTWF0aC5jb3MocmFkaWFucylcbiAgY29uc3Qgc2luID0gTWF0aC5zaW4ocmFkaWFucylcblxuICBjb25zdCBbbWluWCwgbWluWSwgbWF4WCwgbWF4WV0gPSBjb21wdXRlUm90YXRlZEJvdW5kaW5nQm94KFxuICAgIHNyY1dpZHRoLCBzcmNIZWlnaHQsIHNyY0N4LCBzcmNDeSwgZGVzdEN4LCBkZXN0Q3ksIHJhZGlhbnMsXG4gICAgZGVzdFdpZHRoLCBkZXN0SGVpZ2h0XG4gIClcblxuICBmb3IgKGxldCBkeSA9IG1pblk7IGR5IDwgbWF4WTsgZHkrKykge1xuICAgIGZvciAobGV0IGR4ID0gbWluWDsgZHggPCBtYXhYOyBkeCsrKSB7XG4gICAgICBjb25zdCB4ID0gZHggLSBkZXN0Q3hcbiAgICAgIGNvbnN0IHkgPSBkeSAtIGRlc3RDeVxuXG4gICAgICBjb25zdCBzeEZsb2F0ID0geCAqIGNvcyArIHkgKiBzaW4gKyBzcmNDeFxuICAgICAgY29uc3Qgc3lGbG9hdCA9IC14ICogc2luICsgeSAqIGNvcyArIHNyY0N5XG5cbiAgICAgIGNvbnN0IHN4ID0gTWF0aC5yb3VuZChzeEZsb2F0KVxuICAgICAgY29uc3Qgc3kgPSBNYXRoLnJvdW5kKHN5RmxvYXQpXG5cbiAgICAgIGlmIChzeCA+PSAwICYmIHN4IDwgc3JjV2lkdGggJiYgc3kgPj0gMCAmJiBzeSA8IHNyY0hlaWdodCkge1xuICAgICAgICBjb25zdCBzcmNJbmRleCA9IChzeSAqIHNyY1dpZHRoICsgc3gpICogNFxuICAgICAgICBjb25zdCBkZXN0SW5kZXggPSAoZHkgKiBkZXN0V2lkdGggKyBkeCkgKiA0XG5cbiAgICAgICAgZGVzdERhdGFbZGVzdEluZGV4ICsgMF0gPSBzcmNEYXRhW3NyY0luZGV4ICsgMF1cbiAgICAgICAgZGVzdERhdGFbZGVzdEluZGV4ICsgMV0gPSBzcmNEYXRhW3NyY0luZGV4ICsgMV1cbiAgICAgICAgZGVzdERhdGFbZGVzdEluZGV4ICsgMl0gPSBzcmNEYXRhW3NyY0luZGV4ICsgMl1cbiAgICAgICAgZGVzdERhdGFbZGVzdEluZGV4ICsgM10gPSBzcmNEYXRhW3NyY0luZGV4ICsgM11cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gZGVzdFxufVxuXG5leHBvcnQgY29uc3QgZHJhd1JvdGF0ZWRBbmRTY2FsZWQgPSAoXG4gIHNyYzogSW1hZ2VEYXRhLCBzcmNDeDogbnVtYmVyLCBzcmNDeTogbnVtYmVyLFxuICBkZXN0OiBJbWFnZURhdGEsIGRlc3RDeDogbnVtYmVyLCBkZXN0Q3k6IG51bWJlcixcbiAgcmFkaWFuczogbnVtYmVyLCBzcmNTY2FsZSA9IDFcbikgPT4ge1xuICBjb25zdCBzcmNXaWR0aCA9IHNyYy53aWR0aFxuICBjb25zdCBzcmNIZWlnaHQgPSBzcmMuaGVpZ2h0XG4gIGNvbnN0IGRlc3RXaWR0aCA9IGRlc3Qud2lkdGhcbiAgY29uc3QgZGVzdEhlaWdodCA9IGRlc3QuaGVpZ2h0XG5cbiAgY29uc3QgY29zID0gTWF0aC5jb3MocmFkaWFucylcbiAgY29uc3Qgc2luID0gTWF0aC5zaW4ocmFkaWFucylcblxuICBjb25zdCBbbWluWCwgbWluWSwgbWF4WCwgbWF4WV0gPSBjb21wdXRlUm90YXRlZEJvdW5kaW5nQm94KFxuICAgIHNyY1dpZHRoLCBzcmNIZWlnaHQsIHNyY0N4LCBzcmNDeSwgZGVzdEN4LCBkZXN0Q3ksIHJhZGlhbnMsXG4gICAgZGVzdFdpZHRoLCBkZXN0SGVpZ2h0XG4gIClcblxuICBmb3IgKGxldCBkeSA9IG1pblk7IGR5IDwgbWF4WTsgZHkrKykge1xuICAgIGZvciAobGV0IGR4ID0gbWluWDsgZHggPCBtYXhYOyBkeCsrKSB7XG4gICAgICBjb25zdCB4ID0gZHggLSBkZXN0Q3hcbiAgICAgIGNvbnN0IHkgPSBkeSAtIGRlc3RDeVxuXG4gICAgICAvLyBjb25zdCBzeEZsb2F0ID0geCAqIGNvcyArIHkgKiBzaW4gKyBzcmNDeFxuICAgICAgLy8gY29uc3Qgc3lGbG9hdCA9IC14ICogc2luICsgeSAqIGNvcyArIHNyY0N5XG5cbiAgICAgIC8vIGNvbnN0IHN4ID0gTWF0aC5yb3VuZChzeEZsb2F0IC8gc3JjU2NhbGUpXG4gICAgICAvLyBjb25zdCBzeSA9IE1hdGgucm91bmQoc3lGbG9hdCAvIHNyY1NjYWxlKVxuICAgICAgY29uc3Qgc2NhbGVkWCA9ICh4IC8gc3JjU2NhbGUpXG4gICAgICBjb25zdCBzY2FsZWRZID0gKHkgLyBzcmNTY2FsZSlcblxuICAgICAgY29uc3Qgc3hGbG9hdCA9IHNjYWxlZFggKiBjb3MgKyBzY2FsZWRZICogc2luICsgc3JjQ3hcbiAgICAgIGNvbnN0IHN5RmxvYXQgPSAtc2NhbGVkWCAqIHNpbiArIHNjYWxlZFkgKiBjb3MgKyBzcmNDeVxuXG4gICAgICBjb25zdCBzeCA9IE1hdGgucm91bmQoc3hGbG9hdClcbiAgICAgIGNvbnN0IHN5ID0gTWF0aC5yb3VuZChzeUZsb2F0KVxuXG4gICAgICBpZiAoc3ggPj0gMCAmJiBzeCA8IHNyY1dpZHRoICYmIHN5ID49IDAgJiYgc3kgPCBzcmNIZWlnaHQpIHtcbiAgICAgICAgY29uc3Qgc3JjSW5kZXggPSAoc3kgKiBzcmNXaWR0aCArIHN4KSAqIDRcbiAgICAgICAgY29uc3QgZGVzdEluZGV4ID0gKGR5ICogZGVzdFdpZHRoICsgZHgpICogNFxuXG4gICAgICAgIGRlc3QuZGF0YVtkZXN0SW5kZXggKyAwXSA9IHNyYy5kYXRhW3NyY0luZGV4ICsgMF1cbiAgICAgICAgZGVzdC5kYXRhW2Rlc3RJbmRleCArIDFdID0gc3JjLmRhdGFbc3JjSW5kZXggKyAxXVxuICAgICAgICBkZXN0LmRhdGFbZGVzdEluZGV4ICsgMl0gPSBzcmMuZGF0YVtzcmNJbmRleCArIDJdXG4gICAgICAgIGRlc3QuZGF0YVtkZXN0SW5kZXggKyAzXSA9IHNyYy5kYXRhW3NyY0luZGV4ICsgM11cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gZGVzdFxufVxuXG5leHBvcnQgY29uc3QgY29tcHV0ZVJvdGF0ZWRCb3VuZGluZ0JveCA9IChcbiAgc3JjV2lkdGg6IG51bWJlcixcbiAgc3JjSGVpZ2h0OiBudW1iZXIsXG4gIHNyY0N4OiBudW1iZXIsXG4gIHNyY0N5OiBudW1iZXIsXG4gIGRlc3RDeDogbnVtYmVyLFxuICBkZXN0Q3k6IG51bWJlcixcbiAgcmFkaWFuczogbnVtYmVyLFxuICBkZXN0V2lkdGg6IG51bWJlcixcbiAgZGVzdEhlaWdodDogbnVtYmVyXG4pID0+IHtcbiAgY29uc3QgY29zID0gTWF0aC5jb3MocmFkaWFucylcbiAgY29uc3Qgc2luID0gTWF0aC5zaW4ocmFkaWFucylcblxuICBjb25zdCBjb3JuZXJzID0gW1xuICAgIFswLCAwXSxcbiAgICBbc3JjV2lkdGgsIDBdLFxuICAgIFtzcmNXaWR0aCwgc3JjSGVpZ2h0XSxcbiAgICBbMCwgc3JjSGVpZ2h0XVxuICBdXG5cbiAgbGV0IG1pblggPSBJbmZpbml0eVxuICBsZXQgbWluWSA9IEluZmluaXR5XG4gIGxldCBtYXhYID0gLUluZmluaXR5XG4gIGxldCBtYXhZID0gLUluZmluaXR5XG5cbiAgZm9yIChjb25zdCBjb3JuZXIgb2YgY29ybmVycykge1xuICAgIGNvbnN0IGx4ID0gY29ybmVyWzBdIC0gc3JjQ3hcbiAgICBjb25zdCBseSA9IGNvcm5lclsxXSAtIHNyY0N5XG5cbiAgICBjb25zdCByeCA9IGx4ICogY29zIC0gbHkgKiBzaW5cbiAgICBjb25zdCByeSA9IGx4ICogc2luICsgbHkgKiBjb3NcblxuICAgIGNvbnN0IGR4ID0gcnggKyBkZXN0Q3hcbiAgICBjb25zdCBkeSA9IHJ5ICsgZGVzdEN5XG5cbiAgICBpZiAoZHggPCBtaW5YKSBtaW5YID0gZHhcbiAgICBpZiAoZHggPiBtYXhYKSBtYXhYID0gZHhcbiAgICBpZiAoZHkgPCBtaW5ZKSBtaW5ZID0gZHlcbiAgICBpZiAoZHkgPiBtYXhZKSBtYXhZID0gZHlcbiAgfVxuXG4gIGxldCBpbnRNaW5YID0gTWF0aC5mbG9vcihtaW5YKVxuICBsZXQgaW50TWluWSA9IE1hdGguZmxvb3IobWluWSlcbiAgbGV0IGludE1heFggPSBNYXRoLmNlaWwobWF4WClcbiAgbGV0IGludE1heFkgPSBNYXRoLmNlaWwobWF4WSlcblxuICBpbnRNaW5YID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oaW50TWluWCwgZGVzdFdpZHRoIC0gMSkpXG4gIGludE1pblkgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihpbnRNaW5ZLCBkZXN0SGVpZ2h0IC0gMSkpXG4gIGludE1heFggPSBNYXRoLm1heCgwLCBNYXRoLm1pbihpbnRNYXhYLCBkZXN0V2lkdGgpKVxuICBpbnRNYXhZID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oaW50TWF4WSwgZGVzdEhlaWdodCkpXG5cbiAgcmV0dXJuIFtpbnRNaW5YLCBpbnRNaW5ZLCBpbnRNYXhYLCBpbnRNYXhZXVxufVxuIl19