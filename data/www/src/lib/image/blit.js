import { clampRow, clampRows, clampTransfer } from './util.js';
// directly copy pixels from one image to another
export const blit = (src, dest, transfer = [
    0, 0, src.width, src.height, 0, 0
]) => {
    const [sx, sy, sw, sh, dx, dy] = clampTransfer(src.width, src.height, dest.width, dest.height, transfer);
    for (let j = 0; j < sh; j++) {
        const y = j + sy;
        const rowIndex = y * src.width;
        const startIndex = (rowIndex + sx) * 4;
        const endIndex = startIndex + sw * 4;
        const row = src.data.subarray(startIndex, endIndex);
        const destRowIndex = (j + dy) * dest.width * 4;
        const destStartIndex = (destRowIndex + dx * 4);
        dest.data.set(row, destStartIndex);
    }
    return dest;
};
// copies rows from one image to another
// much faster than blit or composite etc when the amount of src to be copied
// is sparse
export const blitRows = (src, srcRows, dest, dx = 0, dy = 0) => {
    srcRows = clampRows(srcRows, src.width, src.height);
    for (let i = 0; i < srcRows.length; i++) {
        const srcRow = srcRows[i];
        const srcW = srcRow[2] - srcRow[1] + 1;
        const destRow = clampRow([srcRow[0] + dy, srcRow[1] + dx, srcRow[2] + dx], dest.width, dest.height);
        if (!destRow)
            continue;
        const destW = destRow[2] - destRow[1] + 1;
        const w = Math.min(srcW, destW);
        const srcIndex = (srcRow[0] * src.width + srcRow[1]) * 4;
        const destIndex = (destRow[0] * dest.width + destRow[1]) * 4;
        const srcPixels = src.data.subarray(srcIndex, srcIndex + w * 4);
        dest.data.set(srcPixels, destIndex);
    }
};
// when the source and dest have the same width, and you want to blit a number 
// of full rows from one to the other, you can do it in a single copy
export const blitFullWidth = (src, dest, sy, sh, dy) => {
    if (src.width !== dest.width) {
        throw Error('Source and destination must have the same width');
    }
    if (sy < 0) {
        sh += sy;
        dy -= sy;
        sy = 0;
    }
    if (sy + sh > src.height) {
        sh = src.height - sy;
    }
    if (dy + sh > dest.height) {
        sh = dest.height - dy;
    }
    const srcIndex = sy * src.width * 4;
    const srcSize = sh * src.width * 4;
    const destIndex = dy * dest.width * 4;
    dest.data.set(src.data.subarray(srcIndex, srcIndex + srcSize), destIndex);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmxpdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvaW1hZ2UvYmxpdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFFOUQsaURBQWlEO0FBQ2pELE1BQU0sQ0FBQyxNQUFNLElBQUksR0FBRyxDQUNsQixHQUFjLEVBQUUsSUFBZSxFQUMvQixXQUFlO0lBQ2IsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUM7Q0FDbEMsRUFDRCxFQUFFO0lBQ0YsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsYUFBYSxDQUM1QyxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FDekQsQ0FBQTtJQUVELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUM1QixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFBO1FBQ2hCLE1BQU0sUUFBUSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFBO1FBRTlCLE1BQU0sVUFBVSxHQUFHLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUN0QyxNQUFNLFFBQVEsR0FBRyxVQUFVLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtRQUVwQyxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLENBQUE7UUFFbkQs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QztJQUVELElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDekIsRUFBRSxHQUFHLEdBQUcsQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFBO0lBQ3RCLENBQUM7SUFFRCxJQUFJLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzFCLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQTtJQUN2QixDQUFDO0lBRUQsTUFBTSxRQUFRLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFBO0lBQ25DLE1BQU0sT0FBTyxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQTtJQUVsQyxNQUFNLFNBQVMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUE7SUFFckMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLFFBQVEsR0FBRyxPQUFPLENBQUMsRUFBRSxTQUFTLENBQUMsQ0FBQTtBQUMzRSxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUNiB9IGZyb20gJy4uL3R5cGVzLmpzJ1xyXG5pbXBvcnQgeyBSb3cgfSBmcm9tICcuL3R5cGVzLmpzJ1xyXG5pbXBvcnQgeyBjbGFtcFJvdywgY2xhbXBSb3dzLCBjbGFtcFRyYW5zZmVyIH0gZnJvbSAnLi91dGlsLmpzJ1xyXG5cclxuLy8gZGlyZWN0bHkgY29weSBwaXhlbHMgZnJvbSBvbmUgaW1hZ2UgdG8gYW5vdGhlclxyXG5leHBvcnQgY29uc3QgYmxpdCA9IChcclxuICBzcmM6IEltYWdlRGF0YSwgZGVzdDogSW1hZ2VEYXRhLFxyXG4gIHRyYW5zZmVyOiBUNiA9IFtcclxuICAgIDAsIDAsIHNyYy53aWR0aCwgc3JjLmhlaWdodCwgMCwgMFxyXG4gIF1cclxuKSA9PiB7XHJcbiAgY29uc3QgW3N4LCBzeSwgc3csIHNoLCBkeCwgZHldID0gY2xhbXBUcmFuc2ZlcihcclxuICAgIHNyYy53aWR0aCwgc3JjLmhlaWdodCwgZGVzdC53aWR0aCwgZGVzdC5oZWlnaHQsIHRyYW5zZmVyXHJcbiAgKVxyXG5cclxuICBmb3IgKGxldCBqID0gMDsgaiA8IHNoOyBqKyspIHtcclxuICAgIGNvbnN0IHkgPSBqICsgc3lcclxuICAgIGNvbnN0IHJvd0luZGV4ID0geSAqIHNyYy53aWR0aFxyXG5cclxuICAgIGNvbnN0IHN0YXJ0SW5kZXggPSAocm93SW5kZXggKyBzeCkgKiA0XHJcbiAgICBjb25zdCBlbmRJbmRleCA9IHN0YXJ0SW5kZXggKyBzdyAqIDRcclxuXHJcbiAgICBjb25zdCByb3cgPSBzcmMuZGF0YS5zdWJhcnJheShzdGFydEluZGV4LCBlbmRJbmRleClcclxuXHJcbiAgICBjb25zdCBkZXN0Um93SW5kZXggPSAoaiArIGR5KSAqIGRlc3Qud2lkdGggKiA0XHJcbiAgICBjb25zdCBkZXN0U3RhcnRJbmRleCA9IChkZXN0Um93SW5kZXggKyBkeCAqIDQpXHJcblxyXG4gICAgZGVzdC5kYXRhLnNldChyb3csIGRlc3RTdGFydEluZGV4KVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGRlc3RcclxufVxyXG5cclxuLy8gY29waWVzIHJvd3MgZnJvbSBvbmUgaW1hZ2UgdG8gYW5vdGhlclxyXG4vLyBtdWNoIGZhc3RlciB0aGFuIGJsaXQgb3IgY29tcG9zaXRlIGV0YyB3aGVuIHRoZSBhbW91bnQgb2Ygc3JjIHRvIGJlIGNvcGllZFxyXG4vLyBpcyBzcGFyc2VcclxuZXhwb3J0IGNvbnN0IGJsaXRSb3dzID0gKFxyXG4gIHNyYzogSW1hZ2VEYXRhLCBzcmNSb3dzOiBSb3c8YW55PltdLCBkZXN0OiBJbWFnZURhdGEsXHJcbiAgZHggPSAwLCBkeSA9IDBcclxuKSA9PiB7XHJcbiAgc3JjUm93cyA9IGNsYW1wUm93cyhzcmNSb3dzLCBzcmMud2lkdGgsIHNyYy5oZWlnaHQpXHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3JjUm93cy5sZW5ndGg7IGkrKykge1xyXG4gICAgY29uc3Qgc3JjUm93ID0gc3JjUm93c1tpXVxyXG4gICAgY29uc3Qgc3JjVyA9IHNyY1Jvd1syXSAtIHNyY1Jvd1sxXSArIDFcclxuXHJcbiAgICBjb25zdCBkZXN0Um93ID0gY2xhbXBSb3coXHJcbiAgICAgIFtzcmNSb3dbMF0gKyBkeSwgc3JjUm93WzFdICsgZHgsIHNyY1Jvd1syXSArIGR4XSwgZGVzdC53aWR0aCwgZGVzdC5oZWlnaHRcclxuICAgIClcclxuXHJcbiAgICBpZiAoIWRlc3RSb3cpIGNvbnRpbnVlXHJcblxyXG4gICAgY29uc3QgZGVzdFcgPSBkZXN0Um93WzJdIC0gZGVzdFJvd1sxXSArIDFcclxuXHJcbiAgICBjb25zdCB3ID0gTWF0aC5taW4oc3JjVywgZGVzdFcpXHJcblxyXG4gICAgY29uc3Qgc3JjSW5kZXggPSAoc3JjUm93WzBdICogc3JjLndpZHRoICsgc3JjUm93WzFdKSAqIDRcclxuICAgIGNvbnN0IGRlc3RJbmRleCA9IChkZXN0Um93WzBdICogZGVzdC53aWR0aCArIGRlc3RSb3dbMV0pICogNFxyXG5cclxuICAgIGNvbnN0IHNyY1BpeGVscyA9IHNyYy5kYXRhLnN1YmFycmF5KHNyY0luZGV4LCBzcmNJbmRleCArIHcgKiA0KVxyXG5cclxuICAgIGRlc3QuZGF0YS5zZXQoc3JjUGl4ZWxzLCBkZXN0SW5kZXgpXHJcbiAgfVxyXG59XHJcblxyXG4vLyB3aGVuIHRoZSBzb3VyY2UgYW5kIGRlc3QgaGF2ZSB0aGUgc2FtZSB3aWR0aCwgYW5kIHlvdSB3YW50IHRvIGJsaXQgYSBudW1iZXIgXHJcbi8vIG9mIGZ1bGwgcm93cyBmcm9tIG9uZSB0byB0aGUgb3RoZXIsIHlvdSBjYW4gZG8gaXQgaW4gYSBzaW5nbGUgY29weVxyXG5leHBvcnQgY29uc3QgYmxpdEZ1bGxXaWR0aCA9IChcclxuICBzcmM6IEltYWdlRGF0YSwgZGVzdDogSW1hZ2VEYXRhLCBzeTogbnVtYmVyLCBzaDogbnVtYmVyLCBkeTogbnVtYmVyXHJcbikgPT4ge1xyXG4gIGlmIChzcmMud2lkdGggIT09IGRlc3Qud2lkdGgpIHtcclxuICAgIHRocm93IEVycm9yKCdTb3VyY2UgYW5kIGRlc3RpbmF0aW9uIG11c3QgaGF2ZSB0aGUgc2FtZSB3aWR0aCcpXHJcbiAgfVxyXG5cclxuICBpZiAoc3kgPCAwKSB7XHJcbiAgICBzaCArPSBzeVxyXG4gICAgZHkgLT0gc3lcclxuICAgIHN5ID0gMFxyXG4gIH1cclxuXHJcbiAgaWYgKHN5ICsgc2ggPiBzcmMuaGVpZ2h0KSB7XHJcbiAgICBzaCA9IHNyYy5oZWlnaHQgLSBzeVxyXG4gIH1cclxuXHJcbiAgaWYgKGR5ICsgc2ggPiBkZXN0LmhlaWdodCkge1xyXG4gICAgc2ggPSBkZXN0LmhlaWdodCAtIGR5XHJcbiAgfVxyXG5cclxuICBjb25zdCBzcmNJbmRleCA9IHN5ICogc3JjLndpZHRoICogNFxyXG4gIGNvbnN0IHNyY1NpemUgPSBzaCAqIHNyYy53aWR0aCAqIDRcclxuXHJcbiAgY29uc3QgZGVzdEluZGV4ID0gZHkgKiBkZXN0LndpZHRoICogNFxyXG5cclxuICBkZXN0LmRhdGEuc2V0KHNyYy5kYXRhLnN1YmFycmF5KHNyY0luZGV4LCBzcmNJbmRleCArIHNyY1NpemUpLCBkZXN0SW5kZXgpXHJcbn0iXX0=