import { clampRect } from './util.js';
export const imageQuery = (imageData, predicate, rect = [0, 0, imageData.width, imageData.height]) => {
    rect = clampRect(imageData.width, imageData.height, rect);
    const [x0, y0, w, h] = rect;
    const x1 = x0 + w;
    const y1 = y0 + h;
    for (let y = y0; y < y1; y++) {
        for (let x = x0; x < x1; x++) {
            const i = (y * imageData.width + x) * 4;
            const r = imageData.data[i];
            const g = imageData.data[i + 1];
            const b = imageData.data[i + 2];
            const a = imageData.data[i + 3];
            if (predicate(r, g, b, a, x, y, i)) {
                return [x, y];
            }
        }
    }
    return null;
};
export const imageQueryAll = (imageData, predicate, rect = [0, 0, imageData.width, imageData.height]) => {
    rect = clampRect(imageData.width, imageData.height, rect);
    const [x0, y0, w, h] = rect;
    const x1 = x0 + w;
    const y1 = y0 + h;
    const pts = [];
    for (let y = y0; y < y1; y++) {
        for (let x = x0; x < x1; x++) {
            const i = (y * imageData.width + x) * 4;
            const r = imageData.data[i];
            const g = imageData.data[i + 1];
            const b = imageData.data[i + 2];
            const a = imageData.data[i + 3];
            if (predicate(r, g, b, a, x, y, i)) {
                pts.push([x, y]);
            }
        }
    }
    return pts;
};
export const rowQuery = (imageData, predicate, rect = [0, 0, imageData.width, imageData.height]) => {
    rect = clampRect(imageData.width, imageData.height, rect);
    const [x0, y0, w, h] = rect;
    const x1 = x0 + w;
    const y1 = y0 + h;
    const rows = [];
    let inRow = false;
    let rowY = 0;
    let rowStart = 0;
    let rowEnd = 0;
    for (let y = y0; y < y1; y++) {
        for (let x = x0; x < x1; x++) {
            const i = (y * imageData.width + x) * 4;
            const r = imageData.data[i];
            const g = imageData.data[i + 1];
            const b = imageData.data[i + 2];
            const a = imageData.data[i + 3];
            if (predicate(r, g, b, a, x, y, i)) {
                if (!inRow) {
                    inRow = true;
                    rowY = y;
                    rowStart = x;
                    rowEnd = x;
                }
                else {
                    rowEnd = x;
                }
            }
            else {
                if (inRow) {
                    rows.push([rowY, rowStart, rowEnd]);
                    inRow = false;
                }
            }
        }
        if (inRow) {
            rows.push([rowY, rowStart, rowEnd]);
            inRow = false;
        }
    }
    return rows;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL2ltYWdlL3F1ZXJ5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFNckMsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLENBQ3hCLFNBQW9CLEVBQUUsU0FBeUIsRUFDL0MsT0FBVyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsU0FBUyxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQ3pDLEVBQUU7SUFDYixJQUFJLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUV6RCxNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFBO0lBRTNCLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDakIsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUVqQixLQUFLLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDN0IsS0FBSyxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ3ZDLE1BQU0sQ0FBQyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDM0IsTUFBTSxDQUFDLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7WUFDL0IsTUFB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QUE7Z0JBQ1osQ0FBQztxQkFBTSxDQUFDO29CQUNOLE1BQU0sR0FBRyxDQUFDLENBQUE7Z0JBQ1osQ0FBQztZQUNILENBQUM7aUJBQU0sQ0FBQztnQkFDTixJQUFJLEtBQUssRUFBRSxDQUFDO29CQUNWLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUE7b0JBQ25DLEtBQUssR0FBRyxLQUFLLENBQUE7Z0JBQ2YsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDO1FBRUQsSUFBSSxLQUFLLEVBQUUsQ0FBQztZQUNWLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUE7WUFDbkMsS0FBSyxHQUFHLEtBQUssQ0FBQTtRQUNmLENBQUM7SUFDSCxDQUFDO0lBRUQsT0FBTyxJQUFJLENBQUE7QUFDYixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUMiwgVDQgfSBmcm9tICcuLi90eXBlcy5qcydcclxuaW1wb3J0IHsgUm93IH0gZnJvbSAnLi90eXBlcy5qcydcclxuaW1wb3J0IHsgY2xhbXBSZWN0IH0gZnJvbSAnLi91dGlsLmpzJ1xyXG5cclxudHlwZSBRdWVyeVByZWRpY2F0ZSA9IChcclxuICByOiBudW1iZXIsIGc6IG51bWJlciwgYjogbnVtYmVyLCBhOiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyLCBpOiBudW1iZXJcclxuKSA9PiBib29sZWFuXHJcblxyXG5leHBvcnQgY29uc3QgaW1hZ2VRdWVyeSA9IChcclxuICBpbWFnZURhdGE6IEltYWdlRGF0YSwgcHJlZGljYXRlOiBRdWVyeVByZWRpY2F0ZSxcclxuICByZWN0OiBUNCA9IFswLCAwLCBpbWFnZURhdGEud2lkdGgsIGltYWdlRGF0YS5oZWlnaHRdXHJcbik6IFQyIHwgbnVsbCA9PiB7XHJcbiAgcmVjdCA9IGNsYW1wUmVjdChpbWFnZURhdGEud2lkdGgsIGltYWdlRGF0YS5oZWlnaHQsIHJlY3QpXHJcblxyXG4gIGNvbnN0IFt4MCwgeTAsIHcsIGhdID0gcmVjdFxyXG5cclxuICBjb25zdCB4MSA9IHgwICsgd1xyXG4gIGNvbnN0IHkxID0geTAgKyBoXHJcblxyXG4gIGZvciAobGV0IHkgPSB5MDsgeSA8IHkxOyB5KyspIHtcclxuICAgIGZvciAobGV0IHggPSB4MDsgeCA8IHgxOyB4KyspIHtcclxuICAgICAgY29uc3QgaSA9ICh5ICogaW1hZ2VEYXRhLndpZHRoICsgeCkgKiA0XHJcbiAgICAgIGNvbnN0IHIgPSBpbWFnZURhdGEuZGF0YVtpXVxyXG4gICAgICBjb25zdCBnID0gaW1hZ2VEYXRhLmRhdGFbaSArIDFdXHJcbiAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVtpICsgMl1cclxuICAgICAgY29uc3QgYSA9IGltYWdlRGF0YS5kYXRhW2kgKyAzXVxyXG5cclxuICAgICAgaWYgKHByZWRpY2F0ZShyLCBnLCBiLCBhLCB4LCB5LCBpKSkge1xyXG4gICAgICAgIHJldHVybiBbeCwgeV1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG51bGxcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGltYWdlUXVlcnlBbGwgPSAoXHJcbiAgaW1hZ2VEYXRhOiBJbWFnZURhdGEsIHByZWRpY2F0ZTogUXVlcnlQcmVkaWNhdGUsXHJcbiAgcmVjdDogVDQgPSBbMCwgMCwgaW1hZ2VEYXRhLndpZHRoLCBpbWFnZURhdGEuaGVpZ2h0XVxyXG4pOiBUMltdID0+IHtcclxuICByZWN0ID0gY2xhbXBSZWN0KGltYWdlRGF0YS53aWR0aCwgaW1hZ2VEYXRhLmhlaWdodCwgcmVjdClcclxuXHJcbiAgY29uc3QgW3gwLCB5MCwgdywgaF0gPSByZWN0XHJcblxyXG4gIGNvbnN0IHgxID0geDAgKyB3XHJcbiAgY29uc3QgeTEgPSB5MCArIGhcclxuXHJcbiAgY29uc3QgcHRzOiBUMltdID0gW11cclxuXHJcbiAgZm9yIChsZXQgeSA9IHkwOyB5IDwgeTE7IHkrKykge1xyXG4gICAgZm9yIChsZXQgeCA9IHgwOyB4IDwgeDE7IHgrKykge1xyXG4gICAgICBjb25zdCBpID0gKHkgKiBpbWFnZURhdGEud2lkdGggKyB4KSAqIDRcclxuICAgICAgY29uc3QgciA9IGltYWdlRGF0YS5kYXRhW2ldXHJcbiAgICAgIGNvbnN0IGcgPSBpbWFnZURhdGEuZGF0YVtpICsgMV1cclxuICAgICAgY29uc3QgYiA9IGltYWdlRGF0YS5kYXRhW2kgKyAyXVxyXG4gICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbaSArIDNdXHJcblxyXG4gICAgICBpZiAocHJlZGljYXRlKHIsIGcsIGIsIGEsIHgsIHksIGkpKSB7XHJcbiAgICAgICAgcHRzLnB1c2goW3gsIHldKVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcHRzXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCByb3dRdWVyeSA9IChcclxuICBpbWFnZURhdGE6IEltYWdlRGF0YSwgcHJlZGljYXRlOiBRdWVyeVByZWRpY2F0ZSxcclxuICByZWN0OiBUNCA9IFswLCAwLCBpbWFnZURhdGEud2lkdGgsIGltYWdlRGF0YS5oZWlnaHRdXHJcbik6IFJvdzxuZXZlcj5bXSA9PiB7XHJcbiAgcmVjdCA9IGNsYW1wUmVjdChpbWFnZURhdGEud2lkdGgsIGltYWdlRGF0YS5oZWlnaHQsIHJlY3QpXHJcblxyXG4gIGNvbnN0IFt4MCwgeTAsIHcsIGhdID0gcmVjdFxyXG5cclxuICBjb25zdCB4MSA9IHgwICsgd1xyXG4gIGNvbnN0IHkxID0geTAgKyBoXHJcblxyXG4gIGNvbnN0IHJvd3M6IFJvdzxuZXZlcj5bXSA9IFtdXHJcblxyXG4gIGxldCBpblJvdyA9IGZhbHNlXHJcbiAgbGV0IHJvd1kgPSAwXHJcbiAgbGV0IHJvd1N0YXJ0ID0gMFxyXG4gIGxldCByb3dFbmQgPSAwXHJcblxyXG4gIGZvciAobGV0IHkgPSB5MDsgeSA8IHkxOyB5KyspIHtcclxuICAgIGZvciAobGV0IHggPSB4MDsgeCA8IHgxOyB4KyspIHtcclxuICAgICAgY29uc3QgaSA9ICh5ICogaW1hZ2VEYXRhLndpZHRoICsgeCkgKiA0XHJcbiAgICAgIGNvbnN0IHIgPSBpbWFnZURhdGEuZGF0YVtpXVxyXG4gICAgICBjb25zdCBnID0gaW1hZ2VEYXRhLmRhdGFbaSArIDFdXHJcbiAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVtpICsgMl1cclxuICAgICAgY29uc3QgYSA9IGltYWdlRGF0YS5kYXRhW2kgKyAzXVxyXG5cclxuICAgICAgaWYgKHByZWRpY2F0ZShyLCBnLCBiLCBhLCB4LCB5LCBpKSkge1xyXG4gICAgICAgIGlmICghaW5Sb3cpIHtcclxuICAgICAgICAgIGluUm93ID0gdHJ1ZVxyXG4gICAgICAgICAgcm93WSA9IHlcclxuICAgICAgICAgIHJvd1N0YXJ0ID0geFxyXG4gICAgICAgICAgcm93RW5kID0geFxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByb3dFbmQgPSB4XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGlmIChpblJvdykge1xyXG4gICAgICAgICAgcm93cy5wdXNoKFtyb3dZLCByb3dTdGFydCwgcm93RW5kXSlcclxuICAgICAgICAgIGluUm93ID0gZmFsc2VcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoaW5Sb3cpIHtcclxuICAgICAgcm93cy5wdXNoKFtyb3dZLCByb3dTdGFydCwgcm93RW5kXSlcclxuICAgICAgaW5Sb3cgPSBmYWxzZVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJvd3MgIFxyXG59XHJcbiJdfQ==