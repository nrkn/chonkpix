import { clampRect } from './util.js';
export const imageQuery = (imageData, predicate, rect = [0, 0, imageData.width, imageData.height]) => {
    rect = clampRect(imageData.width, imageData.height, rect);
    const [x0, y0, w, h] = rect;
    const x1 = x0 + w;
    const y1 = y0 + h;
    for (let y = y0; y < y1; y++) {
        for (let x = x0; x < x1; x++) {
            const i = (y * imageData.width + x) * 4;
            const r = imageData.data[i];
            const g = imageData.data[i + 1];
            const b = imageData.data[i + 2];
            const a = imageData.data[i + 3];
            if (predicate(r, g, b, a, x, y, i)) {
                return [x, y];
            }
        }
    }
    return null;
};
export const imageQueryAll = (imageData, predicate, rect = [0, 0, imageData.width, imageData.height]) => {
    rect = clampRect(imageData.width, imageData.height, rect);
    const [x0, y0, w, h] = rect;
    const x1 = x0 + w;
    const y1 = y0 + h;
    const pts = [];
    for (let y = y0; y < y1; y++) {
        for (let x = x0; x < x1; x++) {
            const i = (y * imageData.width + x) * 4;
            const r = imageData.data[i];
            const g = imageData.data[i + 1];
            const b = imageData.data[i + 2];
            const a = imageData.data[i + 3];
            if (predicate(r, g, b, a, x, y, i)) {
                pts.push([x, y]);
            }
        }
    }
    return pts;
};
export const rowQuery = (imageData, predicate, rect = [0, 0, imageData.width, imageData.height]) => {
    rect = clampRect(imageData.width, imageData.height, rect);
    const [x0, y0, w, h] = rect;
    const x1 = x0 + w;
    const y1 = y0 + h;
    const rows = [];
    let inRow = false;
    let rowY = 0;
    let rowStart = 0;
    let rowEnd = 0;
    for (let y = y0; y < y1; y++) {
        for (let x = x0; x < x1; x++) {
            const i = (y * imageData.width + x) * 4;
            const r = imageData.data[i];
            const g = imageData.data[i + 1];
            const b = imageData.data[i + 2];
            const a = imageData.data[i + 3];
            if (predicate(r, g, b, a, x, y, i)) {
                if (!inRow) {
                    inRow = true;
                    rowY = y;
                    rowStart = x;
                    rowEnd = x;
                }
                else {
                    rowEnd = x;
                }
            }
            else {
                if (inRow) {
                    rows.push([rowY, rowStart, rowEnd]);
                    inRow = false;
                }
            }
        }
        if (inRow) {
            rows.push([rowY, rowStart, rowEnd]);
            inRow = false;
        }
    }
    return rows;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXVlcnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL2ltYWdlL3F1ZXJ5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFNckMsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHLENBQ3hCLFNBQW9CLEVBQUUsU0FBeUIsRUFDL0MsT0FBVyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsU0FBUyxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQ3pDLEVBQUU7SUFDYixJQUFJLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUV6RCxNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFBO0lBRTNCLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDakIsTUFBTSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUVqQixLQUFLLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDN0IsS0FBSyxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1lBQ3ZDLE1BQU0sQ0FBQyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFDM0IsTUFBTSxDQUFDLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7WUFDL0IsTUFB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QUE7Z0JBQ1osQ0FBQztxQkFBTSxDQUFDO29CQUNOLE1BQU0sR0FBRyxDQUFDLENBQUE7Z0JBQ1osQ0FBQztZQUNILENBQUM7aUJBQU0sQ0FBQztnQkFDTixJQUFJLEtBQUssRUFBRSxDQUFDO29CQUNWLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUE7b0JBQ25DLEtBQUssR0FBRyxLQUFLLENBQUE7Z0JBQ2YsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDO1FBRUQsSUFBSSxLQUFLLEVBQUUsQ0FBQztZQUNWLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUE7WUFDbkMsS0FBSyxHQUFHLEtBQUssQ0FBQTtRQUNmLENBQUM7SUFDSCxDQUFDO0lBRUQsT0FBTyxJQUFJLENBQUE7QUFDYixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUMiwgVDQgfSBmcm9tICcuLi90eXBlcy5qcydcbmltcG9ydCB7IFJvdyB9IGZyb20gJy4vdHlwZXMuanMnXG5pbXBvcnQgeyBjbGFtcFJlY3QgfSBmcm9tICcuL3V0aWwuanMnXG5cbnR5cGUgUXVlcnlQcmVkaWNhdGUgPSAoXG4gIHI6IG51bWJlciwgZzogbnVtYmVyLCBiOiBudW1iZXIsIGE6IG51bWJlciwgeDogbnVtYmVyLCB5OiBudW1iZXIsIGk6IG51bWJlclxuKSA9PiBib29sZWFuXG5cbmV4cG9ydCBjb25zdCBpbWFnZVF1ZXJ5ID0gKFxuICBpbWFnZURhdGE6IEltYWdlRGF0YSwgcHJlZGljYXRlOiBRdWVyeVByZWRpY2F0ZSxcbiAgcmVjdDogVDQgPSBbMCwgMCwgaW1hZ2VEYXRhLndpZHRoLCBpbWFnZURhdGEuaGVpZ2h0XVxuKTogVDIgfCBudWxsID0+IHtcbiAgcmVjdCA9IGNsYW1wUmVjdChpbWFnZURhdGEud2lkdGgsIGltYWdlRGF0YS5oZWlnaHQsIHJlY3QpXG5cbiAgY29uc3QgW3gwLCB5MCwgdywgaF0gPSByZWN0XG5cbiAgY29uc3QgeDEgPSB4MCArIHdcbiAgY29uc3QgeTEgPSB5MCArIGhcblxuICBmb3IgKGxldCB5ID0geTA7IHkgPCB5MTsgeSsrKSB7XG4gICAgZm9yIChsZXQgeCA9IHgwOyB4IDwgeDE7IHgrKykge1xuICAgICAgY29uc3QgaSA9ICh5ICogaW1hZ2VEYXRhLndpZHRoICsgeCkgKiA0XG4gICAgICBjb25zdCByID0gaW1hZ2VEYXRhLmRhdGFbaV1cbiAgICAgIGNvbnN0IGcgPSBpbWFnZURhdGEuZGF0YVtpICsgMV1cbiAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVtpICsgMl1cbiAgICAgIGNvbnN0IGEgPSBpbWFnZURhdGEuZGF0YVtpICsgM11cblxuICAgICAgaWYgKHByZWRpY2F0ZShyLCBnLCBiLCBhLCB4LCB5LCBpKSkge1xuICAgICAgICByZXR1cm4gW3gsIHldXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG51bGxcbn1cblxuZXhwb3J0IGNvbnN0IGltYWdlUXVlcnlBbGwgPSAoXG4gIGltYWdlRGF0YTogSW1hZ2VEYXRhLCBwcmVkaWNhdGU6IFF1ZXJ5UHJlZGljYXRlLFxuICByZWN0OiBUNCA9IFswLCAwLCBpbWFnZURhdGEud2lkdGgsIGltYWdlRGF0YS5oZWlnaHRdXG4pOiBUMltdID0+IHtcbiAgcmVjdCA9IGNsYW1wUmVjdChpbWFnZURhdGEud2lkdGgsIGltYWdlRGF0YS5oZWlnaHQsIHJlY3QpXG5cbiAgY29uc3QgW3gwLCB5MCwgdywgaF0gPSByZWN0XG5cbiAgY29uc3QgeDEgPSB4MCArIHdcbiAgY29uc3QgeTEgPSB5MCArIGhcblxuICBjb25zdCBwdHM6IFQyW10gPSBbXVxuXG4gIGZvciAobGV0IHkgPSB5MDsgeSA8IHkxOyB5KyspIHtcbiAgICBmb3IgKGxldCB4ID0geDA7IHggPCB4MTsgeCsrKSB7XG4gICAgICBjb25zdCBpID0gKHkgKiBpbWFnZURhdGEud2lkdGggKyB4KSAqIDRcbiAgICAgIGNvbnN0IHIgPSBpbWFnZURhdGEuZGF0YVtpXVxuICAgICAgY29uc3QgZyA9IGltYWdlRGF0YS5kYXRhW2kgKyAxXVxuICAgICAgY29uc3QgYiA9IGltYWdlRGF0YS5kYXRhW2kgKyAyXVxuICAgICAgY29uc3QgYSA9IGltYWdlRGF0YS5kYXRhW2kgKyAzXVxuXG4gICAgICBpZiAocHJlZGljYXRlKHIsIGcsIGIsIGEsIHgsIHksIGkpKSB7XG4gICAgICAgIHB0cy5wdXNoKFt4LCB5XSlcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gcHRzXG59XG5cbmV4cG9ydCBjb25zdCByb3dRdWVyeSA9IChcbiAgaW1hZ2VEYXRhOiBJbWFnZURhdGEsIHByZWRpY2F0ZTogUXVlcnlQcmVkaWNhdGUsXG4gIHJlY3Q6IFQ0ID0gWzAsIDAsIGltYWdlRGF0YS53aWR0aCwgaW1hZ2VEYXRhLmhlaWdodF1cbik6IFJvdzxuZXZlcj5bXSA9PiB7XG4gIHJlY3QgPSBjbGFtcFJlY3QoaW1hZ2VEYXRhLndpZHRoLCBpbWFnZURhdGEuaGVpZ2h0LCByZWN0KVxuXG4gIGNvbnN0IFt4MCwgeTAsIHcsIGhdID0gcmVjdFxuXG4gIGNvbnN0IHgxID0geDAgKyB3XG4gIGNvbnN0IHkxID0geTAgKyBoXG5cbiAgY29uc3Qgcm93czogUm93PG5ldmVyPltdID0gW11cblxuICBsZXQgaW5Sb3cgPSBmYWxzZVxuICBsZXQgcm93WSA9IDBcbiAgbGV0IHJvd1N0YXJ0ID0gMFxuICBsZXQgcm93RW5kID0gMFxuXG4gIGZvciAobGV0IHkgPSB5MDsgeSA8IHkxOyB5KyspIHtcbiAgICBmb3IgKGxldCB4ID0geDA7IHggPCB4MTsgeCsrKSB7XG4gICAgICBjb25zdCBpID0gKHkgKiBpbWFnZURhdGEud2lkdGggKyB4KSAqIDRcbiAgICAgIGNvbnN0IHIgPSBpbWFnZURhdGEuZGF0YVtpXVxuICAgICAgY29uc3QgZyA9IGltYWdlRGF0YS5kYXRhW2kgKyAxXVxuICAgICAgY29uc3QgYiA9IGltYWdlRGF0YS5kYXRhW2kgKyAyXVxuICAgICAgY29uc3QgYSA9IGltYWdlRGF0YS5kYXRhW2kgKyAzXVxuXG4gICAgICBpZiAocHJlZGljYXRlKHIsIGcsIGIsIGEsIHgsIHksIGkpKSB7XG4gICAgICAgIGlmICghaW5Sb3cpIHtcbiAgICAgICAgICBpblJvdyA9IHRydWVcbiAgICAgICAgICByb3dZID0geVxuICAgICAgICAgIHJvd1N0YXJ0ID0geFxuICAgICAgICAgIHJvd0VuZCA9IHhcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByb3dFbmQgPSB4XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChpblJvdykge1xuICAgICAgICAgIHJvd3MucHVzaChbcm93WSwgcm93U3RhcnQsIHJvd0VuZF0pXG4gICAgICAgICAgaW5Sb3cgPSBmYWxzZVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGluUm93KSB7XG4gICAgICByb3dzLnB1c2goW3Jvd1ksIHJvd1N0YXJ0LCByb3dFbmRdKVxuICAgICAgaW5Sb3cgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiByb3dzICBcbn1cbiJdfQ==