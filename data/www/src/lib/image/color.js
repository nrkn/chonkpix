import { lerp } from '../util.js';
export const createColor = (r, g = r, b = r, a = 255) => (a << 24) | (b << 16) | (g << 8) | r;
export const createColor24 = (r, g = r, b = r) => (b << 16) | (g << 8) | r;
export const colorToRgba = (color) => [
    color & 0xFF, (color >> 8) & 0xFF, (color >> 16) & 0xFF, color >>> 24
];
export const colorToRgb = (color) => [
    color & 0xFF, (color >> 8) & 0xFF, (color >> 16) & 0xFF
];
export const generateHues = (count, v = 100) => {
    const colors = Array(count);
    const hueStep = 360 / (count + 1);
    for (let i = 0; i < count; i++) {
        const hue = i * hueStep;
        colors[i] = createColor(...hsvToRgb(hue, 100, v));
    }
    return colors;
};
// range is 0-360, s and v are 0-100
export const hsvToRgb = (h, s, v) => {
    const sFloat = s / 100;
    const vFloat = v / 100;
    const i = Math.floor(h / 60) % 6;
    const f = h / 60 - i;
    const p = vFloat * (1 - sFloat);
    const q = vFloat * (1 - f * sFloat);
    const t = vFloat * (1 - (1 - f) * sFloat);
    let rFloat = 0, gFloat = 0, bFloat = 0;
    switch (i) {
        case 0:
            rFloat = vFloat;
            gFloat = t;
            bFloat = p;
            break;
        case 1:
            rFloat = q;
            gFloat = vFloat;
            bFloat = p;
            break;
        case 2:
            rFloat = p;
            gFloat = vFloat;
            bFloat = t;
            break;
        case 3:
            rFloat = p;
            gFloat = q;
            bFloat = vFloat;
            break;
        case 4:
            rFloat = t;
            gFloat = p;
            bFloat = vFloat;
            break;
        case 5:
            rFloat = vFloat;
            gFloat = p;
            bFloat = q;
            break;
    }
    const r = Math.round(rFloat * 255);
    const g = Math.round(gFloat * 255);
    const b = Math.round(bFloat * 255);
    return [r, g, b];
};
export const createColorStop = (r, g, b, a, 
// 0 is start, 1 is end
stop) => [r, g, b, a, stop];
export const stopToRgba = (stop) => stop.slice(0, 4);
const AT_I = 4;
export const sampleGradient = (stops, at) => {
    if (stops.length === 0)
        throw Error('No stops in gradient');
    if (stops.length === 1)
        return stopToRgba(stops[0]);
    let leftIndex = -1;
    let rightIndex = -1;
    let maxLeft = -Infinity;
    let minRight = Infinity;
    for (let i = 0; i < stops.length; i++) {
        const stopAt = stops[i][AT_I];
        if (stopAt === at)
            return stopToRgba(stops[i]);
        if (stopAt < at && stopAt > maxLeft) {
            maxLeft = stopAt;
            leftIndex = i;
        }
        if (stopAt > at && stopAt < minRight) {
            minRight = stopAt;
            rightIndex = i;
        }
    }
    if (leftIndex === -1 && rightIndex >= 0) {
        return stopToRgba(stops[rightIndex]);
    }
    if (rightIndex === -1 && leftIndex >= 0) {
        return stopToRgba(stops[leftIndex]);
    }
    const left = stops[leftIndex];
    const right = stops[rightIndex];
    const range = right[AT_I] - left[AT_I];
    if (range === 0)
        return stopToRgba(left);
    const t = (at - left[AT_I]) / range;
    return [
        lerp(left[0], right[0], t),
        lerp(left[1], right[1], t),
        lerp(left[2], right[2], t),
        lerp(left[3], right[3], t)
    ];
};
// [ 0..255, 0..255, 0..255] -> [ 0..1, 0..1, 0..1]
export const rgbToHsl = ([r, g, b]) => {
    r /= 255;
    g /= 255;
    b /= 255;
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h = 0;
    let s = 0;
    let l = (max + min) / 2;
    if (max == min) {
        h = s = 0;
    }
    else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
            case r:
                h = (g - b) / d + (g < b ? 6 : 0);
                break;
            case g:
                h = (b - r) / d + 2;
                break;
            case b:
                h = (r - g) / d + 4;
                break;
        }
        h /= 6;
    }
    return [h, s, l];
};
// [ 0..1, 0..1, 0..1] -> [ 0..255, 0..255, 0..255]
export const hslToRgb = ([h, s, l]) => {
    let r = 0;
    let g = 0;
    let b = 0;
    if (s == 0) {
        r = g = b = l; // achromatic
    }
    else {
        const hue2rgb = (p, q, t) => {
            if (t < 0)
                t += 1;
            if (t > 1)
                t -= 1;
            if (t < 1 / 6)
                return p + (q - p) * 6 * t;
            if (t < 1 / 2)
                return q;
            if (t < 2 / 3)
                return p + (q - p) * (2 / 3 - t) * 6;
            return p;
        };
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1 / 3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1 / 3);
    }
    r *= 255;
    g *= 255;
    b *= 255;
    return [r | 0, g | 0, b | 0];
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL2ltYWdlL2NvbG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxZQUFZLENBQUE7QUFFakMsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBUyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLEVBQUUsQ0FDOUQsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0FBRXRDLE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxDQUFDLENBQVMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUN2RCxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUE7QUFFMUIsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLENBQUMsS0FBYSxFQUFNLEVBQUUsQ0FBQztJQUNoRCxLQUFLLEdBQUcsSUFBSSxFQUFFLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsS0FBSyxLQUFLLEVBQUU7Q0FDdEUsQ0FBQTtBQUVELE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxDQUFDLEtBQWEsRUFBTSxFQUFFLENBQUM7SUFDL0MsS0FBSyxHQUFHLElBQUksRUFBRSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLEdBQUcsSUFBSTtDQUN4RCxDQUFBO0FBRUQsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLENBQUMsS0FBYSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsRUFBRTtJQUNyRCxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQVMsS0FBSyxDQUFDLENBQUE7SUFFbkMsTUFBTSxPQUFPLEdBQUcsR0FBRyxHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBRWpDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMvQixNQUFNLEdBQUcsR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFBO1FBRXZCLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsR0FBRyxRQUFRLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ25ELENBQUM7SUFFRCxPQUFPLE1BQU0sQ0FBQTtBQUNmLENBQUMsQ0FBQTtBQUVELG9DQUFvQztBQUNwQyxNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFTLEVBQUUsQ0FBUyxFQUFFLENBQVMsRUFBTSxFQUFFO0lBQzlELE1BQU0sTUFBTSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUE7SUFDdEIsTUFBTSxNQUFNLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQTtJQUV0QixNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDaEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFFcEIsTUFBTSxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFBO0lBQy9CLE1BQU0sQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUE7SUFDbkMsTUFBTSxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFBO0lBRXpDLElBQUksTUFBTSxHQUFHLENBQUMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUE7SUFFdEMsUUFBUSxDQUFDLEVBQUUsQ0FBQztRQUNWLEtBQUssQ0FBQztZQUFFLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUFDLE1BQUs7UUFDdEQsS0FBSyxDQUFDO1lBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQUMsTUFBSztRQUN0RCxLQUFLLENBQUM7WUFBRSxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFBQyxNQUFLO1FBQ3RELEtBQUssQ0FBQztZQUFFLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUFDLE1BQUs7UUFDdEQsS0FBSyxDQUFDO1lBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQUMsTUFBSztRQUN0RCxLQUFLLENBQUM7WUFBRSxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFBQyxNQUFLO0lBQ3hELENBQUM7SUFFRCxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQTtJQUNsQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQTtJQUNsQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQTtJQUVsQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUNsQixDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsQ0FDN0IsQ0FBUyxFQUFFLENBQVMsRUFBRSxDQUFTLEVBQUUsQ0FBUztBQUMxQyx1QkFBdUI7QUFDdkIsSUFBWSxFQUNSLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUUzQixNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsQ0FBQyxJQUFRLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBTyxDQUFBO0FBRTlELE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQTtBQUVkLE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxDQUFDLEtBQVcsRUFBRSxFQUFVLEVBQU0sRUFBRTtJQUM1RCxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQztRQUFFLE1BQU0sS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUE7SUFFM0QsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUM7UUFBRSxPQUFPLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUVuRCxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUNsQixJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUNuQixJQUFJLE9BQU8sR0FBRyxDQUFDLFFBQVEsQ0FBQTtJQUN2QixJQUFJLFFBQVEsR0FBRyxRQUFRLENBQUE7SUFFdkIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUN0QyxNQUFNLE1BQU0sR0FBRyxLQUFL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Q0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFDOUIsQ0FBQztJQUVELENBQUMsSUFBSSxHQUFHLENBQUE7SUFDUixDQUFDLElBQUksR0FBRyxDQUFBO0lBQ1IsQ0FBQyxJQUFJLEdBQUcsQ0FBQTtJQUVSLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0FBQzlCLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFQzLCBUNCwgVDUgfSBmcm9tICcuLi90eXBlcy5qcydcbmltcG9ydCB7IGxlcnAgfSBmcm9tICcuLi91dGlsLmpzJ1xuXG5leHBvcnQgY29uc3QgY3JlYXRlQ29sb3IgPSAocjogbnVtYmVyLCBnID0gciwgYiA9IHIsIGEgPSAyNTUpID0+XG4gIChhIDw8IDI0KSB8IChiIDw8IDE2KSB8IChnIDw8IDgpIHwgclxuXG5leHBvcnQgY29uc3QgY3JlYXRlQ29sb3IyNCA9IChyOiBudW1iZXIsIGcgPSByLCBiID0gcikgPT5cbiAgKGIgPDwgMTYpIHwgKGcgPDwgOCkgfCByXG5cbmV4cG9ydCBjb25zdCBjb2xvclRvUmdiYSA9IChjb2xvcjogbnVtYmVyKTogVDQgPT4gW1xuICBjb2xvciAmIDB4RkYsIChjb2xvciA+PiA4KSAmIDB4RkYsIChjb2xvciA+PiAxNikgJiAweEZGLCBjb2xvciA+Pj4gMjRcbl1cblxuZXhwb3J0IGNvbnN0IGNvbG9yVG9SZ2IgPSAoY29sb3I6IG51bWJlcik6IFQzID0+IFtcbiAgY29sb3IgJiAweEZGLCAoY29sb3IgPj4gOCkgJiAweEZGLCAoY29sb3IgPj4gMTYpICYgMHhGRlxuXVxuXG5leHBvcnQgY29uc3QgZ2VuZXJhdGVIdWVzID0gKGNvdW50OiBudW1iZXIsIHYgPSAxMDApID0+IHtcbiAgY29uc3QgY29sb3JzID0gQXJyYXk8bnVtYmVyPihjb3VudClcblxuICBjb25zdCBodWVTdGVwID0gMzYwIC8gKGNvdW50ICsgMSlcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICBjb25zdCBodWUgPSBpICogaHVlU3RlcFxuXG4gICAgY29sb3JzW2ldID0gY3JlYXRlQ29sb3IoLi4uaHN2VG9SZ2IoaHVlLCAxMDAsIHYpKVxuICB9XG5cbiAgcmV0dXJuIGNvbG9yc1xufVxuXG4vLyByYW5nZSBpcyAwLTM2MCwgcyBhbmQgdiBhcmUgMC0xMDBcbmV4cG9ydCBjb25zdCBoc3ZUb1JnYiA9IChoOiBudW1iZXIsIHM6IG51bWJlciwgdjogbnVtYmVyKTogVDMgPT4ge1xuICBjb25zdCBzRmxvYXQgPSBzIC8gMTAwXG4gIGNvbnN0IHZGbG9hdCA9IHYgLyAxMDBcblxuICBjb25zdCBpID0gTWF0aC5mbG9vcihoIC8gNjApICUgNlxuICBjb25zdCBmID0gaCAvIDYwIC0gaVxuXG4gIGNvbnN0IHAgPSB2RmxvYXQgKiAoMSAtIHNGbG9hdClcbiAgY29uc3QgcSA9IHZGbG9hdCAqICgxIC0gZiAqIHNGbG9hdClcbiAgY29uc3QgdCA9IHZGbG9hdCAqICgxIC0gKDEgLSBmKSAqIHNGbG9hdClcblxuICBsZXQgckZsb2F0ID0gMCwgZ0Zsb2F0ID0gMCwgYkZsb2F0ID0gMFxuXG4gIHN3aXRjaCAoaSkge1xuICAgIGNhc2UgMDogckZsb2F0ID0gdkZsb2F0OyBnRmxvYXQgPSB0OyBiRmxvYXQgPSBwOyBicmVha1xuICAgIGNhc2UgMTogckZsb2F0ID0gcTsgZ0Zsb2F0ID0gdkZsb2F0OyBiRmxvYXQgPSBwOyBicmVha1xuICAgIGNhc2UgMjogckZsb2F0ID0gcDsgZ0Zsb2F0ID0gdkZsb2F0OyBiRmxvYXQgPSB0OyBicmVha1xuICAgIGNhc2UgMzogckZsb2F0ID0gcDsgZ0Zsb2F0ID0gcTsgYkZsb2F0ID0gdkZsb2F0OyBicmVha1xuICAgIGNhc2UgNDogckZsb2F0ID0gdDsgZ0Zsb2F0ID0gcDsgYkZsb2F0ID0gdkZsb2F0OyBicmVha1xuICAgIGNhc2UgNTogckZsb2F0ID0gdkZsb2F0OyBnRmxvYXQgPSBwOyBiRmxvYXQgPSBxOyBicmVha1xuICB9XG5cbiAgY29uc3QgciA9IE1hdGgucm91bmQockZsb2F0ICogMjU1KVxuICBjb25zdCBnID0gTWF0aC5yb3VuZChnRmxvYXQgKiAyNTUpXG4gIGNvbnN0IGIgPSBNYXRoLnJvdW5kKGJGbG9hdCAqIDI1NSlcblxuICByZXR1cm4gW3IsIGcsIGJdXG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVDb2xvclN0b3AgPSAoXG4gIHI6IG51bWJlciwgZzogbnVtYmVyLCBiOiBudW1iZXIsIGE6IG51bWJlcixcbiAgLy8gMCBpcyBzdGFydCwgMSBpcyBlbmRcbiAgc3RvcDogbnVtYmVyXG4pOiBUNSA9PiBbciwgZywgYiwgYSwgc3RvcF1cblxuZXhwb3J0IGNvbnN0IHN0b3BUb1JnYmEgPSAoc3RvcDogVDUpID0+IHN0b3Auc2xpY2UoMCwgNCkgYXMgVDRcblxuY29uc3QgQVRfSSA9IDRcblxuZXhwb3J0IGNvbnN0IHNhbXBsZUdyYWRpZW50ID0gKHN0b3BzOiBUNVtdLCBhdDogbnVtYmVyKTogVDQgPT4ge1xuICBpZiAoc3RvcHMubGVuZ3RoID09PSAwKSB0aHJvdyBFcnJvcignTm8gc3RvcHMgaW4gZ3JhZGllbnQnKVxuXG4gIGlmIChzdG9wcy5sZW5ndGggPT09IDEpIHJldHVybiBzdG9wVG9SZ2JhKHN0b3BzWzBdKVxuXG4gIGxldCBsZWZ0SW5kZXggPSAtMVxuICBsZXQgcmlnaHRJbmRleCA9IC0xXG4gIGxldCBtYXhMZWZ0ID0gLUluZmluaXR5XG4gIGxldCBtaW5SaWdodCA9IEluZmluaXR5XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdG9wcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHN0b3BBdCA9IHN0b3BzW2ldW0FUX0ldXG5cbiAgICBpZiAoc3RvcEF0ID09PSBhdCkgcmV0dXJuIHN0b3BUb1JnYmEoc3RvcHNbaV0pXG5cbiAgICBpZiAoc3RvcEF0IDwgYXQgJiYgc3RvcEF0ID4gbWF4TGVmdCkge1xuICAgICAgbWF4TGVmdCA9IHN0b3BBdFxuICAgICAgbGVmdEluZGV4ID0gaVxuICAgIH1cblxuICAgIGlmIChzdG9wQXQgPiBhdCAmJiBzdG9wQXQgPCBtaW5SaWdodCkge1xuICAgICAgbWluUmlnaHQgPSBzdG9wQXRcbiAgICAgIHJpZ2h0SW5kZXggPSBpXG4gICAgfVxuICB9XG5cbiAgaWYgKGxlZnRJbmRleCA9PT0gLTEgJiYgcmlnaHRJbmRleCA+PSAwKSB7XG4gICAgcmV0dXJuIHN0b3BUb1JnYmEoc3RvcHNbcmlnaHRJbmRleF0pXG4gIH1cblxuICBpZiAocmlnaHRJbmRleCA9PT0gLTEgJiYgbGVmdEluZGV4ID49IDApIHtcbiAgICByZXR1cm4gc3RvcFRvUmdiYShzdG9wc1tsZWZ0SW5kZXhdKVxuICB9XG5cbiAgY29uc3QgbGVmdCA9IHN0b3BzW2xlZnRJbmRleF1cbiAgY29uc3QgcmlnaHQgPSBzdG9wc1tyaWdodEluZGV4XVxuXG4gIGNvbnN0IHJhbmdlID0gcmlnaHRbQVRfSV0gLSBsZWZ0W0FUX0ldXG5cbiAgaWYgKHJhbmdlID09PSAwKSByZXR1cm4gc3RvcFRvUmdiYShsZWZ0KVxuXG4gIGNvbnN0IHQgPSAoYXQgLSBsZWZ0W0FUX0ldKSAvIHJhbmdlXG5cbiAgcmV0dXJuIFtcbiAgICBsZXJwKGxlZnRbMF0sIHJpZ2h0WzBdLCB0KSxcbiAgICBsZXJwKGxlZnRbMV0sIHJpZ2h0WzFdLCB0KSxcbiAgICBsZXJwKGxlZnRbMl0sIHJpZ2h0WzJdLCB0KSxcbiAgICBsZXJwKGxlZnRbM10sIHJpZ2h0WzNdLCB0KVxuICBdXG59XG5cbi8vIFsgMC4uMjU1LCAwLi4yNTUsIDAuLjI1NV0gLT4gWyAwLi4xLCAwLi4xLCAwLi4xXVxuZXhwb3J0IGNvbnN0IHJnYlRvSHNsID0gKFtyLCBnLCBiXTogVDMpOiBUMyA9PiB7XG4gIHIgLz0gMjU1XG4gIGcgLz0gMjU1XG4gIGIgLz0gMjU1XG5cbiAgY29uc3QgbWF4ID0gTWF0aC5tYXgociwgZywgYilcbiAgY29uc3QgbWluID0gTWF0aC5taW4ociwgZywgYilcblxuICBsZXQgaCA9IDBcbiAgbGV0IHMgPSAwXG4gIGxldCBsID0gKG1heCArIG1pbikgLyAyXG5cbiAgaWYgKG1heCA9PSBtaW4pIHtcbiAgICBoID0gcyA9IDBcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBkID0gbWF4IC0gbWluXG5cbiAgICBzID0gbCA+IDAuNSA/IGQgLyAoMiAtIG1heCAtIG1pbikgOiBkIC8gKG1heCArIG1pbilcblxuICAgIHN3aXRjaCAobWF4KSB7XG4gICAgICBjYXNlIHI6XG4gICAgICAgIGggPSAoZyAtIGIpIC8gZCArIChnIDwgYiA/IDYgOiAwKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSBnOlxuICAgICAgICBoID0gKGIgLSByKSAvIGQgKyAyXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlIGI6XG4gICAgICAgIGggPSAociAtIGcpIC8gZCArIDRcbiAgICAgICAgYnJlYWtcbiAgICB9XG5cbiAgICBoIC89IDZcbiAgfVxuXG4gIHJldHVybiBbaCwgcywgbF1cbn1cblxuLy8gWyAwLi4xLCAwLi4xLCAwLi4xXSAtPiBbIDAuLjI1NSwgMC4uMjU1LCAwLi4yNTVdXG5leHBvcnQgY29uc3QgaHNsVG9SZ2IgPSAoW2gsIHMsIGxdOiBUMyk6IFQzID0+IHtcbiAgbGV0IHIgPSAwXG4gIGxldCBnID0gMFxuICBsZXQgYiA9IDBcblxuICBpZiAocyA9PSAwKSB7XG4gICAgciA9IGcgPSBiID0gbCAvLyBhY2hyb21hdGljXG4gIH0gZWxzZSB7XG4gICAgY29uc3QgaHVlMnJnYiA9IChwOiBudW1iZXIsIHE6IG51bWJlciwgdDogbnVtYmVyKSA9PiB7XG4gICAgICBpZiAodCA8IDApIHQgKz0gMVxuICAgICAgaWYgKHQgPiAxKSB0IC09IDFcbiAgICAgIGlmICh0IDwgMSAvIDYpIHJldHVybiBwICsgKHEgLSBwKSAqIDYgKiB0XG4gICAgICBpZiAodCA8IDEgLyAyKSByZXR1cm4gcVxuICAgICAgaWYgKHQgPCAyIC8gMykgcmV0dXJuIHAgKyAocSAtIHApICogKDIgLyAzIC0gdCkgKiA2XG5cbiAgICAgIHJldHVybiBwXG4gICAgfVxuXG4gICAgY29uc3QgcSA9IGwgPCAwLjUgPyBsICogKDEgKyBzKSA6IGwgKyBzIC0gbCAqIHNcbiAgICBjb25zdCBwID0gMiAqIGwgLSBxXG5cbiAgICByID0gaHVlMnJnYihwLCBxLCBoICsgMSAvIDMpXG4gICAgZyA9IGh1ZTJyZ2IocCwgcSwgaClcbiAgICBiID0gaHVlMnJnYihwLCBxLCBoIC0gMSAvIDMpXG4gIH1cblxuICByICo9IDI1NVxuICBnICo9IDI1NVxuICBiICo9IDI1NVxuXG4gIHJldHVybiBbciB8IDAsIGcgfCAwLCBiIHwgMF1cbn0iXX0=