import { lerp } from '../util.js';
export const createColor = (r, g = r, b = r, a = 255) => (a << 24) | (b << 16) | (g << 8) | r;
export const createColor24 = (r, g = r, b = r) => (b << 16) | (g << 8) | r;
export const colorToRgba = (color) => [
    color & 0xFF, (color >> 8) & 0xFF, (color >> 16) & 0xFF, color >>> 24
];
export const colorToRgb = (color) => [
    color & 0xFF, (color >> 8) & 0xFF, (color >> 16) & 0xFF
];
export const generateHues = (count, v = 100) => {
    const colors = Array(count);
    const hueStep = 360 / (count + 1);
    for (let i = 0; i < count; i++) {
        const hue = i * hueStep;
        colors[i] = createColor(...hsvToRgb(hue, 100, v));
    }
    return colors;
};
// range is 0-360, s and v are 0-100
export const hsvToRgb = (h, s, v) => {
    const sFloat = s / 100;
    const vFloat = v / 100;
    const i = Math.floor(h / 60) % 6;
    const f = h / 60 - i;
    const p = vFloat * (1 - sFloat);
    const q = vFloat * (1 - f * sFloat);
    const t = vFloat * (1 - (1 - f) * sFloat);
    let rFloat = 0, gFloat = 0, bFloat = 0;
    switch (i) {
        case 0:
            rFloat = vFloat;
            gFloat = t;
            bFloat = p;
            break;
        case 1:
            rFloat = q;
            gFloat = vFloat;
            bFloat = p;
            break;
        case 2:
            rFloat = p;
            gFloat = vFloat;
            bFloat = t;
            break;
        case 3:
            rFloat = p;
            gFloat = q;
            bFloat = vFloat;
            break;
        case 4:
            rFloat = t;
            gFloat = p;
            bFloat = vFloat;
            break;
        case 5:
            rFloat = vFloat;
            gFloat = p;
            bFloat = q;
            break;
    }
    const r = Math.round(rFloat * 255);
    const g = Math.round(gFloat * 255);
    const b = Math.round(bFloat * 255);
    return [r, g, b];
};
export const createColorStop = (r, g, b, a, 
// 0 is start, 1 is end
stop) => [r, g, b, a, stop];
export const stopToRgba = (stop) => stop.slice(0, 4);
const AT_I = 4;
export const sampleGradient = (stops, at) => {
    if (stops.length === 0)
        throw Error('No stops in gradient');
    if (stops.length === 1)
        return stopToRgba(stops[0]);
    let leftIndex = -1;
    let rightIndex = -1;
    let maxLeft = -Infinity;
    let minRight = Infinity;
    for (let i = 0; i < stops.length; i++) {
        const stopAt = stops[i][AT_I];
        if (stopAt === at)
            return stopToRgba(stops[i]);
        if (stopAt < at && stopAt > maxLeft) {
            maxLeft = stopAt;
            leftIndex = i;
        }
        if (stopAt > at && stopAt < minRight) {
            minRight = stopAt;
            rightIndex = i;
        }
    }
    if (leftIndex === -1 && rightIndex >= 0) {
        return stopToRgba(stops[rightIndex]);
    }
    if (rightIndex === -1 && leftIndex >= 0) {
        return stopToRgba(stops[leftIndex]);
    }
    const left = stops[leftIndex];
    const right = stops[rightIndex];
    const range = right[AT_I] - left[AT_I];
    if (range === 0)
        return stopToRgba(left);
    const t = (at - left[AT_I]) / range;
    return [
        lerp(left[0], right[0], t),
        lerp(left[1], right[1], t),
        lerp(left[2], right[2], t),
        lerp(left[3], right[3], t)
    ];
};
// [ 0..255, 0..255, 0..255] -> [ 0..1, 0..1, 0..1]
export const rgbToHsl = ([r, g, b]) => {
    r /= 255;
    g /= 255;
    b /= 255;
    const max = Math.max(r, g, b);
    const min = Math.min(r, g, b);
    let h = 0;
    let s = 0;
    let l = (max + min) / 2;
    if (max == min) {
        h = s = 0;
    }
    else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
            case r:
                h = (g - b) / d + (g < b ? 6 : 0);
                break;
            case g:
                h = (b - r) / d + 2;
                break;
            case b:
                h = (r - g) / d + 4;
                break;
        }
        h /= 6;
    }
    return [h, s, l];
};
// [ 0..1, 0..1, 0..1] -> [ 0..255, 0..255, 0..255]
export const hslToRgb = ([h, s, l]) => {
    let r = 0;
    let g = 0;
    let b = 0;
    if (s == 0) {
        r = g = b = l; // achromatic
    }
    else {
        const hue2rgb = (p, q, t) => {
            if (t < 0)
                t += 1;
            if (t > 1)
                t -= 1;
            if (t < 1 / 6)
                return p + (q - p) * 6 * t;
            if (t < 1 / 2)
                return q;
            if (t < 2 / 3)
                return p + (q - p) * (2 / 3 - t) * 6;
            return p;
        };
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1 / 3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1 / 3);
    }
    r *= 255;
    g *= 255;
    b *= 255;
    return [r | 0, g | 0, b | 0];
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL2ltYWdlL2NvbG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxZQUFZLENBQUE7QUFFakMsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLENBQUMsQ0FBUyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLEVBQUUsQ0FDOUQsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0FBRXRDLE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxDQUFDLENBQVMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUN2RCxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUE7QUFFMUIsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLENBQUMsS0FBYSxFQUFNLEVBQUUsQ0FBQztJQUNoRCxLQUFLLEdBQUcsSUFBSSxFQUFFLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsS0FBSyxLQUFLLEVBQUU7Q0FDdEUsQ0FBQTtBQUVELE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxDQUFDLEtBQWEsRUFBTSxFQUFFLENBQUM7SUFDL0MsS0FBSyxHQUFHLElBQUksRUFBRSxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDLEdBQUcsSUFBSTtDQUN4RCxDQUFBO0FBRUQsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHLENBQUMsS0FBYSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsRUFBRTtJQUNyRCxNQUFNLE1BQU0sR0FBRyxLQUFLLENBQVMsS0FBSyxDQUFDLENBQUE7SUFFbkMsTUFBTSxPQUFPLEdBQUcsR0FBRyxHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFBO0lBRWpDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUMvQixNQUFNLEdBQUcsR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFBO1FBRXZCLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxXQUFXLENBQUMsR0FBRyxRQUFRLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ25ELENBQUM7SUFFRCxPQUFPLE1BQU0sQ0FBQTtBQUNmLENBQUMsQ0FBQTtBQUVELG9DQUFvQztBQUNwQyxNQUFNLENBQUMsTUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFTLEVBQUUsQ0FBUyxFQUFFLENBQVMsRUFBTSxFQUFFO0lBQzlELE1BQU0sTUFBTSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUE7SUFDdEIsTUFBTSxNQUFNLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQTtJQUV0QixNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDaEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFFcEIsTUFBTSxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFBO0lBQy9CLE1BQU0sQ0FBQyxHQUFHLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUE7SUFDbkMsTUFBTSxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFBO0lBRXpDLElBQUksTUFBTSxHQUFHLENBQUMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUE7SUFFdEMsUUFBUSxDQUFDLEVBQUUsQ0FBQztRQUNWLEtBQUssQ0FBQztZQUFFLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUFDLE1BQUs7UUFDdEQsS0FBSyxDQUFDO1lBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQUMsTUFBSztRQUN0RCxLQUFLLENBQUM7WUFBRSxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFBQyxNQUFLO1FBQ3RELEtBQUssQ0FBQztZQUFFLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUFDLE1BQUs7UUFDdEQsS0FBSyxDQUFDO1lBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQUMsTUFBSztRQUN0RCxLQUFLLENBQUM7WUFBRSxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFBQyxNQUFLO0lBQ3hELENBQUM7SUFFRCxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQTtJQUNsQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQTtJQUNsQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQTtJQUVsQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUNsQixDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsTUFBTSxlQUFlLEdBQUcsQ0FDN0IsQ0FBUyxFQUFFLENBQVMsRUFBRSxDQUFTLEVBQUUsQ0FBUztBQUMxQyx1QkFBdUI7QUFDdkIsSUFBWSxFQUNSLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUUzQixNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsQ0FBQyxJQUFRLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBTyxDQUFBO0FBRTlELE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQTtBQUVkLE1BQU0sQ0FBQyxNQUFNLGNBQWMsR0FBRyxDQUFDLEtBQVcsRUFBRSxFQUFVLEVBQU0sRUFBRTtJQUM1RCxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssQ0FBQztRQUFFLE1BQU0sS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUE7SUFFM0QsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUM7UUFBRSxPQUFPLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUVuRCxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUNsQixJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUNuQixJQUFJLE9BQU8sR0FBRyxDQUFDLFFBQVEsQ0FBQTtJQUN2QixJQUFJLFFBQVEsR0FBRyxRQUFRLENBQUE7SUFFdkIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUN0QyxNQUFNLE1BQU0sR0FBRyxLQUFL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Q0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFDOUIsQ0FBQztJQUVELENBQUMsSUFBSSxHQUFHLENBQUE7SUFDUixDQUFDLElBQUksR0FBRyxDQUFBO0lBQ1IsQ0FBQyxJQUFJLEdBQUcsQ0FBQTtJQUVSLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO0FBQzlCLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFQzLCBUNCwgVDUgfSBmcm9tICcuLi90eXBlcy5qcydcclxuaW1wb3J0IHsgbGVycCB9IGZyb20gJy4uL3V0aWwuanMnXHJcblxyXG5leHBvcnQgY29uc3QgY3JlYXRlQ29sb3IgPSAocjogbnVtYmVyLCBnID0gciwgYiA9IHIsIGEgPSAyNTUpID0+XHJcbiAgKGEgPDwgMjQpIHwgKGIgPDwgMTYpIHwgKGcgPDwgOCkgfCByXHJcblxyXG5leHBvcnQgY29uc3QgY3JlYXRlQ29sb3IyNCA9IChyOiBudW1iZXIsIGcgPSByLCBiID0gcikgPT5cclxuICAoYiA8PCAxNikgfCAoZyA8PCA4KSB8IHJcclxuXHJcbmV4cG9ydCBjb25zdCBjb2xvclRvUmdiYSA9IChjb2xvcjogbnVtYmVyKTogVDQgPT4gW1xyXG4gIGNvbG9yICYgMHhGRiwgKGNvbG9yID4+IDgpICYgMHhGRiwgKGNvbG9yID4+IDE2KSAmIDB4RkYsIGNvbG9yID4+PiAyNFxyXG5dXHJcblxyXG5leHBvcnQgY29uc3QgY29sb3JUb1JnYiA9IChjb2xvcjogbnVtYmVyKTogVDMgPT4gW1xyXG4gIGNvbG9yICYgMHhGRiwgKGNvbG9yID4+IDgpICYgMHhGRiwgKGNvbG9yID4+IDE2KSAmIDB4RkZcclxuXVxyXG5cclxuZXhwb3J0IGNvbnN0IGdlbmVyYXRlSHVlcyA9IChjb3VudDogbnVtYmVyLCB2ID0gMTAwKSA9PiB7XHJcbiAgY29uc3QgY29sb3JzID0gQXJyYXk8bnVtYmVyPihjb3VudClcclxuXHJcbiAgY29uc3QgaHVlU3RlcCA9IDM2MCAvIChjb3VudCArIDEpXHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xyXG4gICAgY29uc3QgaHVlID0gaSAqIGh1ZVN0ZXBcclxuXHJcbiAgICBjb2xvcnNbaV0gPSBjcmVhdGVDb2xvciguLi5oc3ZUb1JnYihodWUsIDEwMCwgdikpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gY29sb3JzXHJcbn1cclxuXHJcbi8vIHJhbmdlIGlzIDAtMzYwLCBzIGFuZCB2IGFyZSAwLTEwMFxyXG5leHBvcnQgY29uc3QgaHN2VG9SZ2IgPSAoaDogbnVtYmVyLCBzOiBudW1iZXIsIHY6IG51bWJlcik6IFQzID0+IHtcclxuICBjb25zdCBzRmxvYXQgPSBzIC8gMTAwXHJcbiAgY29uc3QgdkZsb2F0ID0gdiAvIDEwMFxyXG5cclxuICBjb25zdCBpID0gTWF0aC5mbG9vcihoIC8gNjApICUgNlxyXG4gIGNvbnN0IGYgPSBoIC8gNjAgLSBpXHJcblxyXG4gIGNvbnN0IHAgPSB2RmxvYXQgKiAoMSAtIHNGbG9hdClcclxuICBjb25zdCBxID0gdkZsb2F0ICogKDEgLSBmICogc0Zsb2F0KVxyXG4gIGNvbnN0IHQgPSB2RmxvYXQgKiAoMSAtICgxIC0gZikgKiBzRmxvYXQpXHJcblxyXG4gIGxldCByRmxvYXQgPSAwLCBnRmxvYXQgPSAwLCBiRmxvYXQgPSAwXHJcblxyXG4gIHN3aXRjaCAoaSkge1xyXG4gICAgY2FzZSAwOiByRmxvYXQgPSB2RmxvYXQ7IGdGbG9hdCA9IHQ7IGJGbG9hdCA9IHA7IGJyZWFrXHJcbiAgICBjYXNlIDE6IHJGbG9hdCA9IHE7IGdGbG9hdCA9IHZGbG9hdDsgYkZsb2F0ID0gcDsgYnJlYWtcclxuICAgIGNhc2UgMjogckZsb2F0ID0gcDsgZ0Zsb2F0ID0gdkZsb2F0OyBiRmxvYXQgPSB0OyBicmVha1xyXG4gICAgY2FzZSAzOiByRmxvYXQgPSBwOyBnRmxvYXQgPSBxOyBiRmxvYXQgPSB2RmxvYXQ7IGJyZWFrXHJcbiAgICBjYXNlIDQ6IHJGbG9hdCA9IHQ7IGdGbG9hdCA9IHA7IGJGbG9hdCA9IHZGbG9hdDsgYnJlYWtcclxuICAgIGNhc2UgNTogckZsb2F0ID0gdkZsb2F0OyBnRmxvYXQgPSBwOyBiRmxvYXQgPSBxOyBicmVha1xyXG4gIH1cclxuXHJcbiAgY29uc3QgciA9IE1hdGgucm91bmQockZsb2F0ICogMjU1KVxyXG4gIGNvbnN0IGcgPSBNYXRoLnJvdW5kKGdGbG9hdCAqIDI1NSlcclxuICBjb25zdCBiID0gTWF0aC5yb3VuZChiRmxvYXQgKiAyNTUpXHJcblxyXG4gIHJldHVybiBbciwgZywgYl1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNyZWF0ZUNvbG9yU3RvcCA9IChcclxuICByOiBudW1iZXIsIGc6IG51bWJlciwgYjogbnVtYmVyLCBhOiBudW1iZXIsXHJcbiAgLy8gMCBpcyBzdGFydCwgMSBpcyBlbmRcclxuICBzdG9wOiBudW1iZXJcclxuKTogVDUgPT4gW3IsIGcsIGIsIGEsIHN0b3BdXHJcblxyXG5leHBvcnQgY29uc3Qgc3RvcFRvUmdiYSA9IChzdG9wOiBUNSkgPT4gc3RvcC5zbGljZSgwLCA0KSBhcyBUNFxyXG5cclxuY29uc3QgQVRfSSA9IDRcclxuXHJcbmV4cG9ydCBjb25zdCBzYW1wbGVHcmFkaWVudCA9IChzdG9wczogVDVbXSwgYXQ6IG51bWJlcik6IFQ0ID0+IHtcclxuICBpZiAoc3RvcHMubGVuZ3RoID09PSAwKSB0aHJvdyBFcnJvcignTm8gc3RvcHMgaW4gZ3JhZGllbnQnKVxyXG5cclxuICBpZiAoc3RvcHMubGVuZ3RoID09PSAxKSByZXR1cm4gc3RvcFRvUmdiYShzdG9wc1swXSlcclxuXHJcbiAgbGV0IGxlZnRJbmRleCA9IC0xXHJcbiAgbGV0IHJpZ2h0SW5kZXggPSAtMVxyXG4gIGxldCBtYXhMZWZ0ID0gLUluZmluaXR5XHJcbiAgbGV0IG1pblJpZ2h0ID0gSW5maW5pdHlcclxuXHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdG9wcy5sZW5ndGg7IGkrKykge1xyXG4gICAgY29uc3Qgc3RvcEF0ID0gc3RvcHNbaV1bQVRfSV1cclxuXHJcbiAgICBpZiAoc3RvcEF0ID09PSBhdCkgcmV0dXJuIHN0b3BUb1JnYmEoc3RvcHNbaV0pXHJcblxyXG4gICAgaWYgKHN0b3BBdCA8IGF0ICYmIHN0b3BBdCA+IG1heExlZnQpIHtcclxuICAgICAgbWF4TGVmdCA9IHN0b3BBdFxyXG4gICAgICBsZWZ0SW5kZXggPSBpXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHN0b3BBdCA+IGF0ICYmIHN0b3BBdCA8IG1pblJpZ2h0KSB7XHJcbiAgICAgIG1pblJpZ2h0ID0gc3RvcEF0XHJcbiAgICAgIHJpZ2h0SW5kZXggPSBpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpZiAobGVmdEluZGV4ID09PSAtMSAmJiByaWdodEluZGV4ID49IDApIHtcclxuICAgIHJldHVybiBzdG9wVG9SZ2JhKHN0b3BzW3JpZ2h0SW5kZXhdKVxyXG4gIH1cclxuXHJcbiAgaWYgKHJpZ2h0SW5kZXggPT09IC0xICYmIGxlZnRJbmRleCA+PSAwKSB7XHJcbiAgICByZXR1cm4gc3RvcFRvUmdiYShzdG9wc1tsZWZ0SW5kZXhdKVxyXG4gIH1cclxuXHJcbiAgY29uc3QgbGVmdCA9IHN0b3BzW2xlZnRJbmRleF1cclxuICBjb25zdCByaWdodCA9IHN0b3BzW3JpZ2h0SW5kZXhdXHJcblxyXG4gIGNvbnN0IHJhbmdlID0gcmlnaHRbQVRfSV0gLSBsZWZ0W0FUX0ldXHJcblxyXG4gIGlmIChyYW5nZSA9PT0gMCkgcmV0dXJuIHN0b3BUb1JnYmEobGVmdClcclxuXHJcbiAgY29uc3QgdCA9IChhdCAtIGxlZnRbQVRfSV0pIC8gcmFuZ2VcclxuXHJcbiAgcmV0dXJuIFtcclxuICAgIGxlcnAobGVmdFswXSwgcmlnaHRbMF0sIHQpLFxyXG4gICAgbGVycChsZWZ0WzFdLCByaWdodFsxXSwgdCksXHJcbiAgICBsZXJwKGxlZnRbMl0sIHJpZ2h0WzJdLCB0KSxcclxuICAgIGxlcnAobGVmdFszXSwgcmlnaHRbM10sIHQpXHJcbiAgXVxyXG59XHJcblxyXG4vLyBbIDAuLjI1NSwgMC4uMjU1LCAwLi4yNTVdIC0+IFsgMC4uMSwgMC4uMSwgMC4uMV1cclxuZXhwb3J0IGNvbnN0IHJnYlRvSHNsID0gKFtyLCBnLCBiXTogVDMpOiBUMyA9PiB7XHJcbiAgciAvPSAyNTVcclxuICBnIC89IDI1NVxyXG4gIGIgLz0gMjU1XHJcblxyXG4gIGNvbnN0IG1heCA9IE1hdGgubWF4KHIsIGcsIGIpXHJcbiAgY29uc3QgbWluID0gTWF0aC5taW4ociwgZywgYilcclxuXHJcbiAgbGV0IGggPSAwXHJcbiAgbGV0IHMgPSAwXHJcbiAgbGV0IGwgPSAobWF4ICsgbWluKSAvIDJcclxuXHJcbiAgaWYgKG1heCA9PSBtaW4pIHtcclxuICAgIGggPSBzID0gMFxyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCBkID0gbWF4IC0gbWluXHJcblxyXG4gICAgcyA9IGwgPiAwLjUgPyBkIC8gKDIgLSBtYXggLSBtaW4pIDogZCAvIChtYXggKyBtaW4pXHJcblxyXG4gICAgc3dpdGNoIChtYXgpIHtcclxuICAgICAgY2FzZSByOlxyXG4gICAgICAgIGggPSAoZyAtIGIpIC8gZCArIChnIDwgYiA/IDYgOiAwKVxyXG4gICAgICAgIGJyZWFrXHJcbiAgICAgIGNhc2UgZzpcclxuICAgICAgICBoID0gKGIgLSByKSAvIGQgKyAyXHJcbiAgICAgICAgYnJlYWtcclxuICAgICAgY2FzZSBiOlxyXG4gICAgICAgIGggPSAociAtIGcpIC8gZCArIDRcclxuICAgICAgICBicmVha1xyXG4gICAgfVxyXG5cclxuICAgIGggLz0gNlxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIFtoLCBzLCBsXVxyXG59XHJcblxyXG4vLyBbIDAuLjEsIDAuLjEsIDAuLjFdIC0+IFsgMC4uMjU1LCAwLi4yNTUsIDAuLjI1NV1cclxuZXhwb3J0IGNvbnN0IGhzbFRvUmdiID0gKFtoLCBzLCBsXTogVDMpOiBUMyA9PiB7XHJcbiAgbGV0IHIgPSAwXHJcbiAgbGV0IGcgPSAwXHJcbiAgbGV0IGIgPSAwXHJcblxyXG4gIGlmIChzID09IDApIHtcclxuICAgIHIgPSBnID0gYiA9IGwgLy8gYWNocm9tYXRpY1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCBodWUycmdiID0gKHA6IG51bWJlciwgcTogbnVtYmVyLCB0OiBudW1iZXIpID0+IHtcclxuICAgICAgaWYgKHQgPCAwKSB0ICs9IDFcclxuICAgICAgaWYgKHQgPiAxKSB0IC09IDFcclxuICAgICAgaWYgKHQgPCAxIC8gNikgcmV0dXJuIHAgKyAocSAtIHApICogNiAqIHRcclxuICAgICAgaWYgKHQgPCAxIC8gMikgcmV0dXJuIHFcclxuICAgICAgaWYgKHQgPCAyIC8gMykgcmV0dXJuIHAgKyAocSAtIHApICogKDIgLyAzIC0gdCkgKiA2XHJcblxyXG4gICAgICByZXR1cm4gcFxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHEgPSBsIDwgMC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzXHJcbiAgICBjb25zdCBwID0gMiAqIGwgLSBxXHJcblxyXG4gICAgciA9IGh1ZTJyZ2IocCwgcSwgaCArIDEgLyAzKVxyXG4gICAgZyA9IGh1ZTJyZ2IocCwgcSwgaClcclxuICAgIGIgPSBodWUycmdiKHAsIHEsIGggLSAxIC8gMylcclxuICB9XHJcblxyXG4gIHIgKj0gMjU1XHJcbiAgZyAqPSAyNTVcclxuICBiICo9IDI1NVxyXG5cclxuICByZXR1cm4gW3IgfCAwLCBnIHwgMCwgYiB8IDBdXHJcbn0iXX0=