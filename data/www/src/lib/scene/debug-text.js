import { fontImageToPoints, layoutTextLine, textLayoutToIndices } from '../bmpfont/layout.js';
import { loadFontMono } from '../bmpfont/load.js';
import { createColor } from '../image/color.js';
import { fill, fillIndices } from '../image/fill.js';
import { maybe } from '../util.js';
export const debugTextSceneHelper = (getCurrentText) => {
    let isActive = false;
    let font;
    let fontPts = {};
    const init = async (_state) => {
        font = await loadFontMono('EverexME_5x8');
        fontPts = fontImageToPoints(font);
        isActive = true;
    };
    const update = (state) => {
        if (!maybe(font))
            throw Error('Expected font');
        if (!maybe(fontPts))
            throw Error('Expected fontPts');
        const text = getCurrentText();
        if (text.length === 0)
            return;
        const buffer = state.view.getBuffer();
        const { width } = buffer;
        const padding = 2;
        let longest = 0;
        for (let i = 0; i < text.length; i++) {
            const len = text[i].length;
            if (len > longest)
                longest = len;
        }
        const textW = font.width * longest + padding * 2;
        const textH = font.height * text.length + padding * 2;
        const textX = width - textW - padding;
        const textY = padding;
        const textBg = createColor(0x00, 0x78, 0xd4);
        const textFg = createColor(0xff, 0xd7, 0x00);
        fill(buffer, textBg, [textX, textY, textW, textH]);
        for (let i = 0; i < text.length; i++) {
            const textLayout = layoutTextLine(font, text[i]);
            const textIndices = textLayoutToIndices(buffer, textX + padding, textY + padding + i * font.height, fontPts, textLayout);
            fillIndices(textIndices, buffer, textFg);
        }
    };
    const quit = async (_state) => {
        font = null;
        fontPts = {};
        isActive = false;
    };
    const setActive = (active) => {
        isActive = active;
    };
    return { init, update, quit, setActive };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVidWctdGV4dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvc2NlbmUvZGVidWctdGV4dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsY0FBYyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sc0JBQXNCLENBQUE7QUFDN0YsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBRWpELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQTtBQUMvQyxPQUFPLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxNQUFNLGtCQUFrQixDQUFBO0FBRXBELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxZQUFZLENBQUE7QUFFbEMsTUFBTSxDQUFDLE1BQU0sb0JBQW9CLEdBQUcsQ0FDbEMsY0FBOEIsRUFDdkIsRUFBRTtJQUNULElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQTtJQUNwQixJQUFJLElBQXFCLENBQUE7SUFDekIsSUFBSSxPQUFPLEdBQWdDLEVBQUUsQ0FBQTtJQUU3QyxNQUFNLElBQUksR0FBRyxLQUFLLEVBQUUsTUFBYSxFQUFFLEVBQUU7UUFDbkMsSUFBSSxHQUFHLE1BQU0sWUFBWSxDQUFDLGNBQWMsQ0FBQyxDQUFBO1FBQ3pDLE9BQU8sR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUVqQyxRQUFRLEdBQUcsSUFBSSxDQUFBO0lBQ2pCLENBQUMsQ0FBQTtJQUVELE1BQU0sTUFBTSxHQUFHLENBQUMsS0FBWSxFQUFFLEVBQUU7UUFDOUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7WUFBRSxNQUFNLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQTtRQUM5QyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQztZQUFFLE1BQU0sS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUE7UUFFcEQsTUFBTSxJQUFJLEdBQUcsY0FBYyxFQUFFLENBQUE7UUFFN0IsSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUM7WUFBRSxPQUFNO1FBRTdCLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUE7UUFDckMsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLE1BQU0sQ0FBQTtRQUV4QixNQUFNLE9BQU8sR0FBRyxDQUFDLENBQUE7UUFFakIsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFBO1FBRWYsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNyQyxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFBO1lBRTFCLElBQUksR0FBRyxHQUFHLE9BQU87Z0JBQUUsT0FBTyxHQUFHLEdBQUcsQ0FBQTtRQUNsQyxDQUFDO1FBRUQsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxPQUFPLEdBQUcsT0FBTyxHQUFHLENBQUMsQ0FBQTtRQUNoRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEdBQUcsT0FBTyxHQUFHLENBQUMsQ0FBQTtRQUNyRCxNQUFNLEtBQUssR0FBRyxLQUFLLEdBQUcsS0FBSyxHQUFHLE9BQU8sQ0FBQTtRQUNyQyxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUE7UUFFckIsTUFBTSxNQUFNLEdBQUcsV0FBVyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFDNUMsTUFBTSxNQUFNLEdBQUcsV0FBVyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFFNUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFBO1FBRWxELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDckMsTUFBTSxVQUFVLEdBQUcsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUVoRCxNQUFNLFdBQVcsR0FBRyxtQkFBbUIsQ0FDckMsTUFBTSxFQUNOLEtBQUssR0FBRyxPQUFPLEVBQUUsS0FBSyxHQUFHLE9BQU8sR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFDbEQsT0FBTyxFQUFFLFVBQVUsQ0FDcEIsQ0FBQTtZQUVELFdBQVcsQ0FBQyxXQUFXLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQzFDLENBQUM7SUFDSCxDQUFDLENBQUE7SUFFRCxNQUFNLElBQUksR0FBRyxLQUFLLEVBQUUsTUFBYSxFQUFFLEVBQUU7UUFDbkMsSUFBSSxHQUFHLElBQUksQ0FBQTtRQUNYLE9BQU8sR0FBRyxFQUFFLENBQUE7UUFFWixRQUFRLEdBQUcsS0FBSyxDQUFBO0lBQ2xCLENBQUMsQ0FBQTtJQUVELE1BQU0sU0FBUyxHQUFHLENBQUMsTUFBZSxFQUFFLEVBQUU7UUFDcEMsUUFBUSxHQUFHLE1BQU0sQ0FBQTtJQUNuQixDQUFDLENBQUE7SUFFRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLENBQUE7QUFDMUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZm9udEltYWdlVG9Qb2ludHMsIGxheW91dFRleHRMaW5lLCB0ZXh0TGF5b3V0VG9JbmRpY2VzIH0gZnJvbSAnLi4vYm1wZm9udC9sYXlvdXQuanMnXHJcbmltcG9ydCB7IGxvYWRGb250TW9ubyB9IGZyb20gJy4uL2JtcGZvbnQvbG9hZC5qcydcclxuaW1wb3J0IHsgQm1wRm9udE0gfSBmcm9tICcuLi9ibXBmb250L3R5cGVzLmpzJ1xyXG5pbXBvcnQgeyBjcmVhdGVDb2xvciB9IGZyb20gJy4uL2ltYWdlL2NvbG9yLmpzJ1xyXG5pbXBvcnQgeyBmaWxsLCBmaWxsSW5kaWNlcyB9IGZyb20gJy4uL2ltYWdlL2ZpbGwuanMnXHJcbmltcG9ydCB7IE1heWJlLCBTY2VuZSwgU3RhdGUsIFQyIH0gZnJvbSAnLi4vdHlwZXMuanMnXHJcbmltcG9ydCB7IG1heWJlIH0gZnJvbSAnLi4vdXRpbC5qcydcclxuXHJcbmV4cG9ydCBjb25zdCBkZWJ1Z1RleHRTY2VuZUhlbHBlciA9IChcclxuICBnZXRDdXJyZW50VGV4dDogKCkgPT4gc3RyaW5nW11cclxuKTogU2NlbmUgPT4ge1xyXG4gIGxldCBpc0FjdGl2ZSA9IGZhbHNlXHJcbiAgbGV0IGZvbnQ6IE1heWJlPEJtcEZvbnRNPlxyXG4gIGxldCBmb250UHRzOiBSZWNvcmQ8bnVtYmVyLCBNYXliZTxUMltdPj4gPSB7fVxyXG5cclxuICBjb25zdCBpbml0ID0gYXN5bmMgKF9zdGF0ZTogU3RhdGUpID0+IHtcclxuICAgIGZvbnQgPSBhd2FpdCBsb2FkRm9udE1vbm8oJ0V2ZXJleE1FXzV4OCcpXHJcbiAgICBmb250UHRzID0gZm9udEltYWdlVG9Qb2ludHMoZm9udClcclxuXHJcbiAgICBpc0FjdGl2ZSA9IHRydWVcclxuICB9XHJcblxyXG4gIGNvbnN0IHVwZGF0ZSA9IChzdGF0ZTogU3RhdGUpID0+IHtcclxuICAgIGlmICghbWF5YmUoZm9udCkpIHRocm93IEVycm9yKCdFeHBlY3RlZCBmb250JylcclxuICAgIGlmICghbWF5YmUoZm9udFB0cykpIHRocm93IEVycm9yKCdFeHBlY3RlZCBmb250UHRzJylcclxuXHJcbiAgICBjb25zdCB0ZXh0ID0gZ2V0Q3VycmVudFRleHQoKVxyXG5cclxuICAgIGlmICh0ZXh0Lmxlbmd0aCA9PT0gMCkgcmV0dXJuXHJcblxyXG4gICAgY29uc3QgYnVmZmVyID0gc3RhdGUudmlldy5nZXRCdWZmZXIoKVxyXG4gICAgY29uc3QgeyB3aWR0aCB9ID0gYnVmZmVyXHJcblxyXG4gICAgY29uc3QgcGFkZGluZyA9IDJcclxuXHJcbiAgICBsZXQgbG9uZ2VzdCA9IDBcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRleHQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgbGVuID0gdGV4dFtpXS5sZW5ndGhcclxuXHJcbiAgICAgIGlmIChsZW4gPiBsb25nZXN0KSBsb25nZXN0ID0gbGVuXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgdGV4dFcgPSBmb250LndpZHRoICogbG9uZ2VzdCArIHBhZGRpbmcgKiAyXHJcbiAgICBjb25zdCB0ZXh0SCA9IGZvbnQuaGVpZ2h0ICogdGV4dC5sZW5ndGggKyBwYWRkaW5nICogMlxyXG4gICAgY29uc3QgdGV4dFggPSB3aWR0aCAtIHRleHRXIC0gcGFkZGluZ1xyXG4gICAgY29uc3QgdGV4dFkgPSBwYWRkaW5nXHJcblxyXG4gICAgY29uc3QgdGV4dEJnID0gY3JlYXRlQ29sb3IoMHgwMCwgMHg3OCwgMHhkNClcclxuICAgIGNvbnN0IHRleHRGZyA9IGNyZWF0ZUNvbG9yKDB4ZmYsIDB4ZDcsIDB4MDApXHJcblxyXG4gICAgZmlsbChidWZmZXIsIHRleHRCZywgW3RleHRYLCB0ZXh0WSwgdGV4dFcsIHRleHRIXSlcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRleHQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgdGV4dExheW91dCA9IGxheW91dFRleHRMaW5lKGZvbnQsIHRleHRbaV0pXHJcblxyXG4gICAgICBjb25zdCB0ZXh0SW5kaWNlcyA9IHRleHRMYXlvdXRUb0luZGljZXMoXHJcbiAgICAgICAgYnVmZmVyLFxyXG4gICAgICAgIHRleHRYICsgcGFkZGluZywgdGV4dFkgKyBwYWRkaW5nICsgaSAqIGZvbnQuaGVpZ2h0LFxyXG4gICAgICAgIGZvbnRQdHMsIHRleHRMYXlvdXRcclxuICAgICAgKVxyXG5cclxuICAgICAgZmlsbEluZGljZXModGV4dEluZGljZXMsIGJ1ZmZlciwgdGV4dEZnKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3QgcXVpdCA9IGFzeW5jIChfc3RhdGU6IFN0YXRlKSA9PiB7XHJcbiAgICBmb250ID0gbnVsbFxyXG4gICAgZm9udFB0cyA9IHt9XHJcblxyXG4gICAgaXNBY3RpdmUgPSBmYWxzZVxyXG4gIH1cclxuXHJcbiAgY29uc3Qgc2V0QWN0aXZlID0gKGFjdGl2ZTogYm9vbGVhbikgPT4ge1xyXG4gICAgaXNBY3RpdmUgPSBhY3RpdmVcclxuICB9XHJcblxyXG4gIHJldHVybiB7IGluaXQsIHVwZGF0ZSwgcXVpdCwgc2V0QWN0aXZlIH1cclxufSJdfQ==