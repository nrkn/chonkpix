import { V_FRONT, V_TOP, V_X, V_Y, V_Z } from './const.js';
// painters algorithm - uses overdraw
//
// pretty fast! could be some room for improvement?
// eg should we precalculate voxels that are oob during sort phase and filter 
// them out? then we can skip three `if` checks per voxel
export const blitVoxels = (imageData, 
// assumed to be already sorted by z then y
voxels) => {
    const view = new Uint32Array(imageData.data.buffer);
    for (let i = 0; i < voxels.length; i++) {
        const vox = voxels[i];
        // with tilted orthographic projection, only the top and front faces are
        // visible, so a voxel is a T5
        const vx = vox[V_X];
        const vy = vox[V_Y];
        const vz = vox[V_Z];
        const vt = vox[V_TOP];
        const vf = vox[V_FRONT];
        // for tilted ortho, x2 === x3
        if (vx < 0 || vx >= imageData.width)
            continue;
        // tilted orthographic projection
        // both are left handled, but origin of y for 3d is at bottom, for 2d is
        // at top
        const dyTop = imageData.height - 1 - (vy + vz);
        if (dyTop >= 0 && dyTop < imageData.height) {
            const topIndex = dyTop * imageData.width + vx;
            view[topIndex] = vt;
        }
        const dyFront = dyTop + 1;
        if (dyFront >= 0 && dyFront < imageData.height) {
            const frontIndex = dyFront * imageData.width + vx;
            view[frontIndex] = vf;
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmxpdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvdm94ZWwvYmxpdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxNQUFNLFlBQVksQ0FBQTtBQUcxRCxxQ0FBcUM7QUFDckMsRUFBRTtBQUNGLG1EQUFtRDtBQUNuRCw4RUFBOEU7QUFDOUUseURBQXlEO0FBQ3pELE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxDQUN4QixTQUFvQjtBQUNwQiwyQ0FBMkM7QUFDM0MsTUFBYSxFQUNiLEVBQUU7SUFDRixNQUFNLElBQUksR0FBRyxJQUFJLFdBQVcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBRW5ELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDdkMsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBRXJCLHdFQUF3RTtRQUN4RSw4QkFBOEI7UUFDOUIsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFBO1FBQ25CLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUNuQixNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDbkIsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ3JCLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUV2Qiw4QkFBOEI7UUFDOUIsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxTQUFTLENBQUMsS0FBSztZQUFFLFNBQVE7UUFFN0MsaUNBQWlDO1FBQ2pDLHdFQUF3RTtRQUN4RSxTQUFTO1FBQ1QsTUFBTSxLQUFLLEdBQUcsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUE7UUFFOUMsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLEtBQUssR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDM0MsTUFBTSxRQUFRLEdBQUcsS0FBSyxHQUFHLFNBQVMsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFBO1lBRTdDLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUE7UUFDckIsQ0FBQztRQUVELE1BQU0sT0FBTyxHQUFHLEtBQUssR0FBRyxDQUFDLENBQUE7UUFFekIsSUFBSSxPQUFPLElBQUksQ0FBQyxJQUFJLE9BQU8sR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDL0MsTUFBTSxVQUFVLEdBQUcsT0FBTyxHQUFHLFNBQVMsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFBO1lBRWpELElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUE7UUFDdkIsQ0FBQztJQUNILENBQUM7QUFDSCxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWX0ZST05ULCBWX1RPUCwgVl9YLCBWX1ksIFZfWiB9IGZyb20gJy4vY29uc3QuanMnXHJcbmltcG9ydCB7IFZveCB9IGZyb20gJy4vdHlwZXMuanMnXHJcblxyXG4vLyBwYWludGVycyBhbGdvcml0aG0gLSB1c2VzIG92ZXJkcmF3XHJcbi8vXHJcbi8vIHByZXR0eSBmYXN0ISBjb3VsZCBiZSBzb21lIHJvb20gZm9yIGltcHJvdmVtZW50P1xyXG4vLyBlZyBzaG91bGQgd2UgcHJlY2FsY3VsYXRlIHZveGVscyB0aGF0IGFyZSBvb2IgZHVyaW5nIHNvcnQgcGhhc2UgYW5kIGZpbHRlciBcclxuLy8gdGhlbSBvdXQ/IHRoZW4gd2UgY2FuIHNraXAgdGhyZWUgYGlmYCBjaGVja3MgcGVyIHZveGVsXHJcbmV4cG9ydCBjb25zdCBibGl0Vm94ZWxzID0gKFxyXG4gIGltYWdlRGF0YTogSW1hZ2VEYXRhLFxyXG4gIC8vIGFzc3VtZWQgdG8gYmUgYWxyZWFkeSBzb3J0ZWQgYnkgeiB0aGVuIHlcclxuICB2b3hlbHM6IFZveFtdXHJcbikgPT4ge1xyXG4gIGNvbnN0IHZpZXcgPSBuZXcgVWludDMyQXJyYXkoaW1hZ2VEYXRhLmRhdGEuYnVmZmVyKVxyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IHZveGVscy5sZW5ndGg7IGkrKykge1xyXG4gICAgY29uc3Qgdm94ID0gdm94ZWxzW2ldXHJcblxyXG4gICAgLy8gd2l0aCB0aWx0ZWQgb3J0aG9ncmFwaGljIHByb2plY3Rpb24sIG9ubHkgdGhlIHRvcCBhbmQgZnJvbnQgZmFjZXMgYXJlXHJcbiAgICAvLyB2aXNpYmxlLCBzbyBhIHZveGVsIGlzIGEgVDVcclxuICAgIGNvbnN0IHZ4ID0gdm94W1ZfWF1cclxuICAgIGNvbnN0IHZ5ID0gdm94W1ZfWV1cclxuICAgIGNvbnN0IHZ6ID0gdm94W1ZfWl1cclxuICAgIGNvbnN0IHZ0ID0gdm94W1ZfVE9QXVxyXG4gICAgY29uc3QgdmYgPSB2b3hbVl9GUk9OVF1cclxuXHJcbiAgICAvLyBmb3IgdGlsdGVkIG9ydGhvLCB4MiA9PT0geDNcclxuICAgIGlmICh2eCA8IDAgfHwgdnggPj0gaW1hZ2VEYXRhLndpZHRoKSBjb250aW51ZVxyXG5cclxuICAgIC8vIHRpbHRlZCBvcnRob2dyYXBoaWMgcHJvamVjdGlvblxyXG4gICAgLy8gYm90aCBhcmUgbGVmdCBoYW5kbGVkLCBidXQgb3JpZ2luIG9mIHkgZm9yIDNkIGlzIGF0IGJvdHRvbSwgZm9yIDJkIGlzXHJcbiAgICAvLyBhdCB0b3BcclxuICAgIGNvbnN0IGR5VG9wID0gaW1hZ2VEYXRhLmhlaWdodCAtIDEgLSAodnkgKyB2eilcclxuXHJcbiAgICBpZiAoZHlUb3AgPj0gMCAmJiBkeVRvcCA8IGltYWdlRGF0YS5oZWlnaHQpIHtcclxuICAgICAgY29uc3QgdG9wSW5kZXggPSBkeVRvcCAqIGltYWdlRGF0YS53aWR0aCArIHZ4XHJcblxyXG4gICAgICB2aWV3W3RvcEluZGV4XSA9IHZ0XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZHlGcm9udCA9IGR5VG9wICsgMVxyXG5cclxuICAgIGlmIChkeUZyb250ID49IDAgJiYgZHlGcm9udCA8IGltYWdlRGF0YS5oZWlnaHQpIHtcclxuICAgICAgY29uc3QgZnJvbnRJbmRleCA9IGR5RnJvbnQgKiBpbWFnZURhdGEud2lkdGggKyB2eFxyXG5cclxuICAgICAgdmlld1tmcm9udEluZGV4XSA9IHZmXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==