import { createColor } from '../image/color.js';
import { createImage } from '../image/create.js';
export const enqueueNeighbours = (q, x, y, parentV) => {
    q.push([x - 1, y, parentV]);
    q.push([x + 1, y, parentV]);
    q.push([x, y - 1, parentV]);
    q.push([x, y + 1, parentV]);
};
export const minHeight = (heightmap) => Math.min(...heightmap.data);
export const maxHeight = (heightmap) => Math.max(...heightmap.data);
export const heightmapToImageData = (heightmap, isScaled = false) => {
    const { width, height, data } = heightmap;
    const size = width * height;
    const img = createImage(width, height);
    const view = new Uint32Array(img.data.buffer);
    let min = 0;
    let max = 0;
    let delta = 0;
    let scale = 0;
    if (isScaled) {
        min = minHeight(heightmap);
        max = maxHeight(heightmap);
        delta = max - min;
        scale = 255 / delta;
    }
    for (let i = 0; i < size; i++) {
        const v = data[i];
        const value = isScaled ? Math.floor((v - min) * scale) : v;
        view[i] = createColor(value);
    }
    return img;
};
// make the lowest value === 0
export const normalizeHeightmap = (heightmap) => {
    const min = minHeight(heightmap);
    const { width, height, data } = heightmap;
    const size = width * height;
    const result = {
        width,
        height,
        data: new Uint8ClampedArray(size)
    };
    for (let i = 0; i < size; i++) {
        result.data[i] = data[i] - min;
    }
    return result;
};
export const heightmapToPoint3 = (heightmap) => {
    const { width, height, data } = heightmap;
    const vox = [];
    for (let sy = 0; sy < height; sy++) {
        const rowStart = sy * width;
        const dz = height - 1 - sy;
        for (let sx = 0; sx < width; sx++) {
            const i = rowStart + sx;
            const dx = sx;
            const dy = data[i];
            vox.push([dx, dy, dz]);
        }
    }
    return vox;
};
export const heightmapToString = (heightmap) => {
    const { width, height, data } = heightmap;
    const rows = [];
    for (let y = 0; y < height; y++) {
        const rowStart = y * width;
        let row = '';
        for (let x = 0; x < width; x++) {
            const i = rowStart + x;
            row += data[i].toString().padStart(4, ' ');
        }
        rows.push(row);
    }
    return rows.join('\n');
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvaGVpZ2h0bWFwL3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1CQUFtQixDQUFBO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUtoRCxNQUFNLENBQUMsTUFBTSxpQkFBaUIsR0FBRyxDQUMvQixDQUFPLEVBQUUsQ0FBUyxFQUFFLENBQVMsRUFBRSxPQUFlLEVBQzlDLEVBQUU7SUFDRixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtBQUM3QixDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxTQUFvQixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBRTlFLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxDQUFDLFNBQW9CLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUE7QUFFOUUsTUFBTSxDQUFDLE1BQU0sb0JBQW9CLEdBQUcsQ0FBQyxTQUFvQixFQUFFLFFBQVEs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cmVhdGVDb2xvciB9IGZyb20gJy4uL2ltYWdlL2NvbG9yLmpzJ1xyXG5pbXBvcnQgeyBjcmVhdGVJbWFnZSB9IGZyb20gJy4uL2ltYWdlL2NyZWF0ZS5qcydcclxuaW1wb3J0IHsgVDMgfSBmcm9tICcuLi90eXBlcy5qcydcclxuaW1wb3J0IHsgUG9pbnQzIH0gZnJvbSAnLi4vdm94ZWwvdHlwZXMuanMnXHJcbmltcG9ydCB7IEhlaWdodG1hcCB9IGZyb20gJy4vdHlwZXMuanMnXHJcblxyXG5leHBvcnQgY29uc3QgZW5xdWV1ZU5laWdoYm91cnMgPSAoXHJcbiAgcTogVDNbXSwgeDogbnVtYmVyLCB5OiBudW1iZXIsIHBhcmVudFY6IG51bWJlclxyXG4pID0+IHtcclxuICBxLnB1c2goW3ggLSAxLCB5LCBwYXJlbnRWXSlcclxuICBxLnB1c2goW3ggKyAxLCB5LCBwYXJlbnRWXSlcclxuICBxLnB1c2goW3gsIHkgLSAxLCBwYXJlbnRWXSlcclxuICBxLnB1c2goW3gsIHkgKyAxLCBwYXJlbnRWXSlcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IG1pbkhlaWdodCA9IChoZWlnaHRtYXA6IEhlaWdodG1hcCkgPT4gTWF0aC5taW4oLi4uaGVpZ2h0bWFwLmRhdGEpXHJcblxyXG5leHBvcnQgY29uc3QgbWF4SGVpZ2h0ID0gKGhlaWdodG1hcDogSGVpZ2h0bWFwKSA9PiBNYXRoLm1heCguLi5oZWlnaHRtYXAuZGF0YSlcclxuXHJcbmV4cG9ydCBjb25zdCBoZWlnaHRtYXBUb0ltYWdlRGF0YSA9IChoZWlnaHRtYXA6IEhlaWdodG1hcCwgaXNTY2FsZWQgPSBmYWxzZSkgPT4ge1xyXG4gIGNvbnN0IHsgd2lkdGgsIGhlaWdodCwgZGF0YSB9ID0gaGVpZ2h0bWFwXHJcbiAgY29uc3Qgc2l6ZSA9IHdpZHRoICogaGVpZ2h0XHJcblxyXG4gIGNvbnN0IGltZyA9IGNyZWF0ZUltYWdlKHdpZHRoLCBoZWlnaHQpXHJcbiAgY29uc3QgdmlldyA9IG5ldyBVaW50MzJBcnJheShpbWcuZGF0YS5idWZmZXIpXHJcblxyXG4gIGxldCBtaW4gPSAwXHJcbiAgbGV0IG1heCA9IDBcclxuICBsZXQgZGVsdGEgPSAwXHJcbiAgbGV0IHNjYWxlID0gMFxyXG5cclxuICBpZiAoaXNTY2FsZWQpIHtcclxuICAgIG1pbiA9IG1pbkhlaWdodChoZWlnaHRtYXApXHJcbiAgICBtYXggPSBtYXhIZWlnaHQoaGVpZ2h0bWFwKVxyXG4gICAgZGVsdGEgPSBtYXggLSBtaW5cclxuICAgIHNjYWxlID0gMjU1IC8gZGVsdGFcclxuICB9XHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7XHJcbiAgICBjb25zdCB2ID0gZGF0YVtpXVxyXG5cclxuICAgIGNvbnN0IHZhbHVlID0gaXNTY2FsZWQgPyBNYXRoLmZsb29yKCh2IC0gbWluKSAqIHNjYWxlKSA6IHZcclxuXHJcbiAgICB2aWV3W2ldID0gY3JlYXRlQ29sb3IodmFsdWUpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gaW1nXHJcbn1cclxuXHJcbi8vIG1ha2UgdGhlIGxvd2VzdCB2YWx1ZSA9PT0gMFxyXG5leHBvcnQgY29uc3Qgbm9ybWFsaXplSGVpZ2h0bWFwID0gKGhlaWdodG1hcDogSGVpZ2h0bWFwKSA9PiB7XHJcbiAgY29uc3QgbWluID0gbWluSGVpZ2h0KGhlaWdodG1hcClcclxuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIGRhdGEgfSA9IGhlaWdodG1hcFxyXG4gIGNvbnN0IHNpemUgPSB3aWR0aCAqIGhlaWdodFxyXG5cclxuICBjb25zdCByZXN1bHQ6IEhlaWdodG1hcCA9IHtcclxuICAgIHdpZHRoLFxyXG4gICAgaGVpZ2h0LFxyXG4gICAgZGF0YTogbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHNpemUpXHJcbiAgfVxyXG5cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykge1xyXG4gICAgcmVzdWx0LmRhdGFbaV0gPSBkYXRhW2ldIC0gbWluXHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzdWx0XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBoZWlnaHRtYXBUb1BvaW50MyA9IChoZWlnaHRtYXA6IEhlaWdodG1hcCk6IFBvaW50M1tdID0+IHtcclxuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIGRhdGEgfSA9IGhlaWdodG1hcFxyXG5cclxuICBjb25zdCB2b3g6IFBvaW50M1tdID0gW11cclxuXHJcbiAgZm9yIChsZXQgc3kgPSAwOyBzeSA8IGhlaWdodDsgc3krKykge1xyXG4gICAgY29uc3Qgcm93U3RhcnQgPSBzeSAqIHdpZHRoXHJcbiAgICBjb25zdCBkeiA9IGhlaWdodCAtIDEgLSBzeVxyXG5cclxuICAgIGZvciAobGV0IHN4ID0gMDsgc3ggPCB3aWR0aDsgc3grKykge1xyXG4gICAgICBjb25zdCBpID0gcm93U3RhcnQgKyBzeFxyXG4gICAgICBjb25zdCBkeCA9IHN4XHJcbiAgICAgIGNvbnN0IGR5ID0gZGF0YVtpXVxyXG5cclxuICAgICAgdm94LnB1c2goW2R4LCBkeSwgZHpdKVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHZveFxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgaGVpZ2h0bWFwVG9TdHJpbmcgPSAoaGVpZ2h0bWFwOiBIZWlnaHRtYXApID0+IHtcclxuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIGRhdGEgfSA9IGhlaWdodG1hcFxyXG5cclxuICBjb25zdCByb3dzOiBzdHJpbmdbXSA9IFtdXHJcblxyXG4gIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHtcclxuICAgIGNvbnN0IHJvd1N0YXJ0ID0geSAqIHdpZHRoXHJcbiAgICBsZXQgcm93ID0gJydcclxuXHJcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHtcclxuICAgICAgY29uc3QgaSA9IHJvd1N0YXJ0ICsgeFxyXG5cclxuICAgICAgcm93ICs9IGRhdGFbaV0udG9TdHJpbmcoKS5wYWRTdGFydCg0LCAnICcpXHJcbiAgICB9XHJcblxyXG4gICAgcm93cy5wdXNoKHJvdylcclxuICB9XHJcblxyXG4gIHJldHVybiByb3dzLmpvaW4oJ1xcbicpXHJcbn1cclxuIl19