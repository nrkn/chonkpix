import { createColor } from '../image/color.js';
import { createImage } from '../image/create.js';
export const enqueueNeighbours = (q, x, y, parentV) => {
    q.push([x - 1, y, parentV]);
    q.push([x + 1, y, parentV]);
    q.push([x, y - 1, parentV]);
    q.push([x, y + 1, parentV]);
};
export const minHeight = (heightmap) => Math.min(...heightmap.data);
export const maxHeight = (heightmap) => Math.max(...heightmap.data);
export const hmU8ToImageData = (heightmap, isScaled = false) => {
    const { width, height, data } = heightmap;
    const size = width * height;
    const img = createImage(width, height);
    const view = new Uint32Array(img.data.buffer);
    let min = 0;
    let max = 0;
    let delta = 0;
    let scale = 0;
    if (isScaled) {
        min = minHeight(heightmap);
        max = maxHeight(heightmap);
        delta = max - min;
        scale = 255 / delta;
    }
    for (let i = 0; i < size; i++) {
        const v = data[i];
        const value = isScaled ? Math.floor((v - min) * scale) : v;
        view[i] = createColor(value);
    }
    return img;
};
// make the lowest value === 0
export const normalizeHmU8C = (heightmap) => {
    const min = minHeight(heightmap);
    const { width, height, data } = heightmap;
    const size = width * height;
    const result = {
        width,
        height,
        data: new Uint8ClampedArray(size)
    };
    for (let i = 0; i < size; i++) {
        result.data[i] = data[i] - min;
    }
    return result;
};
export const heightmapToPoint3 = (heightmap) => {
    const { width, height, data } = heightmap;
    const vox = [];
    for (let sy = 0; sy < height; sy++) {
        const rowStart = sy * width;
        const dz = height - 1 - sy;
        for (let sx = 0; sx < width; sx++) {
            const i = rowStart + sx;
            const dx = sx;
            const dy = data[i];
            vox.push([dx, dy, dz]);
        }
    }
    return vox;
};
export const heightmapToString = (heightmap, cellW = 4) => {
    const { width, height, data } = heightmap;
    const rows = [];
    for (let y = 0; y < height; y++) {
        const rowStart = y * width;
        let row = '';
        for (let x = 0; x < width; x++) {
            const i = rowStart + x;
            row += data[i].toString().padStart(cellW, ' ');
        }
        rows.push(row);
    }
    return rows.join('\n');
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvaGVpZ2h0bWFwL3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1CQUFtQixDQUFBO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUtoRCxNQUFNLENBQUMsTUFBTSxpQkFBaUIsR0FBRyxDQUMvQixDQUFPLEVBQUUsQ0FBUyxFQUFFLENBQVMsRUFBRSxPQUFlLEVBQzlDLEVBQUU7SUFDRixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtBQUM3QixDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxTQUF1QixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBRWpGLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxDQUFDLFNBQXVCLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUE7QUFFakYsTUFBTSxDQUFDLE1BQU0sZUFBZSxHQUFHLENBQzdCLFNBQW9ELEVBQ3BELFFBQVEs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dGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDb2xvciB9IGZyb20gJy4uL2ltYWdlL2NvbG9yLmpzJ1xyXG5pbXBvcnQgeyBjcmVhdGVJbWFnZSB9IGZyb20gJy4uL2ltYWdlL2NyZWF0ZS5qcydcclxuaW1wb3J0IHsgVDMgfSBmcm9tICcuLi90eXBlcy5qcydcclxuaW1wb3J0IHsgUG9pbnQzIH0gZnJvbSAnLi4vdm94ZWwvdHlwZXMuanMnXHJcbmltcG9ydCB7IEhlaWdodG1hcCwgSGVpZ2h0bWFwQW55IH0gZnJvbSAnLi90eXBlcy5qcydcclxuXHJcbmV4cG9ydCBjb25zdCBlbnF1ZXVlTmVpZ2hib3VycyA9IChcclxuICBxOiBUM1tdLCB4OiBudW1iZXIsIHk6IG51bWJlciwgcGFyZW50VjogbnVtYmVyXHJcbikgPT4ge1xyXG4gIHEucHVzaChbeCAtIDEsIHksIHBhcmVudFZdKVxyXG4gIHEucHVzaChbeCArIDEsIHksIHBhcmVudFZdKVxyXG4gIHEucHVzaChbeCwgeSAtIDEsIHBhcmVudFZdKVxyXG4gIHEucHVzaChbeCwgeSArIDEsIHBhcmVudFZdKVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgbWluSGVpZ2h0ID0gKGhlaWdodG1hcDogSGVpZ2h0bWFwQW55KSA9PiBNYXRoLm1pbiguLi5oZWlnaHRtYXAuZGF0YSlcclxuXHJcbmV4cG9ydCBjb25zdCBtYXhIZWlnaHQgPSAoaGVpZ2h0bWFwOiBIZWlnaHRtYXBBbnkpID0+IE1hdGgubWF4KC4uLmhlaWdodG1hcC5kYXRhKVxyXG5cclxuZXhwb3J0IGNvbnN0IGhtVThUb0ltYWdlRGF0YSA9IChcclxuICBoZWlnaHRtYXA6IEhlaWdodG1hcDxVaW50OENsYW1wZWRBcnJheSB8IFVpbnQ4QXJyYXk+LFxyXG4gIGlzU2NhbGVkID0gZmFsc2VcclxuKSA9PiB7XHJcbiAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0LCBkYXRhIH0gPSBoZWlnaHRtYXBcclxuICBjb25zdCBzaXplID0gd2lkdGggKiBoZWlnaHRcclxuXHJcbiAgY29uc3QgaW1nID0gY3JlYXRlSW1hZ2Uod2lkdGgsIGhlaWdodClcclxuICBjb25zdCB2aWV3ID0gbmV3IFVpbnQzMkFycmF5KGltZy5kYXRhLmJ1ZmZlcilcclxuXHJcbiAgbGV0IG1pbiA9IDBcclxuICBsZXQgbWF4ID0gMFxyXG4gIGxldCBkZWx0YSA9IDBcclxuICBsZXQgc2NhbGUgPSAwXHJcblxyXG4gIGlmIChpc1NjYWxlZCkge1xyXG4gICAgbWluID0gbWluSGVpZ2h0KGhlaWdodG1hcClcclxuICAgIG1heCA9IG1heEhlaWdodChoZWlnaHRtYXApXHJcbiAgICBkZWx0YSA9IG1heCAtIG1pblxyXG4gICAgc2NhbGUgPSAyNTUgLyBkZWx0YVxyXG4gIH1cclxuXHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcclxuICAgIGNvbnN0IHYgPSBkYXRhW2ldXHJcblxyXG4gICAgY29uc3QgdmFsdWUgPSBpc1NjYWxlZCA/IE1hdGguZmxvb3IoKHYgLSBtaW4pICogc2NhbGUpIDogdlxyXG5cclxuICAgIHZpZXdbaV0gPSBjcmVhdGVDb2xvcih2YWx1ZSlcclxuICB9XHJcblxyXG4gIHJldHVybiBpbWdcclxufVxyXG5cclxuLy8gbWFrZSB0aGUgbG93ZXN0IHZhbHVlID09PSAwXHJcbmV4cG9ydCBjb25zdCBub3JtYWxpemVIbVU4QyA9IChoZWlnaHRtYXA6IEhlaWdodG1hcCkgPT4ge1xyXG4gIGNvbnN0IG1pbiA9IG1pbkhlaWdodChoZWlnaHRtYXApXHJcbiAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0LCBkYXRhIH0gPSBoZWlnaHRtYXBcclxuICBjb25zdCBzaXplID0gd2lkdGggKiBoZWlnaHRcclxuXHJcbiAgY29uc3QgcmVzdWx0OiBIZWlnaHRtYXAgPSB7XHJcbiAgICB3aWR0aCxcclxuICAgIGhlaWdodCxcclxuICAgIGRhdGE6IG5ldyBVaW50OENsYW1wZWRBcnJheShzaXplKVxyXG4gIH1cclxuXHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcclxuICAgIHJlc3VsdC5kYXRhW2ldID0gZGF0YVtpXSAtIG1pblxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlc3VsdFxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgaGVpZ2h0bWFwVG9Qb2ludDMgPSAoaGVpZ2h0bWFwOiBIZWlnaHRtYXBBbnkpOiBQb2ludDNbXSA9PiB7XHJcbiAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0LCBkYXRhIH0gPSBoZWlnaHRtYXBcclxuXHJcbiAgY29uc3Qgdm94OiBQb2ludDNbXSA9IFtdXHJcblxyXG4gIGZvciAobGV0IHN5ID0gMDsgc3kgPCBoZWlnaHQ7IHN5KyspIHtcclxuICAgIGNvbnN0IHJvd1N0YXJ0ID0gc3kgKiB3aWR0aFxyXG4gICAgY29uc3QgZHogPSBoZWlnaHQgLSAxIC0gc3lcclxuXHJcbiAgICBmb3IgKGxldCBzeCA9IDA7IHN4IDwgd2lkdGg7IHN4KyspIHtcclxuICAgICAgY29uc3QgaSA9IHJvd1N0YXJ0ICsgc3hcclxuICAgICAgY29uc3QgZHggPSBzeFxyXG4gICAgICBjb25zdCBkeSA9IGRhdGFbaV1cclxuXHJcbiAgICAgIHZveC5wdXNoKFtkeCwgZHksIGR6XSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiB2b3hcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGhlaWdodG1hcFRvU3RyaW5nID0gKGhlaWdodG1hcDogSGVpZ2h0bWFwQW55LCBjZWxsVyA9IDQpID0+IHtcclxuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIGRhdGEgfSA9IGhlaWdodG1hcFxyXG5cclxuICBjb25zdCByb3dzOiBzdHJpbmdbXSA9IFtdXHJcblxyXG4gIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHtcclxuICAgIGNvbnN0IHJvd1N0YXJ0ID0geSAqIHdpZHRoXHJcbiAgICBsZXQgcm93ID0gJydcclxuXHJcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHtcclxuICAgICAgY29uc3QgaSA9IHJvd1N0YXJ0ICsgeFxyXG5cclxuICAgICAgcm93ICs9IGRhdGFbaV0udG9TdHJpbmcoKS5wYWRTdGFydChjZWxsVywgJyAnKVxyXG4gICAgfVxyXG5cclxuICAgIHJvd3MucHVzaChyb3cpXHJcbiAgfVxyXG5cclxuICByZXR1cm4gcm93cy5qb2luKCdcXG4nKVxyXG59XHJcbiJdfQ==