import { createColor } from '../image/color.js';
import { createImage } from '../image/create.js';
export const enqueueNeighbours = (q, x, y, parentV) => {
    q.push([x - 1, y, parentV]);
    q.push([x + 1, y, parentV]);
    q.push([x, y - 1, parentV]);
    q.push([x, y + 1, parentV]);
};
export const minHeight = (heightmap) => Math.min(...heightmap.data);
export const maxHeight = (heightmap) => Math.max(...heightmap.data);
export const heightmapToImageData = (heightmap, isScaled = false) => {
    const { width, height, data } = heightmap;
    const size = width * height;
    const img = createImage(width, height);
    const view = new Uint32Array(img.data.buffer);
    let min = 0;
    let max = 0;
    let delta = 0;
    let scale = 0;
    if (isScaled) {
        min = minHeight(heightmap);
        max = maxHeight(heightmap);
        delta = max - min;
        scale = 255 / delta;
    }
    for (let i = 0; i < size; i++) {
        const v = data[i];
        const value = isScaled ? Math.floor((v - min) * scale) : v;
        view[i] = createColor(value);
    }
    return img;
};
// make the lowest value === 0
export const normalizeHeightmap = (heightmap) => {
    const min = minHeight(heightmap);
    const { width, height, data } = heightmap;
    const size = width * height;
    const result = {
        width,
        height,
        data: new Uint8ClampedArray(size)
    };
    for (let i = 0; i < size; i++) {
        result.data[i] = data[i] - min;
    }
    return result;
};
export const heightmapToPoint3 = (heightmap) => {
    const { width, height, data } = heightmap;
    const vox = [];
    for (let sy = 0; sy < height; sy++) {
        const rowStart = sy * width;
        const dz = height - 1 - sy;
        for (let sx = 0; sx < width; sx++) {
            const i = rowStart + sx;
            const dx = sx;
            const dy = data[i];
            vox.push([dx, dy, dz]);
        }
    }
    return vox;
};
export const heightmapToString = (heightmap) => {
    const { width, height, data } = heightmap;
    const rows = [];
    for (let y = 0; y < height; y++) {
        const rowStart = y * width;
        let row = '';
        for (let x = 0; x < width; x++) {
            const i = rowStart + x;
            row += data[i].toString().padStart(4, ' ');
        }
        rows.push(row);
    }
    return rows.join('\n');
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvaGVpZ2h0bWFwL3V0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLG1CQUFtQixDQUFBO0FBQy9DLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQTtBQUtoRCxNQUFNLENBQUMsTUFBTSxpQkFBaUIsR0FBRyxDQUMvQixDQUFPLEVBQUUsQ0FBUyxFQUFFLENBQVMsRUFBRSxPQUFlLEVBQzlDLEVBQUU7SUFDRixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtJQUMzQixDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQTtBQUM3QixDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxTQUFvQixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBRTlFLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxDQUFDLFNBQW9CLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUE7QUFFOUUsTUFBTSxDQUFDLE1BQU0sb0JBQW9CLEdBQUcsQ0FBQyxTQUFvQixFQUFFLFFBQVEs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cmVhdGVDb2xvciB9IGZyb20gJy4uL2ltYWdlL2NvbG9yLmpzJ1xuaW1wb3J0IHsgY3JlYXRlSW1hZ2UgfSBmcm9tICcuLi9pbWFnZS9jcmVhdGUuanMnXG5pbXBvcnQgeyBUMyB9IGZyb20gJy4uL3R5cGVzLmpzJ1xuaW1wb3J0IHsgUG9pbnQzIH0gZnJvbSAnLi4vdm94ZWwvdHlwZXMuanMnXG5pbXBvcnQgeyBIZWlnaHRtYXAgfSBmcm9tICcuL3R5cGVzLmpzJ1xuXG5leHBvcnQgY29uc3QgZW5xdWV1ZU5laWdoYm91cnMgPSAoXG4gIHE6IFQzW10sIHg6IG51bWJlciwgeTogbnVtYmVyLCBwYXJlbnRWOiBudW1iZXJcbikgPT4ge1xuICBxLnB1c2goW3ggLSAxLCB5LCBwYXJlbnRWXSlcbiAgcS5wdXNoKFt4ICsgMSwgeSwgcGFyZW50Vl0pXG4gIHEucHVzaChbeCwgeSAtIDEsIHBhcmVudFZdKVxuICBxLnB1c2goW3gsIHkgKyAxLCBwYXJlbnRWXSlcbn1cblxuZXhwb3J0IGNvbnN0IG1pbkhlaWdodCA9IChoZWlnaHRtYXA6IEhlaWdodG1hcCkgPT4gTWF0aC5taW4oLi4uaGVpZ2h0bWFwLmRhdGEpXG5cbmV4cG9ydCBjb25zdCBtYXhIZWlnaHQgPSAoaGVpZ2h0bWFwOiBIZWlnaHRtYXApID0+IE1hdGgubWF4KC4uLmhlaWdodG1hcC5kYXRhKVxuXG5leHBvcnQgY29uc3QgaGVpZ2h0bWFwVG9JbWFnZURhdGEgPSAoaGVpZ2h0bWFwOiBIZWlnaHRtYXAsIGlzU2NhbGVkID0gZmFsc2UpID0+IHtcbiAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0LCBkYXRhIH0gPSBoZWlnaHRtYXBcbiAgY29uc3Qgc2l6ZSA9IHdpZHRoICogaGVpZ2h0XG5cbiAgY29uc3QgaW1nID0gY3JlYXRlSW1hZ2Uod2lkdGgsIGhlaWdodClcbiAgY29uc3QgdmlldyA9IG5ldyBVaW50MzJBcnJheShpbWcuZGF0YS5idWZmZXIpXG5cbiAgbGV0IG1pbiA9IDBcbiAgbGV0IG1heCA9IDBcbiAgbGV0IGRlbHRhID0gMFxuICBsZXQgc2NhbGUgPSAwXG5cbiAgaWYgKGlzU2NhbGVkKSB7XG4gICAgbWluID0gbWluSGVpZ2h0KGhlaWdodG1hcClcbiAgICBtYXggPSBtYXhIZWlnaHQoaGVpZ2h0bWFwKVxuICAgIGRlbHRhID0gbWF4IC0gbWluXG4gICAgc2NhbGUgPSAyNTUgLyBkZWx0YVxuICB9XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcbiAgICBjb25zdCB2ID0gZGF0YVtpXVxuXG4gICAgY29uc3QgdmFsdWUgPSBpc1NjYWxlZCA/IE1hdGguZmxvb3IoKHYgLSBtaW4pICogc2NhbGUpIDogdlxuXG4gICAgdmlld1tpXSA9IGNyZWF0ZUNvbG9yKHZhbHVlKVxuICB9XG5cbiAgcmV0dXJuIGltZ1xufVxuXG4vLyBtYWtlIHRoZSBsb3dlc3QgdmFsdWUgPT09IDBcbmV4cG9ydCBjb25zdCBub3JtYWxpemVIZWlnaHRtYXAgPSAoaGVpZ2h0bWFwOiBIZWlnaHRtYXApID0+IHtcbiAgY29uc3QgbWluID0gbWluSGVpZ2h0KGhlaWdodG1hcClcbiAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0LCBkYXRhIH0gPSBoZWlnaHRtYXBcbiAgY29uc3Qgc2l6ZSA9IHdpZHRoICogaGVpZ2h0XG5cbiAgY29uc3QgcmVzdWx0OiBIZWlnaHRtYXAgPSB7XG4gICAgd2lkdGgsXG4gICAgaGVpZ2h0LFxuICAgIGRhdGE6IG5ldyBVaW50OENsYW1wZWRBcnJheShzaXplKVxuICB9XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcbiAgICByZXN1bHQuZGF0YVtpXSA9IGRhdGFbaV0gLSBtaW5cbiAgfVxuXG4gIHJldHVybiByZXN1bHRcbn1cblxuZXhwb3J0IGNvbnN0IGhlaWdodG1hcFRvUG9pbnQzID0gKGhlaWdodG1hcDogSGVpZ2h0bWFwKTogUG9pbnQzW10gPT4ge1xuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIGRhdGEgfSA9IGhlaWdodG1hcFxuXG4gIGNvbnN0IHZveDogUG9pbnQzW10gPSBbXVxuXG4gIGZvciAobGV0IHN5ID0gMDsgc3kgPCBoZWlnaHQ7IHN5KyspIHtcbiAgICBjb25zdCByb3dTdGFydCA9IHN5ICogd2lkdGhcbiAgICBjb25zdCBkeiA9IGhlaWdodCAtIDEgLSBzeVxuXG4gICAgZm9yIChsZXQgc3ggPSAwOyBzeCA8IHdpZHRoOyBzeCsrKSB7XG4gICAgICBjb25zdCBpID0gcm93U3RhcnQgKyBzeFxuICAgICAgY29uc3QgZHggPSBzeFxuICAgICAgY29uc3QgZHkgPSBkYXRhW2ldXG5cbiAgICAgIHZveC5wdXNoKFtkeCwgZHksIGR6XSlcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdm94XG59XG5cbmV4cG9ydCBjb25zdCBoZWlnaHRtYXBUb1N0cmluZyA9IChoZWlnaHRtYXA6IEhlaWdodG1hcCkgPT4ge1xuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIGRhdGEgfSA9IGhlaWdodG1hcFxuXG4gIGNvbnN0IHJvd3M6IHN0cmluZ1tdID0gW11cblxuICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7XG4gICAgY29uc3Qgcm93U3RhcnQgPSB5ICogd2lkdGhcbiAgICBsZXQgcm93ID0gJydcblxuICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7IHgrKykge1xuICAgICAgY29uc3QgaSA9IHJvd1N0YXJ0ICsgeFxuXG4gICAgICByb3cgKz0gZGF0YVtpXS50b1N0cmluZygpLnBhZFN0YXJ0KDQsICcgJylcbiAgICB9XG5cbiAgICByb3dzLnB1c2gocm93KVxuICB9XG5cbiAgcmV0dXJuIHJvd3Muam9pbignXFxuJylcbn1cbiJdfQ==