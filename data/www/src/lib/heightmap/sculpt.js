import { clampRect } from '../image/util.js';
import { enqueueNeighbours } from './util.js';
export const raise = (heightmap, x, y) => {
    const { width, height, data } = heightmap;
    const i = y * width + x;
    const v = data[i] + 1;
    if (v > 255)
        return;
    data[i] = v;
    const queue = [];
    enqueueNeighbours(queue, x, y, v);
    while (queue.length) {
        const [nx, ny, nv] = queue.shift();
        if (nx < 0 || nx >= width || ny < 0 || ny >= height) {
            continue;
        }
        const n = ny * width + nx;
        if (data[n] >= nv) {
            continue;
        }
        if (data[n] === nv - 1) {
            continue;
        }
        data[n] = nv - 1;
        enqueueNeighbours(queue, nx, ny, nv - 1);
    }
};
export const lower = (heightmap, x, y) => {
    const { width, height, data } = heightmap;
    const i = y * width + x;
    const v = data[i] - 1;
    if (v < 0)
        return;
    data[i] = v;
    const queue = [];
    enqueueNeighbours(queue, x, y, v);
    while (queue.length) {
        const [nx, ny, nv] = queue.shift();
        if (nx < 0 || nx >= width || ny < 0 || ny >= height) {
            continue;
        }
        const n = ny * width + nx;
        if (data[n] <= nv) {
            continue;
        }
        if (data[n] === nv + 1) {
            continue;
        }
        data[n] = nv + 1;
        enqueueNeighbours(queue, nx, ny, nv + 1);
    }
};
// raise every point in rect to highest value in rect
export const raiseRect = (heightmap, x, y, w, h) => {
    let highest = 0;
    // find highest value in rect
    for (let j = y; j < y + h; j++) {
        if (j < 0 || j >= heightmap.height)
            continue;
        const rowStart = j * heightmap.width;
        for (let i = x; i < x + w; i++) {
            if (i < 0 || i >= heightmap.width)
                continue;
            const index = rowStart + i;
            const v = heightmap.data[index];
            if (v > highest)
                highest = v;
        }
    }
    // for each point in rect < highest, raise until matches highest
    for (let j = y; j < y + h; j++) {
        if (j < 0 || j >= heightmap.height)
            continue;
        const rowStart = j * heightmap.width;
        for (let i = x; i < x + w; i++) {
            if (i < 0 || i >= heightmap.width)
                continue;
            const index = rowStart + i;
            let v = heightmap.data[index];
            while (v < highest) {
                raise(heightmap, i, j);
                v++;
            }
        }
    }
    return highest;
};
// lower every point in rect to lowest value in rect
export const lowerRect = (heightmap, x, y, w, h) => {
    let lowest = 255;
    // find lowest value in rect
    for (let j = y; j < y + h; j++) {
        if (j < 0 || j >= heightmap.height)
            continue;
        const rowStart = j * heightmap.width;
        for (let i = x; i < x + w; i++) {
            if (i < 0 || i >= heightmap.width)
                continue;
            const index = rowStart + i;
            const v = heightmap.data[index];
            if (v < lowest)
                lowest = v;
        }
    }
    // for each point in rect > lowest, lower until matches lowest
    for (let j = y; j < y + h; j++) {
        if (j < 0 || j >= heightmap.height)
            continue;
        const rowStart = j * heightmap.width;
        for (let i = x; i < x + w; i++) {
            if (i < 0 || i >= heightmap.width)
                continue;
            const index = rowStart + i;
            let v = heightmap.data[index];
            while (v > lowest) {
                lower(heightmap, i, j);
                v--;
            }
        }
    }
    return lowest;
};
// average the values in the rect, then raise or lower each point to match
export const flattenRect = (heightmap, x, y, w, h) => {
    let sum = 0;
    let count = 0;
    // sum values in rect
    for (let j = y; j < y + h; j++) {
        if (j < 0 || j >= heightmap.height)
            continue;
        const rowStart = j * heightmap.width;
        for (let i = x; i < x + w; i++) {
            if (i < 0 || i >= heightmap.width)
                continue;
            const index = rowStart + i;
            sum += heightmap.data[index];
            count++;
        }
    }
    const avg = Math.floor(sum / count);
    // for each point in rect, raise or lower to match avg
    for (let j = y; j < y + h; j++) {
        if (j < 0 || j >= heightmap.height)
            continue;
        const rowStart = j * heightmap.width;
        for (let i = x; i < x + w; i++) {
            if (i < 0 || i >= heightmap.width)
                continue;
            const index = rowStart + i;
            let v = heightmap.data[index];
            while (v < avg) {
                raise(heightmap, i, j);
                v++;
            }
            while (v > avg) {
                lower(heightmap, i, j);
                v--;
            }
        }
    }
    return avg;
};
export const smooth = (heightmap, rect, times) => {
    rect = clampRect(heightmap.width, heightmap.height, rect);
    const { width, height, data: srcData } = heightmap;
    const size = width * height;
    const result = {
        width,
        height,
        data: new Uint8ClampedArray(size)
    };
    const [sx, sy, sw, sh] = rect;
    for (let t = 0; t < times; t++) {
        for (let y = sy; y < sy + sh; y++) {
            for (let x = sx; x < sx + sw; x++) {
                const i = y * width + x;
                let sum = srcData[i];
                let count = 1;
                if (x > 0) {
                    const l = i - 1;
                    sum += srcData[l];
                    count++;
                }
                if (x < width - 1) {
                    const r = i + 1;
                    sum += srcData[r];
                    count++;
                }
                if (y > 0) {
                    const u = i - width;
                    sum += srcData[u];
                    count++;
                }
                if (y < height - 1) {
                    const d = i + width;
                    sum += srcData[d];
                    count++;
                }
                result.data[i] = Math.floor(sum / count);
            }
        }
    }
    return result;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2N1bHB0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9oZWlnaHRtYXAvc2N1bHB0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUc1QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFFN0MsTUFBTSxDQUFDLE1BQU0sS0FBSyxHQUFHLENBQUMsU0FBb0IsRUFBRSxDQUFTLEVBQUUsQ0FBUyxFQUFFLEVBQUU7SUFDbEUsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsU0FBUyxDQUFBO0lBRXpDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFBO0lBRXZCLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUE7SUFFckIsSUFBSSxDQUFDLEdBQUcsR0FBRztRQUFFLE9BQU07SUFFbkIsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUVYLE1BQU0sS0FBSyxHQUErQixFQUFFLENBQUE7SUFFNUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFFakMsT0FBTyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDcEIsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLEtBQUssRUFBRyxDQUFBO1FBRW5DLElBQUksRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUksS0FBSyxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJLE1BQU0sRUFBRSxDQUFDO1lBQ3BELFNBQVE7UUFDVixDQUFDO1FBRUQsTUFBTSxDQUFDLEdBQUcsRUFBRSxHQUFHLEtBQUssR0FBRyxFQUFFLENB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QTtvQkFFZixHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO29CQUNqQixLQUFLLEVBQUUsQ0FBQTtnQkFDVCxDQUFDO2dCQUVELElBQUksQ0FBQyxHQUFHLEtBQUssR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDbEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtvQkFFZixHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO29CQUNqQixLQUFLLEVBQUUsQ0FBQTtnQkFDVCxDQUFDO2dCQUVELElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUNWLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUE7b0JBRW5CLEdBQUcsSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7b0JBQ2pCLEtBQUssRUFBRSxDQUFBO2dCQUNULENBQUM7Z0JBRUQsSUFBSSxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUNuQixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFBO29CQUVuQixHQUFHLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO29CQUNqQixLQUFLLEVBQUUsQ0FBQTtnQkFDVCxDQUFDO2dCQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUE7WUFDMUMsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0lBRUQsT0FBTyxNQUFNLENBQUE7QUFDZixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjbGFtcFJlY3QgfSBmcm9tICcuLi9pbWFnZS91dGlsLmpzJ1xyXG5pbXBvcnQgeyBUNCB9IGZyb20gJy4uL3R5cGVzLmpzJ1xyXG5pbXBvcnQgeyBIZWlnaHRtYXAgfSBmcm9tICcuL3R5cGVzLmpzJ1xyXG5pbXBvcnQgeyBlbnF1ZXVlTmVpZ2hib3VycyB9IGZyb20gJy4vdXRpbC5qcydcclxuXHJcbmV4cG9ydCBjb25zdCByYWlzZSA9IChoZWlnaHRtYXA6IEhlaWdodG1hcCwgeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IHtcclxuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIGRhdGEgfSA9IGhlaWdodG1hcFxyXG5cclxuICBjb25zdCBpID0geSAqIHdpZHRoICsgeFxyXG5cclxuICBjb25zdCB2ID0gZGF0YVtpXSArIDFcclxuXHJcbiAgaWYgKHYgPiAyNTUpIHJldHVyblxyXG5cclxuICBkYXRhW2ldID0gdlxyXG5cclxuICBjb25zdCBxdWV1ZTogW251bWJlciwgbnVtYmVyLCBudW1iZXJdW10gPSBbXVxyXG5cclxuICBlbnF1ZXVlTmVpZ2hib3VycyhxdWV1ZSwgeCwgeSwgdilcclxuXHJcbiAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkge1xyXG4gICAgY29uc3QgW254LCBueSwgbnZdID0gcXVldWUuc2hpZnQoKSFcclxuXHJcbiAgICBpZiAobnggPCAwIHx8IG54ID49IHdpZHRoIHx8IG55IDwgMCB8fCBueSA+PSBoZWlnaHQpIHtcclxuICAgICAgY29udGludWVcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBuID0gbnkgKiB3aWR0aCArIG54XHJcblxyXG4gICAgaWYgKGRhdGFbbl0gPj0gbnYpIHtcclxuICAgICAgY29udGludWVcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGF0YVtuXSA9PT0gbnYgLSAxKSB7XHJcbiAgICAgIGNvbnRpbnVlXHJcbiAgICB9XHJcblxyXG4gICAgZGF0YVtuXSA9IG52IC0gMVxyXG5cclxuICAgIGVucXVldWVOZWlnaGJvdXJzKHF1ZXVlLCBueCwgbnksIG52IC0gMSlcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBsb3dlciA9IChoZWlnaHRtYXA6IEhlaWdodG1hcCwgeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IHtcclxuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQsIGRhdGEgfSA9IGhlaWdodG1hcFxyXG5cclxuICBjb25zdCBpID0geSAqIHdpZHRoICsgeFxyXG5cclxuICBjb25zdCB2ID0gZGF0YVtpXSAtIDFcclxuXHJcbiAgaWYgKHYgPCAwKSByZXR1cm5cclxuXHJcbiAgZGF0YVtpXSA9IHZcclxuXHJcbiAgY29uc3QgcXVldWU6IFtudW1iZXIsIG51bWJlciwgbnVtYmVyXVtdID0gW11cclxuXHJcbiAgZW5xdWV1ZU5laWdoYm91cnMocXVldWUsIHgsIHksIHYpXHJcblxyXG4gIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHtcclxuICAgIGNvbnN0IFtueCwgbnksIG52XSA9IHF1ZXVlLnNoaWZ0KCkhXHJcblxyXG4gICAgaWYgKG54IDwgMCB8fCBueCA+PSB3aWR0aCB8fCBueSA8IDAgfHwgbnkgPj0gaGVpZ2h0KSB7XHJcbiAgICAgIGNvbnRpbnVlXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbiA9IG55ICogd2lkdGggKyBueFxyXG5cclxuICAgIGlmIChkYXRhW25dIDw9IG52KSB7XHJcbiAgICAgIGNvbnRpbnVlXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGRhdGFbbl0gPT09IG52ICsgMSkge1xyXG4gICAgICBjb250aW51ZVxyXG4gICAgfVxyXG5cclxuICAgIGRhdGFbbl0gPSBudiArIDFcclxuXHJcbiAgICBlbnF1ZXVlTmVpZ2hib3VycyhxdWV1ZSwgbngsIG55LCBudiArIDEpXHJcbiAgfVxyXG59XHJcblxyXG5cclxuLy8gcmFpc2UgZXZlcnkgcG9pbnQgaW4gcmVjdCB0byBoaWdoZXN0IHZhbHVlIGluIHJlY3RcclxuZXhwb3J0IGNvbnN0IHJhaXNlUmVjdCA9IChcclxuICBoZWlnaHRtYXA6IEhlaWdodG1hcCwgeDogbnVtYmVyLCB5OiBudW1iZXIsIHc6IG51bWJlciwgaDogbnVtYmVyXHJcbikgPT4ge1xyXG4gIGxldCBoaWdoZXN0ID0gMFxyXG5cclxuICAvLyBmaW5kIGhpZ2hlc3QgdmFsdWUgaW4gcmVjdFxyXG4gIGZvciAobGV0IGogPSB5OyBqIDwgeSArIGg7IGorKykge1xyXG4gICAgaWYgKGogPCAwIHx8IGogPj0gaGVpZ2h0bWFwLmhlaWdodCkgY29udGludWVcclxuXHJcbiAgICBjb25zdCByb3dTdGFydCA9IGogKiBoZWlnaHRtYXAud2lkdGhcclxuXHJcbiAgICBmb3IgKGxldCBpID0geDsgaSA8IHggKyB3OyBpKyspIHtcclxuICAgICAgaWYgKGkgPCAwIHx8IGkgPj0gaGVpZ2h0bWFwLndpZHRoKSBjb250aW51ZVxyXG5cclxuICAgICAgY29uc3QgaW5kZXggPSByb3dTdGFydCArIGlcclxuXHJcbiAgICAgIGNvbnN0IHYgPSBoZWlnaHRtYXAuZGF0YVtpbmRleF1cclxuXHJcbiAgICAgIGlmICh2ID4gaGlnaGVzdCkgaGlnaGVzdCA9IHZcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIGZvciBlYWNoIHBvaW50IGluIHJlY3QgPCBoaWdoZXN0LCByYWlzZSB1bnRpbCBtYXRjaGVzIGhpZ2hlc3RcclxuICBmb3IgKGxldCBqID0geTsgaiA8IHkgKyBoOyBqKyspIHtcclxuICAgIGlmIChqIDwgMCB8fCBqID49IGhlaWdodG1hcC5oZWlnaHQpIGNvbnRpbnVlXHJcblxyXG4gICAgY29uc3Qgcm93U3RhcnQgPSBqICogaGVpZ2h0bWFwLndpZHRoXHJcblxyXG4gICAgZm9yIChsZXQgaSA9IHg7IGkgPCB4ICsgdzsgaSsrKSB7XHJcbiAgICAgIGlmIChpIDwgMCB8fCBpID49IGhlaWdodG1hcC53aWR0aCkgY29udGludWVcclxuXHJcbiAgICAgIGNvbnN0IGluZGV4ID0gcm93U3RhcnQgKyBpXHJcblxyXG4gICAgICBsZXQgdiA9IGhlaWdodG1hcC5kYXRhW2luZGV4XVxyXG5cclxuICAgICAgd2hpbGUgKHYgPCBoaWdoZXN0KSB7XHJcbiAgICAgICAgcmFpc2UoaGVpZ2h0bWFwLCBpLCBqKVxyXG4gICAgICAgIHYrK1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gaGlnaGVzdFxyXG59XHJcblxyXG4vLyBsb3dlciBldmVyeSBwb2ludCBpbiByZWN0IHRvIGxvd2VzdCB2YWx1ZSBpbiByZWN0XHJcbmV4cG9ydCBjb25zdCBsb3dlclJlY3QgPSAoXHJcbiAgaGVpZ2h0bWFwOiBIZWlnaHRtYXAsIHg6IG51bWJlciwgeTogbnVtYmVyLCB3OiBudW1iZXIsIGg6IG51bWJlclxyXG4pID0+IHtcclxuICBsZXQgbG93ZXN0ID0gMjU1XHJcblxyXG4gIC8vIGZpbmQgbG93ZXN0IHZhbHVlIGluIHJlY3RcclxuICBmb3IgKGxldCBqID0geTsgaiA8IHkgKyBoOyBqKyspIHtcclxuICAgIGlmIChqIDwgMCB8fCBqID49IGhlaWdodG1hcC5oZWlnaHQpIGNvbnRpbnVlXHJcblxyXG4gICAgY29uc3Qgcm93U3RhcnQgPSBqICogaGVpZ2h0bWFwLndpZHRoXHJcblxyXG4gICAgZm9yIChsZXQgaSA9IHg7IGkgPCB4ICsgdzsgaSsrKSB7XHJcbiAgICAgIGlmIChpIDwgMCB8fCBpID49IGhlaWdodG1hcC53aWR0aCkgY29udGludWVcclxuXHJcbiAgICAgIGNvbnN0IGluZGV4ID0gcm93U3RhcnQgKyBpXHJcblxyXG4gICAgICBjb25zdCB2ID0gaGVpZ2h0bWFwLmRhdGFbaW5kZXhdXHJcblxyXG4gICAgICBpZiAodiA8IGxvd2VzdCkgbG93ZXN0ID0gdlxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gZm9yIGVhY2ggcG9pbnQgaW4gcmVjdCA+IGxvd2VzdCwgbG93ZXIgdW50aWwgbWF0Y2hlcyBsb3dlc3RcclxuICBmb3IgKGxldCBqID0geTsgaiA8IHkgKyBoOyBqKyspIHtcclxuICAgIGlmIChqIDwgMCB8fCBqID49IGhlaWdodG1hcC5oZWlnaHQpIGNvbnRpbnVlXHJcblxyXG4gICAgY29uc3Qgcm93U3RhcnQgPSBqICogaGVpZ2h0bWFwLndpZHRoXHJcblxyXG4gICAgZm9yIChsZXQgaSA9IHg7IGkgPCB4ICsgdzsgaSsrKSB7XHJcbiAgICAgIGlmIChpIDwgMCB8fCBpID49IGhlaWdodG1hcC53aWR0aCkgY29udGludWVcclxuXHJcbiAgICAgIGNvbnN0IGluZGV4ID0gcm93U3RhcnQgKyBpXHJcblxyXG4gICAgICBsZXQgdiA9IGhlaWdodG1hcC5kYXRhW2luZGV4XVxyXG5cclxuICAgICAgd2hpbGUgKHYgPiBsb3dlc3QpIHtcclxuICAgICAgICBsb3dlcihoZWlnaHRtYXAsIGksIGopXHJcbiAgICAgICAgdi0tXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBsb3dlc3RcclxufVxyXG5cclxuLy8gYXZlcmFnZSB0aGUgdmFsdWVzIGluIHRoZSByZWN0LCB0aGVuIHJhaXNlIG9yIGxvd2VyIGVhY2ggcG9pbnQgdG8gbWF0Y2hcclxuZXhwb3J0IGNvbnN0IGZsYXR0ZW5SZWN0ID0gKFxyXG4gIGhlaWdodG1hcDogSGVpZ2h0bWFwLCB4OiBudW1iZXIsIHk6IG51bWJlciwgdzogbnVtYmVyLCBoOiBudW1iZXJcclxuKSA9PiB7XHJcbiAgbGV0IHN1bSA9IDBcclxuICBsZXQgY291bnQgPSAwXHJcblxyXG4gIC8vIHN1bSB2YWx1ZXMgaW4gcmVjdFxyXG4gIGZvciAobGV0IGogPSB5OyBqIDwgeSArIGg7IGorKykge1xyXG4gICAgaWYgKGogPCAwIHx8IGogPj0gaGVpZ2h0bWFwLmhlaWdodCkgY29udGludWVcclxuXHJcbiAgICBjb25zdCByb3dTdGFydCA9IGogKiBoZWlnaHRtYXAud2lkdGhcclxuXHJcbiAgICBmb3IgKGxldCBpID0geDsgaSA8IHggKyB3OyBpKyspIHtcclxuICAgICAgaWYgKGkgPCAwIHx8IGkgPj0gaGVpZ2h0bWFwLndpZHRoKSBjb250aW51ZVxyXG5cclxuICAgICAgY29uc3QgaW5kZXggPSByb3dTdGFydCArIGlcclxuXHJcbiAgICAgIHN1bSArPSBoZWlnaHRtYXAuZGF0YVtpbmRleF1cclxuICAgICAgY291bnQrK1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3QgYXZnID0gTWF0aC5mbG9vcihzdW0gLyBjb3VudClcclxuXHJcbiAgLy8gZm9yIGVhY2ggcG9pbnQgaW4gcmVjdCwgcmFpc2Ugb3IgbG93ZXIgdG8gbWF0Y2ggYXZnXHJcbiAgZm9yIChsZXQgaiA9IHk7IGogPCB5ICsgaDsgaisrKSB7XHJcbiAgICBpZiAoaiA8IDAgfHwgaiA+PSBoZWlnaHRtYXAuaGVpZ2h0KSBjb250aW51ZVxyXG5cclxuICAgIGNvbnN0IHJvd1N0YXJ0ID0gaiAqIGhlaWdodG1hcC53aWR0aFxyXG5cclxuICAgIGZvciAobGV0IGkgPSB4OyBpIDwgeCArIHc7IGkrKykge1xyXG4gICAgICBpZiAoaSA8IDAgfHwgaSA+PSBoZWlnaHRtYXAud2lkdGgpIGNvbnRpbnVlXHJcblxyXG4gICAgICBjb25zdCBpbmRleCA9IHJvd1N0YXJ0ICsgaVxyXG5cclxuICAgICAgbGV0IHYgPSBoZWlnaHRtYXAuZGF0YVtpbmRleF1cclxuXHJcbiAgICAgIHdoaWxlICh2IDwgYXZnKSB7XHJcbiAgICAgICAgcmFpc2UoaGVpZ2h0bWFwLCBpLCBqKVxyXG4gICAgICAgIHYrK1xyXG4gICAgICB9XHJcbiAgICAgIHdoaWxlICh2ID4gYXZnKSB7XHJcbiAgICAgICAgbG93ZXIoaGVpZ2h0bWFwLCBpLCBqKVxyXG4gICAgICAgIHYtLVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gYXZnXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBzbW9vdGggPSAoXHJcbiAgaGVpZ2h0bWFwOiBIZWlnaHRtYXAsXHJcbiAgcmVjdDogVDQsXHJcbiAgdGltZXM6IG51bWJlclxyXG4pID0+IHtcclxuICByZWN0ID0gY2xhbXBSZWN0KGhlaWdodG1hcC53aWR0aCwgaGVpZ2h0bWFwLmhlaWdodCwgcmVjdClcclxuXHJcbiAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0LCBkYXRhOiBzcmNEYXRhIH0gPSBoZWlnaHRtYXBcclxuXHJcbiAgY29uc3Qgc2l6ZSA9IHdpZHRoICogaGVpZ2h0XHJcblxyXG4gIGNvbnN0IHJlc3VsdDogSGVpZ2h0bWFwID0ge1xyXG4gICAgd2lkdGgsXHJcbiAgICBoZWlnaHQsXHJcbiAgICBkYXRhOiBuZXcgVWludDhDbGFtcGVkQXJyYXkoc2l6ZSlcclxuICB9XHJcblxyXG4gIGNvbnN0IFtzeCwgc3ksIHN3LCBzaF0gPSByZWN0XHJcblxyXG4gIGZvciAobGV0IHQgPSAwOyB0IDwgdGltZXM7IHQrKykge1xyXG4gICAgZm9yIChsZXQgeSA9IHN5OyB5IDwgc3kgKyBzaDsgeSsrKSB7XHJcbiAgICAgIGZvciAobGV0IHggPSBzeDsgeCA8IHN4ICsgc3c7IHgrKykge1xyXG4gICAgICAgIGNvbnN0IGkgPSB5ICogd2lkdGggKyB4XHJcblxyXG4gICAgICAgIGxldCBzdW0gPSBzcmNEYXRhW2ldXHJcbiAgICAgICAgbGV0IGNvdW50ID0gMVxyXG5cclxuICAgICAgICBpZiAoeCA+IDApIHtcclxuICAgICAgICAgIGNvbnN0IGwgPSBpIC0gMVxyXG5cclxuICAgICAgICAgIHN1bSArPSBzcmNEYXRhW2xdXHJcbiAgICAgICAgICBjb3VudCsrXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoeCA8IHdpZHRoIC0gMSkge1xyXG4gICAgICAgICAgY29uc3QgciA9IGkgKyAxXHJcblxyXG4gICAgICAgICAgc3VtICs9IHNyY0RhdGFbcl1cclxuICAgICAgICAgIGNvdW50KytcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh5ID4gMCkge1xyXG4gICAgICAgICAgY29uc3QgdSA9IGkgLSB3aWR0aFxyXG5cclxuICAgICAgICAgIHN1bSArPSBzcmNEYXRhW3VdXHJcbiAgICAgICAgICBjb3VudCsrXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoeSA8IGhlaWdodCAtIDEpIHtcclxuICAgICAgICAgIGNvbnN0IGQgPSBpICsgd2lkdGhcclxuXHJcbiAgICAgICAgICBzdW0gKz0gc3JjRGF0YVtkXVxyXG4gICAgICAgICAgY291bnQrK1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVzdWx0LmRhdGFbaV0gPSBNYXRoLmZsb29yKHN1bSAvIGNvdW50KVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzdWx0XHJcbn1cclxuIl19