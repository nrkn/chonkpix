import { fontImageToPoints, layoutTextLine, textLayoutToIndices } from '../lib/bmpfont/layout.js';
import { getNeighboursAll, getNeighboursCardinal } from '../lib/geom/neighbours.js';
import { blit } from '../lib/image/blit.js';
import { createColor } from '../lib/image/color.js';
import { composite } from '../lib/image/composite.js';
import { fill, fillIndices } from '../lib/image/fill.js';
import { loadImage } from '../lib/image/load.js';
import { pick, randInt } from '../lib/random.js';
import { findSizeSlug, parseSizeSlug } from '../lib/slug.js';
import { animator } from '../lib/sprites/animator.js';
import { createTileSheet } from '../lib/sprites/index.js';
import { assrt, assrtInt, maybe } from '../lib/util.js';
const tileW = 16;
const tileH = 16;
const tileCx = Math.floor(tileW / 2);
const tileCy = Math.floor(tileH / 2);
const tileCols = 100;
const tileRows = 100;
const getTileMapRectId = (tileMap, col, row, now) => {
    const i = row * tileMap.width + col;
    const cell = tileMap.data[i];
    if (typeof cell === 'number')
        return cell;
    return cell(now);
};
const water = ['animation', 'water', [500, 0], [500, 1]];
const filled = ['static', 'filled', 2];
const grasses = ['variation', 'grass', 3, 5];
const rocks = ['variation', 'rock', 8, 3];
const trees = ['variation', 'tree', 11, 4];
const appleIcon = ['static', 'apple-icon', 15];
const heartIcon = ['static', 'heart-icon', 16];
const sands = ['variation', 'sand', 17, 3];
const hut = ['static', 'hut', 20];
const computer = ['static', 'computer', 21];
const printer = ['static', 'printer', 22];
const bed = ['static', 'bed', 23];
const hutFront = ['span', 'hut-front', 24, 3];
const empty = ['static', 'empty', 27];
const ruins = ['variation', 'ruins', 28, 3];
const mountains = ['variation', 'mountain', 31, 3];
const satellite = ['animation', 'satellite', [500, 34], [500, 35]];
const activePortal = ['animation', 'portal', [100, 36], [100, 37]];
const skeleton = ['static', 'skeleton', 38];
const keyIcon = ['static', 'key-icon', 39];
const diskIcon = ['static', 'disk-icon', 40];
const curcuitIcon = ['static', 'chip-icon', 41];
const halfTone = ['static', 'half-tone', 42];
const disabledPortal = ['static', 'disabled-satellite', 43];
const inactivePortal = ['static', 'inactive-satellite', 44];
const generateMap = (width, height) => {
    const size = width * height;
    const [_type, _name, ...waterFrames] = water;
    const waterAnim = animator(waterFrames);
    const tileMap = {
        width, height,
        data: Array(size).fill(waterAnim)
    };
    const blocking = new Set();
    const indexMap = new Map();
    const landCount = Math.floor(size * 0.7);
    const landIndices = new Set();
    const landIndicesArr = [];
    let landPlaced = 0;
    let currentLand = [Math.floor(width / 2), Math.floor(height / 2)];
    const canPlaceLand = ([x, y]) => {
        // leave edges clear for water
        if (x === 0)
            return false;
        if (y === 0)
            return false;
        if (x === width - 1)
            return false;
        if (y === height - 1)
            return false;
        const i = y * width + x;
        // can't already be land
        return !landIndices.has(i);
    };
    const maxTries = 100;
    const addLand = () => {
        let [lx, ly] = currentLand;
        let li = ly * width + lx;
        indexMap.set(li, [lx, ly]);
        landIndices.add(li);
        landIndicesArr.push(li);
        let tries = 0;
        let neighbours = getNeighboursCardinal(currentLand).filter(canPlaceLand);
        while (neighbours.length < 1) {
            const i = pick(landIndicesArr);
            const existingLand = assrt(indexMap.get(i), `Expected land at ${i}`);
            neighbours = getNeighboursCardinal(existingLand).filter(canPlaceLand);
            tries++;
            if (tries >= maxTries) {
                console.log('Failed to place land');
                return false;
            }
        }
        currentLand = pick(neighbours);
        return true;
    };
    while (landPlaced < landCount) {
        if (!addLand())
            break;
        landPlaced++;
    }
    const [, , grassStart, grassCount] = grasses;
    const [, , sandStart, sandCount] = sands;
    const [, , rockStart, rockCount] = rocks;
    const [, , treeStart, treeCount] = trees;
    const [, , ruinsStart, ruinsCount] = ruins;
    const [, , mountainStart, mountainCount] = mountains;
    const [, , hutIndex] = hut;
    const [, , skeletonIndex] = skeleton;
    for (const i of landIndices) {
        const grass = randInt(grassCount) + grassStart;
        tileMap.data[i] = grass;
    }
    for (const i of landIndices) {
        if (tileMap.data[i] === waterAnim)
            continue;
        const pt = assrt(indexMap.get(i), `Expected point at ${i}`);
        let seaNeighbours = 0;
        const neighbours = getNeighboursAll(pt);
        for (const n of neighbours) {
            const [nx, ny] = n;
            if (nx < 0 || nx >= width || ny < 0 || ny >= height)
                continue;
            const ni = ny * width + nx;
            if (tileMap.data[ni] === waterAnim)
                seaNeighbours++;
        }
        if (seaNeighbours > 0) {
            const sand = randInt(sandCount) + sandStart;
            tileMap.data[i] = sand;
            continue;
        }
        if (!randInt(10)) {
            const rock = randInt(rockCount) + rockStart;
            tileMap.data[i] = rock;
            continue;
        }
        if (!randInt(10)) {
            const tree = randInt(treeCount) + treeStart;
            tileMap.data[i] = tree;
            continue;
        }
        if (!randInt(100)) {
            const ruins = randInt(ruinsCount) + ruinsStart;
            tileMap.data[i] = ruins;
            continue;
        }
        if (!randInt(50)) {
            const mountain = randInt(mountainCount) + mountainStart;
            tileMap.data[i] = mountain;
            continue;
        }
        if (!randInt(500)) {
            tileMap.data[i] = hutIndex;
            continue;
        }
        if (!randInt(1000)) {
            tileMap.data[i] = skeletonIndex;
            continue;
        }
    }
    blocking.add(waterAnim);
    // trees
    for (let i = treeStart; i < treeStart + treeCount; i++) {
        blocking.add(i);
    }
    // mountains
    for (let i = mountainStart; i < mountainStart + mountainCount; i++) {
        blocking.add(i);
    }
    return { tileMap, blocking };
};
export const rangerScene = () => {
    let isActive = true;
    let tiles;
    let sprites;
    let font;
    let fontPts;
    let tileMap;
    let blocking;
    let playerAnimLeft;
    let playerAnimRight;
    let facing = 'right';
    let cameraX = 0;
    let cameraY = 0;
    const init = async (state) => {
        const tileSheet = await loadImage('scenes/ranger/tiles.png');
        tiles = createTileSheet(tileSheet, tileW, tileH);
        const spriteSheet = await loadImage('scenes/ranger/sprites.png');
        sprites = createTileSheet(spriteSheet, tileW, tileH);
        playerAnimRight = animator([[500, 0], [500, 1]]);
        playerAnimLeft = animator([[500, 2], [500, 3]]);
        const map = generateMap(tileCols, tileRows);
        tileMap = map.tileMap;
        blocking = map.blocking;
        cameraX = Math.floor(tileCols / 2);
        cameraY = Math.floor(tileRows / 2);
        font = await loadFontMono('EverexME_5x8');
        fontPts = fontImageToPoints(font);
    };
    const _io = (state) => {
        if (!isActive)
            return;
        const keys = state.getKeys();
        if (keys['Escape']) {
            state.setRunning(false);
            // consume the key
            keys['Escape'] = false;
            return;
        }
        const wheel = state.mouse.takeWheel();
        const zoom = state.view.getZoom();
        if (wheel < 0) {
            state.view.setZoom(zoom + 1);
        }
        else if (wheel > 0) {
            state.view.setZoom(zoom - 1);
        }
        const presses = state.getKeyPresses();
        let ocx = cameraX;
        let ocy = cameraY;
        for (const key of presses) {
            if (key.toLowerCase() === 'w' && cameraY > 0)
                cameraY--;
            if (key.toLowerCase() === 's' && cameraY < tileRows - 1)
                cameraY++;
            if (key.toLowerCase() === 'a' && cameraX > 0) {
                cameraX--;
                facing = 'left';
            }
            if (key.toLowerCase() === 'd' && cameraX < tileCols - 1) {
                cameraX++;
                facing = 'right';
            }
        }
        // consume all key presses
        presses.length = 0;
        // check blocking
        const cameraTile = tileMap.data[cameraY * tileCols + cameraX];
        if (blocking.has(cameraTile)) {
            cameraX = ocx;
            cameraY = ocy;
        }
    };
    const update = (state) => {
        _io(state);
        if (!maybe(tiles))
            throw Error('Expected tiles');
        if (!maybe(tileMap))
            throw Error('Expected tileMap');
        if (!maybe(blocking))
            throw Error('Expected blocking');
        if (!maybe(sprites))
            throw Error('Expected sprites');
        if (!maybe(playerAnimRight))
            throw Error('Expected playerAnimRight');
        if (!maybe(playerAnimLeft))
            throw Error('Expected playerAnimLeft');
        if (!maybe(font))
            throw Error('Expected font');
        if (!maybe(fontPts))
            throw Error('Expected fontPts');
        const buffer = state.view.getBuffer();
        const { width, height } = buffer;
        const elapsed = state.time.getElapsed();
        const cx = Math.floor(width / 2);
        const cy = Math.floor(height / 2);
        // we will center the view on the camera
        const availW = width - tileW;
        const availH = height - tileH;
        const colsPerSide = Math.ceil(availW / 2 / tileW);
        const rowsPerSide = Math.ceil(availH / 2 / tileH);
        const cols = colsPerSide * 2 + 1;
        const rows = rowsPerSide * 2 + 1;
        const leftCol = cameraX - colsPerSide;
        const topRow = cameraY - rowsPerSide;
        // in pixels relative to the view
        const vLeft = cx - colsPerSide * tileW - tileCx;
        const vTop = cy - rowsPerSide * tileH - tileCy;
        const playerRectIndex = assrt(facing === 'left' ? playerAnimLeft(elapsed) : playerAnimRight(elapsed), 'Expected player rect');
        const playerRect = sprites.rects[playerRectIndex];
        fill(buffer, createColor(0x00, 0x00, 0x00));
        for (let r = 0; r < rows; r++) {
            const row = topRow + r;
            if (row < 0 || row >= tileRows)
                continue;
            const vy = vTop + r * tileH;
            for (let c = 0; c < cols; c++) {
                const col = leftCol + c;
                if (col < 0 || col >= tileCols)
                    continue;
                const vx = vLeft + c * tileW;
                const tileIndex = row * tileCols + col;
                const cell = tileMap.data[tileIndex];
                const rectIndex = assrt(typeof cell === 'number' ? cell : cell(elapsed), `Expected rectIndex for cell ${cell}`);
                const rect = tiles.rects[rectIndex];
                blit(tiles.image, buffer, [...rect, vx, vy]);
                if (col === cameraX && row === cameraY) {
                    composite(sprites.image, buffer, [...playerRect, vx, vy]);
                }
            }
        }
        //
        const padding = 2;
        const frameTime = state.time.getFrameTime();
        const fps = Math.round(1000 / frameTime);
        const fpsText = `${fps} fps (${frameTime.toFixed(1)}ms)`;
        const fpsW = font.width * fpsText.length + padding * 2;
        const fpsH = font.height + padding * 2;
        const fpsX = width - fpsW - padding;
        const fpsY = padding;
        const fpsBg = createColor(0x00, 0x78, 0xd4);
        const fpsFg = createColor(0xff, 0xd7, 0x00);
        fill(buffer, fpsBg, [fpsX, fpsY, fpsW, fpsH]);
        const fpsLayout = layoutTextLine(font, fpsText);
        const fpsIndices = textLayoutToIndices(buffer, fpsX + padding, fpsY + padding, fontPts, fpsLayout);
        fillIndices(fpsIndices, buffer, fpsFg);
    };
    const quit = async (_state) => {
        tiles = null;
        tileMap = null;
        cameraX = 0;
        cameraY = 0;
    };
    const setActive = (value) => {
        isActive = value;
    };
    return { init, update, quit, setActive };
};
const fontPath = 'data';
const monoFontFiles = [
    'ATI_SmallW_6x8',
    'EverexME_5x8',
    'HP_100LX_6x8',
    'Portfolio_6x8',
    'TsengEVA_132_6x8',
    'IBM_EGA_8x8',
    'IBM_VGA_8x14',
    'IBM_VGA_8x16',
    'IBM_VGA_9x8',
    'IBM_VGA_9x14',
    'IBM_VGA_9x16'
];
const loadFontMono = async (name) => {
    const image = await loadImage(`${fontPath}/Bm437_${name}.png`);
    const sizeSlug = assrt(findSizeSlug(name), 'Expected size slug');
    const [width, height] = parseSizeSlug(sizeSlug);
    const cols = assrtInt(image.width / width);
    const rows = assrtInt(image.height / height);
    const font = {
        type: 'mono',
        width,
        height,
        leading: 0, // built into the bitmap glyphs
        image: image,
        rects: {},
        advance: 0, // built into the bitmap glyphs
        fallback: 127
    };
    for (let r = 0; r < rows; r++) {
        const rowIndex = r * cols;
        for (let c = 0; c < cols; c++) {
            const charCode = rowIndex + c;
            font.rects[charCode] = [c * width, r * height, width, height];
        }
    }
    return font;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmFuZ2VyLXNjZW5lLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3NjZW5lcy9yYW5nZXItc2NlbmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLGlCQUFpQixFQUFFLGNBQWMsRUFBRSxtQkFBbUIsRUFDdkQsTUFBTSwwQkFBMEIsQ0FBQTtBQUlqQyxPQUFPLEVBQ0wsZ0JBQWdCLEVBQUUscUJBQXFCLEVBQ3hDLE1BQU0sMkJBQTJCLENBQUE7QUFFbEMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHNCQUFzQixDQUFBO0FBQzNDLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQTtBQUNuRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sMkJBQTJCLENBQUE7QUFDckQsT0FBTyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQTtBQUN4RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sc0JBQXNCLENBQUE7QUFDaEQsT0FBTyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQTtBQUNoRCxPQUFPLEVBQUUsWUFBWSxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQzVELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQTtBQUNyRCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0seUJBQXlCLENBQUE7QUFHekQsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUE7QUFFdkQsTUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFBO0FBQ2hCLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQTtBQUVoQixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUNwQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUVwQyxNQUFNLFFBQVEsR0FBRyxHQUFHLENBQUE7QUFDcEIsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFBO0FBV3BCLE1BQU0sZ0JBQWdCLEdBQUcsQ0FDdkIsT0FBZ0IsRUFDaEIsR0FBVyxFQUFFLEdBQVcsRUFBRSxHQUFXLEVBQ3RCLEVBQUU7SUFDakIsTUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLE9BQU8sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFBO0lBQ25DLE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFFNUIsSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRO1FBQUUsT0FBTyxJQUFJLENBQUE7SUFFekMsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDbEIsQ0FBQyxDQUFBO0FBV0QsTUFBTSxLQUFLLEdBQWMsQ0FBQyxXQUFXLEVBQUUsT0FBTyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDbkUsTUFBTSxNQUFNLEdBQVcsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFBO0FBQzlDLE1BQU0sT0FBTyxHQUFjLENBQUMsV0FBVyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUE7QUFDdkQsTUFBTSxLQUFLLEdBQWMsQ0FBQyxXQUFXLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUNwRCxNQUFNLEtBQUssR0FBYyxDQUFDLFdBQVcsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFBO0FBQ3JELE1BQU0sU0FBUyxHQUFXLENBQUMsUUFBUSxFQUFFLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQTtBQUN0RCxNQUFNLFNBQVMsR0FBVyxDQUFDLFFBQVEsRUFBRSxZQUFZLEVBQUUsRUFBRSxDQUFDLENBQUE7QUFDdEQsTUFBTSxLQUFLLEdBQWMsQ0FBQyxXQUFXLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUNyRCxNQUFNLEdBQUcsR0FBVyxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUE7QUFDekMsTUFBTSxRQUFRLEdBQVcsQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLEVBQUUsQ0FBQyxDQUFBO0FBQ25ELE1BQU0sT0FBTyxHQUFXLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQTtBQUNqRCxNQUFNLEdBQUcsR0FBVyxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUE7QUFDekMsTUFBTSxRQUFRLEdBQUcsQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQVUsQ0FBQTtBQUN0RCxNQUFNLEtBQUssR0FBVyxDQUFDLFFBQVEsRUFBRSxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUE7QUFDN0MsTUFBTSxLQUFLLEdBQWMsQ0FBQyxXQUFXLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUN0RCxNQUFNLFNBQVMsR0FBYyxDQUFDLFdBQVcsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFBO0FBQzdELE1BQU0sU0FBUyxHQUFHLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBVSxDQUFBO0FBQzNFLE1BQU0sWUFBWSxHQUFHLENBQUMsV0FBVyxFQUFFLFFBQVEsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBVSxDQUFBO0FBQzNFLE1BQU0sUUFBUSxHQUFXLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSxFQUFFLENBQUMsQ0FBQTtBQUNuRCxNQUFNLE9BQU8sR0FBVyxDQUFDLFFBQVEsRUFB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K0JBQStCO1FBQzNDLFFBQVEsRUFBRSxHQUFHO0tBQ2QsQ0FBQTtJQUVELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUM5QixNQUFNLFFBQVEsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFBO1FBQ3pCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUM5QixNQUFNLFFBQVEsR0FBRyxRQUFRLEdBQUcsQ0FBQyxDQUFBO1lBRTdCLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQy9ELENBQUM7SUFDSCxDQUFDO0lBRUQsT0FBTyxJQUFJLENBQUE7QUFDYixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIGZvbnRJbWFnZVRvUG9pbnRzLCBsYXlvdXRUZXh0TGluZSwgdGV4dExheW91dFRvSW5kaWNlc1xyXG59IGZyb20gJy4uL2xpYi9ibXBmb250L2xheW91dC5qcydcclxuXHJcbmltcG9ydCB7IEJtcEZvbnRNLCBGb250UG9pbnRzIH0gZnJvbSAnLi4vbGliL2JtcGZvbnQvdHlwZXMuanMnXHJcblxyXG5pbXBvcnQge1xyXG4gIGdldE5laWdoYm91cnNBbGwsIGdldE5laWdoYm91cnNDYXJkaW5hbFxyXG59IGZyb20gJy4uL2xpYi9nZW9tL25laWdoYm91cnMuanMnXHJcblxyXG5pbXBvcnQgeyBibGl0IH0gZnJvbSAnLi4vbGliL2ltYWdlL2JsaXQuanMnXHJcbmltcG9ydCB7IGNyZWF0ZUNvbG9yIH0gZnJvbSAnLi4vbGliL2ltYWdlL2NvbG9yLmpzJ1xyXG5pbXBvcnQgeyBjb21wb3NpdGUgfSBmcm9tICcuLi9saWIvaW1hZ2UvY29tcG9zaXRlLmpzJ1xyXG5pbXBvcnQgeyBmaWxsLCBmaWxsSW5kaWNlcyB9IGZyb20gJy4uL2xpYi9pbWFnZS9maWxsLmpzJ1xyXG5pbXBvcnQgeyBsb2FkSW1hZ2UgfSBmcm9tICcuLi9saWIvaW1hZ2UvbG9hZC5qcydcclxuaW1wb3J0IHsgcGljaywgcmFuZEludCB9IGZyb20gJy4uL2xpYi9yYW5kb20uanMnXHJcbmltcG9ydCB7IGZpbmRTaXplU2x1ZywgcGFyc2VTaXplU2x1ZyB9IGZyb20gJy4uL2xpYi9zbHVnLmpzJ1xyXG5pbXBvcnQgeyBhbmltYXRvciB9IGZyb20gJy4uL2xpYi9zcHJpdGVzL2FuaW1hdG9yLmpzJ1xyXG5pbXBvcnQgeyBjcmVhdGVUaWxlU2hlZXQgfSBmcm9tICcuLi9saWIvc3ByaXRlcy9pbmRleC5qcydcclxuaW1wb3J0IHsgQW5pbWF0aW9uRnJhbWUsIFRpbGVTaGVldCB9IGZyb20gJy4uL2xpYi9zcHJpdGVzL3R5cGVzLmpzJ1xyXG5pbXBvcnQgeyBNYXliZSwgU2NlbmUsIFN0YXRlLCBUMiB9IGZyb20gJy4uL2xpYi90eXBlcy5qcydcclxuaW1wb3J0IHsgYXNzcnQsIGFzc3J0SW50LCBtYXliZSB9IGZyb20gJy4uL2xpYi91dGlsLmpzJ1xyXG5cclxuY29uc3QgdGlsZVcgPSAxNlxyXG5jb25zdCB0aWxlSCA9IDE2XHJcblxyXG5jb25zdCB0aWxlQ3ggPSBNYXRoLmZsb29yKHRpbGVXIC8gMilcclxuY29uc3QgdGlsZUN5ID0gTWF0aC5mbG9vcih0aWxlSCAvIDIpXHJcblxyXG5jb25zdCB0aWxlQ29scyA9IDEwMFxyXG5jb25zdCB0aWxlUm93cyA9IDEwMFxyXG5cclxudHlwZSBBbmltQ2VsbCA9IChub3c6IG51bWJlcikgPT4gTWF5YmU8bnVtYmVyPlxyXG50eXBlIFRpbGVNYXBDZWxsID0gbnVtYmVyIHwgQW5pbUNlbGxcclxuXHJcbnR5cGUgVGlsZU1hcCA9IHtcclxuICB3aWR0aDogbnVtYmVyXHJcbiAgaGVpZ2h0OiBudW1iZXJcclxuICBkYXRhOiBUaWxlTWFwQ2VsbFtdXHJcbn1cclxuXHJcbmNvbnN0IGdldFRpbGVNYXBSZWN0SWQgPSAoXHJcbiAgdGlsZU1hcDogVGlsZU1hcCxcclxuICBjb2w6IG51bWJlciwgcm93OiBudW1iZXIsIG5vdzogbnVtYmVyXHJcbik6IE1heWJlPG51bWJlcj4gPT4ge1xyXG4gIGNvbnN0IGkgPSByb3cgKiB0aWxlTWFwLndpZHRoICsgY29sXHJcbiAgY29uc3QgY2VsbCA9IHRpbGVNYXAuZGF0YVtpXVxyXG5cclxuICBpZiAodHlwZW9mIGNlbGwgPT09ICdudW1iZXInKSByZXR1cm4gY2VsbFxyXG5cclxuICByZXR1cm4gY2VsbChub3cpXHJcbn1cclxuXHJcbi8vIGEgdGlsZSB0aGF0IGFuaW1hdGVzXHJcbnR5cGUgQW5pbWF0aW9uID0gW3R5cGU6ICdhbmltYXRpb24nLCBuYW1lOiBzdHJpbmcsIC4uLkFuaW1hdGlvbkZyYW1lW11dXHJcbi8vIGEgc3RhdGljIHRpbGVcclxudHlwZSBTdGF0aWMgPSBbdHlwZTogJ3N0YXRpYycsIG5hbWU6IHN0cmluZywgaWQ6IG51bWJlcl1cclxuLy8gdmFyaWF0aW9ucyBvZiBhIHN0YXRpYyB0aWxlXHJcbnR5cGUgVmFyaWF0aW9uID0gW3R5cGU6ICd2YXJpYXRpb24nLCBuYW1lOiBzdHJpbmcsIGlkOiBudW1iZXIsIGNvdW50OiBudW1iZXJdXHJcbi8vIHRoZXNlIHRpbGVzIGJlbG9uZyB0b2dldGhlclxyXG50eXBlIFNwYW4gPSBbdHlwZTogJ3NwYW4nLCBuYW1lOiBzdHJpbmcsIGlkOiBudW1iZXIsIGNvdW50OiBudW1iZXJdXHJcblxyXG5jb25zdCB3YXRlcjogQW5pbWF0aW9uID0gWydhbmltYXRpb24nLCAnd2F0ZXInLCBbNTAwLCAwXSwgWzUwMCwgMV1dXHJcbmNvbnN0IGZpbGxlZDogU3RhdGljID0gWydzdGF0aWMnLCAnZmlsbGVkJywgMl1cclxuY29uc3QgZ3Jhc3NlczogVmFyaWF0aW9uID0gWyd2YXJpYXRpb24nLCAnZ3Jhc3MnLCAzLCA1XVxyXG5jb25zdCByb2NrczogVmFyaWF0aW9uID0gWyd2YXJpYXRpb24nLCAncm9jaycsIDgsIDNdXHJcbmNvbnN0IHRyZWVzOiBWYXJpYXRpb24gPSBbJ3ZhcmlhdGlvbicsICd0cmVlJywgMTEsIDRdXHJcbmNvbnN0IGFwcGxlSWNvbjogU3RhdGljID0gWydzdGF0aWMnLCAnYXBwbGUtaWNvbicsIDE1XVxyXG5jb25zdCBoZWFydEljb246IFN0YXRpYyA9IFsnc3RhdGljJywgJ2hlYXJ0LWljb24nLCAxNl1cclxuY29uc3Qgc2FuZHM6IFZhcmlhdGlvbiA9IFsndmFyaWF0aW9uJywgJ3NhbmQnLCAxNywgM11cclxuY29uc3QgaHV0OiBTdGF0aWMgPSBbJ3N0YXRpYycsICdodXQnLCAyMF1cclxuY29uc3QgY29tcHV0ZXI6IFN0YXRpYyA9IFsnc3RhdGljJywgJ2NvbXB1dGVyJywgMjFdXHJcbmNvbnN0IHByaW50ZXI6IFN0YXRpYyA9IFsnc3RhdGljJywgJ3ByaW50ZXInLCAyMl1cclxuY29uc3QgYmVkOiBTdGF0aWMgPSBbJ3N0YXRpYycsICdiZWQnLCAyM11cclxuY29uc3QgaHV0RnJvbnQgPSBbJ3NwYW4nLCAnaHV0LWZyb250JywgMjQsIDNdIGFzIGNvbnN0XHJcbmNvbnN0IGVtcHR5OiBTdGF0aWMgPSBbJ3N0YXRpYycsICdlbXB0eScsIDI3XVxyXG5jb25zdCBydWluczogVmFyaWF0aW9uID0gWyd2YXJpYXRpb24nLCAncnVpbnMnLCAyOCwgM11cclxuY29uc3QgbW91bnRhaW5zOiBWYXJpYXRpb24gPSBbJ3ZhcmlhdGlvbicsICdtb3VudGFpbicsIDMxLCAzXVxyXG5jb25zdCBzYXRlbGxpdGUgPSBbJ2FuaW1hdGlvbicsICdzYXRlbGxpdGUnLCBbNTAwLCAzNF0sIFs1MDAsIDM1XV0gYXMgY29uc3RcclxuY29uc3QgYWN0aXZlUG9ydGFsID0gWydhbmltYXRpb24nLCAncG9ydGFsJywgWzEwMCwgMzZdLCBbMTAwLCAzN11dIGFzIGNvbnN0XHJcbmNvbnN0IHNrZWxldG9uOiBTdGF0aWMgPSBbJ3N0YXRpYycsICdza2VsZXRvbicsIDM4XVxyXG5jb25zdCBrZXlJY29uOiBTdGF0aWMgPSBbJ3N0YXRpYycsICdrZXktaWNvbicsIDM5XVxyXG5jb25zdCBkaXNrSWNvbjogU3RhdGljID0gWydzdGF0aWMnLCAnZGlzay1pY29uJywgNDBdXHJcbmNvbnN0IGN1cmN1aXRJY29uOiBTdGF0aWMgPSBbJ3N0YXRpYycsICdjaGlwLWljb24nLCA0MV1cclxuY29uc3QgaGFsZlRvbmU6IFN0YXRpYyA9IFsnc3RhdGljJywgJ2hhbGYtdG9uZScsIDQyXVxyXG5jb25zdCBkaXNhYmxlZFBvcnRhbDogU3RhdGljID0gWydzdGF0aWMnLCAnZGlzYWJsZWQtc2F0ZWxsaXRlJywgNDNdXHJcbmNvbnN0IGluYWN0aXZlUG9ydGFsOiBTdGF0aWMgPSBbJ3N0YXRpYycsICdpbmFjdGl2ZS1zYXRlbGxpdGUnLCA0NF1cclxuXHJcbmNvbnN0IGdlbmVyYXRlTWFwID0gKHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKSA9PiB7XHJcbiAgY29uc3Qgc2l6ZSA9IHdpZHRoICogaGVpZ2h0XHJcblxyXG4gIGNvbnN0IFtfdHlwZSwgX25hbWUsIC4uLndhdGVyRnJhbWVzXSA9IHdhdGVyXHJcblxyXG4gIGNvbnN0IHdhdGVyQW5pbSA9IGFuaW1hdG9yKHdhdGVyRnJhbWVzKVxyXG5cclxuICBjb25zdCB0aWxlTWFwOiBUaWxlTWFwID0ge1xyXG4gICAgd2lkdGgsIGhlaWdodCxcclxuICAgIGRhdGE6IEFycmF5PFRpbGVNYXBDZWxsPihzaXplKS5maWxsKHdhdGVyQW5pbSlcclxuICB9XHJcblxyXG4gIGNvbnN0IGJsb2NraW5nID0gbmV3IFNldDxUaWxlTWFwQ2VsbD4oKVxyXG5cclxuICBjb25zdCBpbmRleE1hcCA9IG5ldyBNYXA8bnVtYmVyLCBUMj4oKVxyXG5cclxuICBjb25zdCBsYW5kQ291bnQgPSBNYXRoLmZsb29yKHNpemUgKiAwLjcpXHJcblxyXG4gIGNvbnN0IGxhbmRJbmRpY2VzID0gbmV3IFNldDxudW1iZXI+KClcclxuICBjb25zdCBsYW5kSW5kaWNlc0FycjogbnVtYmVyW10gPSBbXVxyXG5cclxuICBsZXQgbGFuZFBsYWNlZCA9IDBcclxuXHJcbiAgbGV0IGN1cnJlbnRMYW5kOiBUMiA9IFtNYXRoLmZsb29yKHdpZHRoIC8gMiksIE1hdGguZmxvb3IoaGVpZ2h0IC8gMildXHJcblxyXG4gIGNvbnN0IGNhblBsYWNlTGFuZCA9IChbeCwgeV06IFQyKSA9PiB7XHJcbiAgICAvLyBsZWF2ZSBlZGdlcyBjbGVhciBmb3Igd2F0ZXJcclxuICAgIGlmICh4ID09PSAwKSByZXR1cm4gZmFsc2VcclxuICAgIGlmICh5ID09PSAwKSByZXR1cm4gZmFsc2VcclxuICAgIGlmICh4ID09PSB3aWR0aCAtIDEpIHJldHVybiBmYWxzZVxyXG4gICAgaWYgKHkgPT09IGhlaWdodCAtIDEpIHJldHVybiBmYWxzZVxyXG5cclxuICAgIGNvbnN0IGkgPSB5ICogd2lkdGggKyB4XHJcblxyXG4gICAgLy8gY2FuJ3QgYWxyZWFkeSBiZSBsYW5kXHJcbiAgICByZXR1cm4gIWxhbmRJbmRpY2VzLmhhcyhpKVxyXG4gIH1cclxuXHJcbiAgY29uc3QgbWF4VHJpZXMgPSAxMDBcclxuXHJcbiAgY29uc3QgYWRkTGFuZCA9ICgpID0+IHtcclxuICAgIGxldCBbbHgsIGx5XSA9IGN1cnJlbnRMYW5kXHJcbiAgICBsZXQgbGkgPSBseSAqIHdpZHRoICsgbHhcclxuXHJcbiAgICBpbmRleE1hcC5zZXQobGksIFtseCwgbHldKVxyXG4gICAgbGFuZEluZGljZXMuYWRkKGxpKVxyXG4gICAgbGFuZEluZGljZXNBcnIucHVzaChsaSlcclxuXHJcbiAgICBsZXQgdHJpZXMgPSAwXHJcbiAgICBsZXQgbmVpZ2hib3VycyA9IGdldE5laWdoYm91cnNDYXJkaW5hbChjdXJyZW50TGFuZCkuZmlsdGVyKGNhblBsYWNlTGFuZClcclxuXHJcbiAgICB3aGlsZSAobmVpZ2hib3Vycy5sZW5ndGggPCAxKSB7XHJcbiAgICAgIGNvbnN0IGkgPSBwaWNrKGxhbmRJbmRpY2VzQXJyKVxyXG4gICAgICBjb25zdCBleGlzdGluZ0xhbmQgPSBhc3NydChpbmRleE1hcC5nZXQoaSksIGBFeHBlY3RlZCBsYW5kIGF0ICR7aX1gKVxyXG5cclxuICAgICAgbmVpZ2hib3VycyA9IGdldE5laWdoYm91cnNDYXJkaW5hbChleGlzdGluZ0xhbmQpLmZpbHRlcihjYW5QbGFjZUxhbmQpXHJcblxyXG4gICAgICB0cmllcysrXHJcblxyXG4gICAgICBpZiAodHJpZXMgPj0gbWF4VHJpZXMpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnRmFpbGVkIHRvIHBsYWNlIGxhbmQnKVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2VcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGN1cnJlbnRMYW5kID0gcGljayhuZWlnaGJvdXJzKVxyXG5cclxuICAgIHJldHVybiB0cnVlXHJcbiAgfVxyXG5cclxuICB3aGlsZSAobGFuZFBsYWNlZCA8IGxhbmRDb3VudCkge1xyXG4gICAgaWYgKCFhZGRMYW5kKCkpIGJyZWFrXHJcblxyXG4gICAgbGFuZFBsYWNlZCsrXHJcbiAgfVxyXG5cclxuICBjb25zdCBbLCAsIGdyYXNzU3RhcnQsIGdyYXNzQ291bnRdID0gZ3Jhc3Nlc1xyXG4gIGNvbnN0IFssICwgc2FuZFN0YXJ0LCBzYW5kQ291bnRdID0gc2FuZHNcclxuICBjb25zdCBbLCAsIHJvY2tTdGFydCwgcm9ja0NvdW50XSA9IHJvY2tzXHJcbiAgY29uc3QgWywgLCB0cmVlU3RhcnQsIHRyZWVDb3VudF0gPSB0cmVlc1xyXG4gIGNvbnN0IFssICwgcnVpbnNTdGFydCwgcnVpbnNDb3VudF0gPSBydWluc1xyXG4gIGNvbnN0IFssICwgbW91bnRhaW5TdGFydCwgbW91bnRhaW5Db3VudF0gPSBtb3VudGFpbnNcclxuXHJcbiAgY29uc3QgWywgLCBodXRJbmRleF0gPSBodXRcclxuICBjb25zdCBbLCAsIHNrZWxldG9uSW5kZXhdID0gc2tlbGV0b25cclxuXHJcbiAgZm9yIChjb25zdCBpIG9mIGxhbmRJbmRpY2VzKSB7XHJcbiAgICBjb25zdCBncmFzcyA9IHJhbmRJbnQoZ3Jhc3NDb3VudCkgKyBncmFzc1N0YXJ0XHJcblxyXG4gICAgdGlsZU1hcC5kYXRhW2ldID0gZ3Jhc3NcclxuICB9XHJcblxyXG4gIGZvciAoY29uc3QgaSBvZiBsYW5kSW5kaWNlcykge1xyXG4gICAgaWYgKHRpbGVNYXAuZGF0YVtpXSA9PT0gd2F0ZXJBbmltKSBjb250aW51ZVxyXG5cclxuICAgIGNvbnN0IHB0ID0gYXNzcnQoaW5kZXhNYXAuZ2V0KGkpLCBgRXhwZWN0ZWQgcG9pbnQgYXQgJHtpfWApXHJcblxyXG4gICAgbGV0IHNlYU5laWdoYm91cnMgPSAwXHJcblxyXG4gICAgY29uc3QgbmVpZ2hib3VycyA9IGdldE5laWdoYm91cnNBbGwocHQpXHJcblxyXG4gICAgZm9yIChjb25zdCBuIG9mIG5laWdoYm91cnMpIHtcclxuICAgICAgY29uc3QgW254LCBueV0gPSBuXHJcblxyXG4gICAgICBpZiAobnggPCAwIHx8IG54ID49IHdpZHRoIHx8IG55IDwgMCB8fCBueSA+PSBoZWlnaHQpIGNvbnRpbnVlXHJcblxyXG4gICAgICBjb25zdCBuaSA9IG55ICogd2lkdGggKyBueFxyXG5cclxuICAgICAgaWYgKHRpbGVNYXAuZGF0YVtuaV0gPT09IHdhdGVyQW5pbSkgc2VhTmVpZ2hib3VycysrXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHNlYU5laWdoYm91cnMgPiAwKSB7XHJcbiAgICAgIGNvbnN0IHNhbmQgPSByYW5kSW50KHNhbmRDb3VudCkgKyBzYW5kU3RhcnRcclxuXHJcbiAgICAgIHRpbGVNYXAuZGF0YVtpXSA9IHNhbmRcclxuXHJcbiAgICAgIGNvbnRpbnVlXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFyYW5kSW50KDEwKSkge1xyXG4gICAgICBjb25zdCByb2NrID0gcmFuZEludChyb2NrQ291bnQpICsgcm9ja1N0YXJ0XHJcblxyXG4gICAgICB0aWxlTWFwLmRhdGFbaV0gPSByb2NrXHJcblxyXG4gICAgICBjb250aW51ZVxyXG4gICAgfVxyXG5cclxuICAgIGlmICghcmFuZEludCgxMCkpIHtcclxuICAgICAgY29uc3QgdHJlZSA9IHJhbmRJbnQodHJlZUNvdW50KSArIHRyZWVTdGFydFxyXG5cclxuICAgICAgdGlsZU1hcC5kYXRhW2ldID0gdHJlZVxyXG5cclxuICAgICAgY29udGludWVcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXJhbmRJbnQoMTAwKSkge1xyXG4gICAgICBjb25zdCBydWlucyA9IHJhbmRJbnQocnVpbnNDb3VudCkgKyBydWluc1N0YXJ0XHJcblxyXG4gICAgICB0aWxlTWFwLmRhdGFbaV0gPSBydWluc1xyXG5cclxuICAgICAgY29udGludWVcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXJhbmRJbnQoNTApKSB7XHJcbiAgICAgIGNvbnN0IG1vdW50YWluID0gcmFuZEludChtb3VudGFpbkNvdW50KSArIG1vdW50YWluU3RhcnRcclxuXHJcbiAgICAgIHRpbGVNYXAuZGF0YVtpXSA9IG1vdW50YWluXHJcblxyXG4gICAgICBjb250aW51ZVxyXG4gICAgfVxyXG5cclxuICAgIGlmICghcmFuZEludCg1MDApKSB7XHJcbiAgICAgIHRpbGVNYXAuZGF0YVtpXSA9IGh1dEluZGV4XHJcblxyXG4gICAgICBjb250aW51ZVxyXG4gICAgfVxyXG5cclxuICAgIGlmICghcmFuZEludCgxMDAwKSkge1xyXG4gICAgICB0aWxlTWFwLmRhdGFbaV0gPSBza2VsZXRvbkluZGV4XHJcblxyXG4gICAgICBjb250aW51ZVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYmxvY2tpbmcuYWRkKHdhdGVyQW5pbSlcclxuICAvLyB0cmVlc1xyXG4gIGZvciAobGV0IGkgPSB0cmVlU3RhcnQ7IGkgPCB0cmVlU3RhcnQgKyB0cmVlQ291bnQ7IGkrKykge1xyXG4gICAgYmxvY2tpbmcuYWRkKGkpXHJcbiAgfVxyXG4gIC8vIG1vdW50YWluc1xyXG4gIGZvciAobGV0IGkgPSBtb3VudGFpblN0YXJ0OyBpIDwgbW91bnRhaW5TdGFydCArIG1vdW50YWluQ291bnQ7IGkrKykge1xyXG4gICAgYmxvY2tpbmcuYWRkKGkpXHJcbiAgfVxyXG5cclxuICByZXR1cm4geyB0aWxlTWFwLCBibG9ja2luZyB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCByYW5nZXJTY2VuZSA9ICgpOiBTY2VuZSA9PiB7XHJcbiAgbGV0IGlzQWN0aXZlID0gdHJ1ZVxyXG4gIGxldCB0aWxlczogTWF5YmU8VGlsZVNoZWV0PlxyXG4gIGxldCBzcHJpdGVzOiBNYXliZTxUaWxlU2hlZXQ+XHJcbiAgbGV0IGZvbnQ6IE1heWJlPEJtcEZvbnRNPlxyXG4gIGxldCBmb250UHRzOiBNYXliZTxGb250UG9pbnRzPlxyXG4gIGxldCB0aWxlTWFwOiBNYXliZTxUaWxlTWFwPlxyXG4gIGxldCBibG9ja2luZzogTWF5YmU8U2V0PFRpbGVNYXBDZWxsPj5cclxuICBsZXQgcGxheWVyQW5pbUxlZnQ6IE1heWJlPChub3c6IG51bWJlcikgPT4gTWF5YmU8bnVtYmVyPj5cclxuICBsZXQgcGxheWVyQW5pbVJpZ2h0OiBNYXliZTwobm93OiBudW1iZXIpID0+IE1heWJlPG51bWJlcj4+XHJcbiAgbGV0IGZhY2luZyA9ICdyaWdodCdcclxuXHJcbiAgbGV0IGNhbWVyYVggPSAwXHJcbiAgbGV0IGNhbWVyYVkgPSAwXHJcblxyXG4gIGNvbnN0IGluaXQgPSBhc3luYyAoc3RhdGU6IFN0YXRlKSA9PiB7XHJcbiAgICBjb25zdCB0aWxlU2hlZXQgPSBhd2FpdCBsb2FkSW1hZ2UoJ3NjZW5lcy9yYW5nZXIvdGlsZXMucG5nJylcclxuXHJcbiAgICB0aWxlcyA9IGNyZWF0ZVRpbGVTaGVldCh0aWxlU2hlZXQsIHRpbGVXLCB0aWxlSClcclxuXHJcbiAgICBjb25zdCBzcHJpdGVTaGVldCA9IGF3YWl0IGxvYWRJbWFnZSgnc2NlbmVzL3Jhbmdlci9zcHJpdGVzLnBuZycpXHJcblxyXG4gICAgc3ByaXRlcyA9IGNyZWF0ZVRpbGVTaGVldChzcHJpdGVTaGVldCwgdGlsZVcsIHRpbGVIKVxyXG5cclxuICAgIHBsYXllckFuaW1SaWdodCA9IGFuaW1hdG9yKFtbNTAwLCAwXSwgWzUwMCwgMV1dKVxyXG4gICAgcGxheWVyQW5pbUxlZnQgPSBhbmltYXRvcihbWzUwMCwgMl0sIFs1MDAsIDNdXSlcclxuXHJcbiAgICBjb25zdCBtYXAgPSBnZW5lcmF0ZU1hcCh0aWxlQ29scywgdGlsZVJvd3MpXHJcblxyXG4gICAgdGlsZU1hcCA9IG1hcC50aWxlTWFwXHJcbiAgICBibG9ja2luZyA9IG1hcC5ibG9ja2luZ1xyXG5cclxuICAgIGNhbWVyYVggPSBNYXRoLmZsb29yKHRpbGVDb2xzIC8gMilcclxuICAgIGNhbWVyYVkgPSBNYXRoLmZsb29yKHRpbGVSb3dzIC8gMilcclxuXHJcbiAgICBmb250ID0gYXdhaXQgbG9hZEZvbnRNb25vKCdFdmVyZXhNRV81eDgnKVxyXG4gICAgZm9udFB0cyA9IGZvbnRJbWFnZVRvUG9pbnRzKGZvbnQpXHJcbiAgfVxyXG5cclxuICBjb25zdCBfaW8gPSAoc3RhdGU6IFN0YXRlKSA9PiB7XHJcbiAgICBpZiAoIWlzQWN0aXZlKSByZXR1cm5cclxuXHJcbiAgICBjb25zdCBrZXlzID0gc3RhdGUuZ2V0S2V5cygpXHJcblxyXG4gICAgaWYgKGtleXNbJ0VzY2FwZSddKSB7XHJcbiAgICAgIHN0YXRlLnNldFJ1bm5pbmcoZmFsc2UpXHJcblxyXG4gICAgICAvLyBjb25zdW1lIHRoZSBrZXlcclxuICAgICAga2V5c1snRXNjYXBlJ10gPSBmYWxzZVxyXG5cclxuICAgICAgcmV0dXJuXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgd2hlZWwgPSBzdGF0ZS5tb3VzZS50YWtlV2hlZWwoKVxyXG4gICAgY29uc3Qgem9vbSA9IHN0YXRlLnZpZXcuZ2V0Wm9vbSgpXHJcblxyXG4gICAgaWYgKHdoZWVsIDwgMCkge1xyXG4gICAgICBzdGF0ZS52aWV3LnNldFpvb20oem9vbSArIDEpXHJcbiAgICB9IGVsc2UgaWYgKHdoZWVsID4gMCkge1xyXG4gICAgICBzdGF0ZS52aWV3LnNldFpvb20oem9vbSAtIDEpXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcHJlc3NlcyA9IHN0YXRlLmdldEtleVByZXNzZXMoKVxyXG5cclxuICAgIGxldCBvY3ggPSBjYW1lcmFYXHJcbiAgICBsZXQgb2N5ID0gY2FtZXJhWVxyXG5cclxuICAgIGZvciAoY29uc3Qga2V5IG9mIHByZXNzZXMpIHtcclxuICAgICAgaWYgKGtleS50b0xvd2VyQ2FzZSgpID09PSAndycgJiYgY2FtZXJhWSA+IDApIGNhbWVyYVktLVxyXG4gICAgICBpZiAoa2V5LnRvTG93ZXJDYXNlKCkgPT09ICdzJyAmJiBjYW1lcmFZIDwgdGlsZVJvd3MgLSAxKSBjYW1lcmFZKytcclxuXHJcbiAgICAgIGlmIChrZXkudG9Mb3dlckNhc2UoKSA9PT0gJ2EnICYmIGNhbWVyYVggPiAwKSB7XHJcbiAgICAgICAgY2FtZXJhWC0tXHJcbiAgICAgICAgZmFjaW5nID0gJ2xlZnQnXHJcbiAgICAgIH1cclxuICAgICAgaWYgKGtleS50b0xvd2VyQ2FzZSgpID09PSAnZCcgJiYgY2FtZXJhWCA8IHRpbGVDb2xzIC0gMSkge1xyXG4gICAgICAgIGNhbWVyYVgrK1xyXG4gICAgICAgIGZhY2luZyA9ICdyaWdodCdcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIGNvbnN1bWUgYWxsIGtleSBwcmVzc2VzXHJcbiAgICBwcmVzc2VzLmxlbmd0aCA9IDBcclxuXHJcbiAgICAvLyBjaGVjayBibG9ja2luZ1xyXG4gICAgY29uc3QgY2FtZXJhVGlsZSA9IHRpbGVNYXAhLmRhdGFbY2FtZXJhWSAqIHRpbGVDb2xzICsgY2FtZXJhWF1cclxuXHJcbiAgICBpZiAoYmxvY2tpbmchLmhhcyhjYW1lcmFUaWxlKSkge1xyXG4gICAgICBjYW1lcmFYID0gb2N4XHJcbiAgICAgIGNhbWVyYVkgPSBvY3lcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnN0IHVwZGF0ZSA9IChzdGF0ZTogU3RhdGUpID0+IHtcclxuICAgIF9pbyhzdGF0ZSlcclxuXHJcbiAgICBpZiAoIW1heWJlKHRpbGVzKSkgdGhyb3cgRXJyb3IoJ0V4cGVjdGVkIHRpbGVzJylcclxuICAgIGlmICghbWF5YmUodGlsZU1hcCkpIHRocm93IEVycm9yKCdFeHBlY3RlZCB0aWxlTWFwJylcclxuICAgIGlmICghbWF5YmUoYmxvY2tpbmcpKSB0aHJvdyBFcnJvcignRXhwZWN0ZWQgYmxvY2tpbmcnKVxyXG4gICAgaWYgKCFtYXliZShzcHJpdGVzKSkgdGhyb3cgRXJyb3IoJ0V4cGVjdGVkIHNwcml0ZXMnKVxyXG4gICAgaWYgKCFtYXliZShwbGF5ZXJBbmltUmlnaHQpKSB0aHJvdyBFcnJvcignRXhwZWN0ZWQgcGxheWVyQW5pbVJpZ2h0JylcclxuICAgIGlmICghbWF5YmUocGxheWVyQW5pbUxlZnQpKSB0aHJvdyBFcnJvcignRXhwZWN0ZWQgcGxheWVyQW5pbUxlZnQnKVxyXG4gICAgaWYgKCFtYXliZShmb250KSkgdGhyb3cgRXJyb3IoJ0V4cGVjdGVkIGZvbnQnKVxyXG4gICAgaWYgKCFtYXliZShmb250UHRzKSkgdGhyb3cgRXJyb3IoJ0V4cGVjdGVkIGZvbnRQdHMnKVxyXG5cclxuICAgIGNvbnN0IGJ1ZmZlciA9IHN0YXRlLnZpZXcuZ2V0QnVmZmVyKClcclxuICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gYnVmZmVyXHJcblxyXG4gICAgY29uc3QgZWxhcHNlZCA9IHN0YXRlLnRpbWUuZ2V0RWxhcHNlZCgpXHJcblxyXG4gICAgY29uc3QgY3ggPSBNYXRoLmZsb29yKHdpZHRoIC8gMilcclxuICAgIGNvbnN0IGN5ID0gTWF0aC5mbG9vcihoZWlnaHQgLyAyKVxyXG5cclxuICAgIC8vIHdlIHdpbGwgY2VudGVyIHRoZSB2aWV3IG9uIHRoZSBjYW1lcmFcclxuICAgIGNvbnN0IGF2YWlsVyA9IHdpZHRoIC0gdGlsZVdcclxuICAgIGNvbnN0IGF2YWlsSCA9IGhlaWdodCAtIHRpbGVIXHJcblxyXG4gICAgY29uc3QgY29sc1BlclNpZGUgPSBNYXRoLmNlaWwoYXZhaWxXIC8gMiAvIHRpbGVXKVxyXG4gICAgY29uc3Qgcm93c1BlclNpZGUgPSBNYXRoLmNlaWwoYXZhaWxIIC8gMiAvIHRpbGVIKVxyXG5cclxuICAgIGNvbnN0IGNvbHMgPSBjb2xzUGVyU2lkZSAqIDIgKyAxXHJcbiAgICBjb25zdCByb3dzID0gcm93c1BlclNpZGUgKiAyICsgMVxyXG5cclxuICAgIGNvbnN0IGxlZnRDb2wgPSBjYW1lcmFYIC0gY29sc1BlclNpZGVcclxuICAgIGNvbnN0IHRvcFJvdyA9IGNhbWVyYVkgLSByb3dzUGVyU2lkZVxyXG5cclxuICAgIC8vIGluIHBpeGVscyByZWxhdGl2ZSB0byB0aGUgdmlld1xyXG4gICAgY29uc3QgdkxlZnQgPSBjeCAtIGNvbHNQZXJTaWRlICogdGlsZVcgLSB0aWxlQ3hcclxuICAgIGNvbnN0IHZUb3AgPSBjeSAtIHJvd3NQZXJTaWRlICogdGlsZUggLSB0aWxlQ3lcclxuXHJcbiAgICBjb25zdCBwbGF5ZXJSZWN0SW5kZXggPSBhc3NydChcclxuICAgICAgZmFjaW5nID09PSAnbGVmdCcgPyBwbGF5ZXJBbmltTGVmdChlbGFwc2VkKSA6IHBsYXllckFuaW1SaWdodChlbGFwc2VkKSxcclxuICAgICAgJ0V4cGVjdGVkIHBsYXllciByZWN0J1xyXG4gICAgKVxyXG5cclxuICAgIGNvbnN0IHBsYXllclJlY3QgPSBzcHJpdGVzLnJlY3RzW3BsYXllclJlY3RJbmRleF1cclxuXHJcbiAgICBmaWxsKGJ1ZmZlciwgY3JlYXRlQ29sb3IoMHgwMCwgMHgwMCwgMHgwMCkpXHJcblxyXG4gICAgZm9yIChsZXQgciA9IDA7IHIgPCByb3dzOyByKyspIHtcclxuICAgICAgY29uc3Qgcm93ID0gdG9wUm93ICsgclxyXG5cclxuICAgICAgaWYgKHJvdyA8IDAgfHwgcm93ID49IHRpbGVSb3dzKSBjb250aW51ZVxyXG5cclxuICAgICAgY29uc3QgdnkgPSB2VG9wICsgciAqIHRpbGVIXHJcblxyXG4gICAgICBmb3IgKGxldCBjID0gMDsgYyA8IGNvbHM7IGMrKykge1xyXG4gICAgICAgIGNvbnN0IGNvbCA9IGxlZnRDb2wgKyBjXHJcblxyXG4gICAgICAgIGlmIChjb2wgPCAwIHx8IGNvbCA+PSB0aWxlQ29scykgY29udGludWVcclxuXHJcbiAgICAgICAgY29uc3QgdnggPSB2TGVmdCArIGMgKiB0aWxlV1xyXG5cclxuICAgICAgICBjb25zdCB0aWxlSW5kZXggPSByb3cgKiB0aWxlQ29scyArIGNvbFxyXG5cclxuICAgICAgICBjb25zdCBjZWxsID0gdGlsZU1hcC5kYXRhW3RpbGVJbmRleF1cclxuXHJcbiAgICAgICAgY29uc3QgcmVjdEluZGV4ID0gYXNzcnQoXHJcbiAgICAgICAgICB0eXBlb2YgY2VsbCA9PT0gJ251bWJlcicgPyBjZWxsIDogY2VsbChlbGFwc2VkKSxcclxuICAgICAgICAgIGBFeHBlY3RlZCByZWN0SW5kZXggZm9yIGNlbGwgJHtjZWxsfWBcclxuICAgICAgICApXHJcblxyXG4gICAgICAgIGNvbnN0IHJlY3QgPSB0aWxlcy5yZWN0c1tyZWN0SW5kZXhdXHJcblxyXG4gICAgICAgIGJsaXQodGlsZXMuaW1hZ2UsIGJ1ZmZlciwgWy4uLnJlY3QsIHZ4LCB2eV0pXHJcblxyXG4gICAgICAgIGlmIChjb2wgPT09IGNhbWVyYVggJiYgcm93ID09PSBjYW1lcmFZKSB7XHJcbiAgICAgICAgICBjb21wb3NpdGUoc3ByaXRlcy5pbWFnZSwgYnVmZmVyLCBbLi4ucGxheWVyUmVjdCwgdngsIHZ5XSlcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvL1xyXG5cclxuICAgIGNvbnN0IHBhZGRpbmcgPSAyXHJcblxyXG4gICAgY29uc3QgZnJhbWVUaW1lID0gc3RhdGUudGltZS5nZXRGcmFtZVRpbWUoKVxyXG4gICAgY29uc3QgZnBzID0gTWF0aC5yb3VuZCgxMDAwIC8gZnJhbWVUaW1lKVxyXG4gICAgY29uc3QgZnBzVGV4dCA9IGAke2Zwc30gZnBzICgke2ZyYW1lVGltZS50b0ZpeGVkKDEpfW1zKWBcclxuXHJcbiAgICBjb25zdCBmcHNXID0gZm9udC53aWR0aCAqIGZwc1RleHQubGVuZ3RoICsgcGFkZGluZyAqIDJcclxuICAgIGNvbnN0IGZwc0ggPSBmb250LmhlaWdodCArIHBhZGRpbmcgKiAyXHJcbiAgICBjb25zdCBmcHNYID0gd2lkdGggLSBmcHNXIC0gcGFkZGluZ1xyXG4gICAgY29uc3QgZnBzWSA9IHBhZGRpbmdcclxuXHJcbiAgICBjb25zdCBmcHNCZyA9IGNyZWF0ZUNvbG9yKDB4MDAsIDB4NzgsIDB4ZDQpXHJcbiAgICBjb25zdCBmcHNGZyA9IGNyZWF0ZUNvbG9yKDB4ZmYsIDB4ZDcsIDB4MDApXHJcblxyXG4gICAgZmlsbChidWZmZXIsIGZwc0JnLCBbZnBzWCwgZnBzWSwgZnBzVywgZnBzSF0pXHJcblxyXG4gICAgY29uc3QgZnBzTGF5b3V0ID0gbGF5b3V0VGV4dExpbmUoZm9udCwgZnBzVGV4dClcclxuXHJcbiAgICBjb25zdCBmcHNJbmRpY2VzID0gdGV4dExheW91dFRvSW5kaWNlcyhcclxuICAgICAgYnVmZmVyLCBmcHNYICsgcGFkZGluZywgZnBzWSArIHBhZGRpbmcsIGZvbnRQdHMsIGZwc0xheW91dFxyXG4gICAgKVxyXG5cclxuICAgIGZpbGxJbmRpY2VzKGZwc0luZGljZXMsIGJ1ZmZlciwgZnBzRmcpXHJcbiAgfVxyXG5cclxuICBjb25zdCBxdWl0ID0gYXN5bmMgKF9zdGF0ZTogU3RhdGUpID0+IHtcclxuICAgIHRpbGVzID0gbnVsbFxyXG4gICAgdGlsZU1hcCA9IG51bGxcclxuICAgIGNhbWVyYVggPSAwXHJcbiAgICBjYW1lcmFZID0gMFxyXG4gIH1cclxuXHJcbiAgY29uc3Qgc2V0QWN0aXZlID0gKHZhbHVlOiBib29sZWFuKSA9PiB7XHJcbiAgICBpc0FjdGl2ZSA9IHZhbHVlXHJcbiAgfVxyXG5cclxuICByZXR1cm4geyBpbml0LCB1cGRhdGUsIHF1aXQsIHNldEFjdGl2ZSB9XHJcbn1cclxuXHJcblxyXG5jb25zdCBmb250UGF0aCA9ICdkYXRhJ1xyXG5cclxuY29uc3QgbW9ub0ZvbnRGaWxlcyA9IFtcclxuICAnQVRJX1NtYWxsV182eDgnLFxyXG4gICdFdmVyZXhNRV81eDgnLFxyXG4gICdIUF8xMDBMWF82eDgnLFxyXG4gICdQb3J0Zm9saW9fNng4JyxcclxuICAnVHNlbmdFVkFfMTMyXzZ4OCcsXHJcbiAgJ0lCTV9FR0FfOHg4JyxcclxuICAnSUJNX1ZHQV84eDE0JyxcclxuICAnSUJNX1ZHQV84eDE2JyxcclxuICAnSUJNX1ZHQV85eDgnLFxyXG4gICdJQk1fVkdBXzl4MTQnLFxyXG4gICdJQk1fVkdBXzl4MTYnXHJcbl0gYXMgY29uc3RcclxuXHJcbnR5cGUgTW9ub0ZvbnROYW1lID0gdHlwZW9mIG1vbm9Gb250RmlsZXNbbnVtYmVyXVxyXG5cclxuY29uc3QgbG9hZEZvbnRNb25vID0gYXN5bmMgKG5hbWU6IE1vbm9Gb250TmFtZSkgPT4ge1xyXG4gIGNvbnN0IGltYWdlID0gYXdhaXQgbG9hZEltYWdlKGAke2ZvbnRQYXRofS9CbTQzN18ke25hbWV9LnBuZ2ApXHJcbiAgY29uc3Qgc2l6ZVNsdWcgPSBhc3NydChmaW5kU2l6ZVNsdWcobmFtZSksICdFeHBlY3RlZCBzaXplIHNsdWcnKVxyXG4gIGNvbnN0IFt3aWR0aCwgaGVpZ2h0XSA9IHBhcnNlU2l6ZVNsdWcoc2l6ZVNsdWcpXHJcblxyXG4gIGNvbnN0IGNvbHMgPSBhc3NydEludChpbWFnZS53aWR0aCAvIHdpZHRoKVxyXG4gIGNvbnN0IHJvd3MgPSBhc3NydEludChpbWFnZS5oZWlnaHQgLyBoZWlnaHQpXHJcblxyXG4gIGNvbnN0IGZvbnQ6IEJtcEZvbnRNID0ge1xyXG4gICAgdHlwZTogJ21vbm8nLFxyXG4gICAgd2lkdGgsXHJcbiAgICBoZWlnaHQsXHJcbiAgICBsZWFkaW5nOiAwLCAvLyBidWlsdCBpbnRvIHRoZSBiaXRtYXAgZ2x5cGhzXHJcbiAgICBpbWFnZTogaW1hZ2UsXHJcbiAgICByZWN0czoge30sXHJcbiAgICBhZHZhbmNlOiAwLCAvLyBidWlsdCBpbnRvIHRoZSBiaXRtYXAgZ2x5cGhzXHJcbiAgICBmYWxsYmFjazogMTI3XHJcbiAgfVxyXG5cclxuICBmb3IgKGxldCByID0gMDsgciA8IHJvd3M7IHIrKykge1xyXG4gICAgY29uc3Qgcm93SW5kZXggPSByICogY29sc1xyXG4gICAgZm9yIChsZXQgYyA9IDA7IGMgPCBjb2xzOyBjKyspIHtcclxuICAgICAgY29uc3QgY2hhckNvZGUgPSByb3dJbmRleCArIGNcclxuXHJcbiAgICAgIGZvbnQucmVjdHNbY2hhckNvZGVdID0gW2MgKiB3aWR0aCwgciAqIGhlaWdodCwgd2lkdGgsIGhlaWdodF1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBmb250XHJcbn0iXX0=