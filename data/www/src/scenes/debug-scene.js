import { lineToRows, rectToRows, triangleToRows } from '../lib/image/rows.js';
import { polygonTriangles } from '../sandbox/util.js';
import { takeMouse, releaseMouse } from '../lib/engine.js';
import { blit, blitRows } from '../lib/image/blit.js';
import { bresenhamLine } from '../lib/image/bresenham.js';
import { colorToRgba, createColor, generateHues, sampleGradient } from '../lib/image/color.js';
import { composite } from '../lib/image/composite.js';
import { fill, fillCol, fillIndices, fillRows } from '../lib/image/fill.js';
import { loadImage } from '../lib/image/load.js';
import { drawRotated } from '../lib/image/rotate.js';
import { pointsToIndices } from '../lib/image/util.js';
import { generateGridLayout, generateNamedGridLayout } from '../lib/grid/index.js';
import { rowQuery } from '../lib/image/query.js';
import { createImage } from '../lib/image/create.js';
import { limitedLogger, maybe } from '../lib/util.js';
const readAlpha = (state, ch, destroy = false) => {
    const upper = ch.toUpperCase();
    const lower = ch.toLowerCase();
    const alpha = state.keys[upper] ? upper : state.keys[lower] ? lower : null;
    if (destroy && alpha) {
        state.keys[alpha] = false;
    }
    return alpha;
};
export const debugScene = () => {
    let testImg0;
    let pattern0;
    let cursor;
    let pattern0Rows;
    const patternColors = generateHues(8);
    const patternColorImage = createImage(8, 8);
    for (let x = 0; x < 8; x++) {
        const color = patternColors[x];
        fillCol(patternColorImage, color, x);
    }
    const minPolySides = 3;
    const maxPolySides = 128;
    // enough for one run through, then stop logging, otherwise we flood console
    // calling *every* frame
    const gradientLogger = limitedLogger(32);
    let polySides = 5;
    let polyRotation = 0;
    let strokePoly = false;
    let isActive = true;
    const init = async (_state) => {
        console.log('starting debug scene');
        testImg0 = await loadImage('scenes/debug/test-0.png');
        pattern0 = await loadImage('scenes/debug/pattern-0.png');
        cursor = await loadImage('scenes/debug/cursor.png');
        polyRotation = 0;
        pattern0Rows = rowQuery(pattern0, r => r === 0);
        console.log('pattern0Rows', pattern0Rows);
        takeMouse();
    };
    const bgColor0 = [0x33, 0x99, 0xff];
    const bgColor1 = [0x11, 0x77, 0xdd];
    const paintColor = [0xff, 0x88, 0x00];
    let painting = false;
    let lastPaintX = null;
    let lastPaintY = null;
    // nb - these are retained even when the scene exits and restarts
    // as a test for scenes holding state between runs
    //
    // if this is not desired, state should be reset in init or quit on each run
    //
    const paintPts = {};
    const getPaintRow = (y) => (paintPts[y] || (paintPts[y] = {}));
    const addPaintPt = (x, y) => {
        if (maybe(lastPaintX) && maybe(lastPaintY)) {
            const line = bresenhamLine(lastPaintX, lastPaintY, x, y);
            for (const [x, y] of line) {
                getPaintRow(y)[x] = true;
            }
        }
        else {
            getPaintRow(y)[x] = true;
        }
        lastPaintX = x;
        lastPaintY = y;
    };
    let frame = 0;
    const _handleKeys = (state) => {
        if (state.keys['Escape']) {
            state.running = false;
            // consume the key
            state.keys['Escape'] = false;
            return;
        }
        if (state.keys['ArrowUp']) {
            polySides--;
            state.keys['ArrowUp'] = false;
        }
        if (state.keys['ArrowDown']) {
            polySides++;
            state.keys['ArrowDown'] = false;
        }
        const sState = readAlpha(state, 'S', true);
        if (sState) {
            strokePoly = !strokePoly;
        }
    };
    const update = (state) => {
        if (isActive) {
            _handleKeys(state);
            polySides = Math.min(Math.max(polySides, minPolySides), maxPolySides);
            // capture a reference - it is a destructive read
            const wheel = state.mouse.wheel;
            if (wheel < 0) {
                state.view.zoom += 1;
            }
            else if (wheel > 0) {
                state.view.zoom -= 1;
            }
            if (state.mouse.buttons[0]) {
                addPaintPt(state.mouse.x, state.mouse.y);
                painting = true;
            }
            else if (painting) {
                painting = false;
                lastPaintX = null;
                lastPaintY = null;
            }
        }
        const { buffer } = state.view;
        const { width, height } = buffer;
        // not very efficent - plenty of faster ways to do this - but that's a good
        // thing, we're trying to stuff as much into the debug scene as possible
        // so we can give it a bit of a stress test
        //
        // even with everything we're doing still comfortably runs at 60fps tho!
        for (let y = 0; y < height; y++) {
            const row = y * width;
            for (let x = 0; x < width; x++) {
                const index = row + x;
                const dataIndex = index * 4;
                const isPaint = paintPts[y] && paintPts[y][x];
                if (isPaint) {
                    buffer.data[dataIndex] = paintColor[0];
                    buffer.data[dataIndex + 1] = paintColor[1];
                    buffer.data[dataIndex + 2] = paintColor[2];
                    buffer.data[dataIndex + 3] = 0xff;
                    continue;
                }
                const isCheck = (x + y) % 2 === 0;
                buffer.data[dataIndex] = isCheck ? bgColor0[0] : bgColor1[0];
                buffer.data[dataIndex + 1] = isCheck ? bgColor0[1] : bgColor1[1];
                buffer.data[dataIndex + 2] = isCheck ? bgColor0[2] : bgColor1[2];
                buffer.data[dataIndex + 3] = 0xff;
            }
        }
        // sprites, blitting, composite etc
        // a0..b7    
        const testGrid = generateNamedGridLayout(generateGridLayout(32, 32, 2, 8, 1, 1));
        const { width: gw } = testGrid;
        const offX = width - gw;
        const offY = 0;
        // straight blit
        const { a0 } = testGrid;
        const a0X = a0[0] + offX;
        const a0Y = a0[1] + offY;
        blit(testImg0, buffer, [0, 0, testImg0.width, testImg0.height, a0X, a0Y]);
        // testing oob on src
        const { b0 } = testGrid;
        const b0X = b0[0] + offX - 16;
        const b0Y = b0[1] + offY - 16;
        blit(testImg0, buffer, [
            -16, -16, testImg0.width + 32, testImg0.height + 32,
            b0X, b0Y
        ]);
        // alpha composite
        const { a1 } = testGrid;
        const a1X = a1[0] + offX;
        const a1Y = a1[1] + offY;
        composite(testImg0, buffer, [0, 0, testImg0.width, testImg0.height, a1X, a1Y], 0.5);
        // oob on dest
        const { b1 } = testGrid;
        const b1X = b1[0] + offX + 16;
        const b1Y = b1[1] + offY;
        blit(testImg0, buffer, [
            0, 0, testImg0.width, testImg0.height,
            b1X, b1Y
        ]);
        // color fill
        const { a2 } = testGrid;
        const a2X = a2[0] + offX;
        const a2Y = a2[1] + offY;
        const color = createColor(0x6c, 0x28, 0xbc);
        fill(buffer, color, [a2X, a2Y, testImg0.width, testImg0.height]);
        // sprite rotation
        const { b2 } = testGrid;
        const b2X = b2[0] + offX + testImg0.width / 2;
        const b2Y = b2[1] + offY + testImg0.height / 2;
        drawRotated(testImg0, testImg0.width / 2, testImg0.height / 2, buffer, b2X, b2Y, polyRotation);
        // blitRows test
        const { a3 } = testGrid;
        const a3X = a3[0] + offX;
        const a3Y = a3[1] + offY;
        fill(buffer, createColor(0, 0, 0), [a3X, a3Y, pattern0.width, pattern0.height]);
        blitRows(patternColorImage, pattern0Rows, buffer, a3X, a3Y);
        // gradient test
        const { b3 } = testGrid;
        const b3X = b3[0] + offX;
        const b3Y = b3[1] + offY;
        const gColors0 = generateHues(6);
        const step0 = 1 / (gColors0.length - 1);
        const gStops0 = gColors0.map((c, i) => {
            const rgba = colorToRgba(c);
            return [...rgba, i * step0];
        });
        const gImage0 = createImage(32, 32);
        for (let x = 0; x < gImage0.width; x++) {
            const at = x / (gImage0.width - 1);
            const rgba = sampleGradient(gStops0, at);
            const color = createColor(...rgba);
            fillCol(gImage0, color, x);
        }
        blit(gImage0, buffer, [0, 0, gImage0.width, gImage0.height, b3X, b3Y]);
        // gradient test 2, alpha + composite
        const { a4 } = testGrid;
        const a4X = a4[0] + offX;
        const a4Y = a4[1] + offY;
        const gColors1 = gColors0.slice().reverse();
        const step1 = 1 / (gColors1.length - 1);
        const gstops1 = gColors1.map((c, i) => {
            const [r, g, b] = colorToRgba(c);
            const a = i * step1 * 255;
            return [r, g, b, a, i * step1];
        });
        const gImage1 = createImage(32, 32);
        for (let x = 0; x < gImage1.width; x++) {
            const at = x / (gImage1.width - 1);
            const rgba = sampleGradient(gstops1, at);
            const color = createColor(...rgba);
            gradientLogger.log('gradient', x, rgba);
            fillCol(gImage1, color, x);
        }
        composite(gImage1, buffer, [0, 0, gImage1.width, gImage1.height, a4X, a4Y]);
        // horizontally sloping line
        const testLineColor = createColor(0x33, 0xff, 0x99);
        const testLine = [-32, height / 2 - 32, width + 32, height / 2 + 32];
        // nb - this is only faster with the right slope - otherwise it is slower
        // it is better to use bresenham for the general case
        const testLineRows = lineToRows(...testLine);
        fillRows(testLineRows, buffer, testLineColor);
        // rect via rows
        const rectColor = createColor(0xff, 0x99, 0x33);
        const testRect = [48, 48, 32, 24];
        const testRectRows = rectToRows(...testRect);
        fillRows(testRectRows, buffer, rectColor);
        // polygon
        const minSide = Math.min(width, height);
        const fillColors = generateHues(polySides);
        const shape = polygonTriangles(polySides, width / 2, height / 2, minSide / 4, polyRotation);
        const frameTime = state.time.frameTime;
        const rotateBy = 0.001 * frameTime;
        const strokeLine = (line, color) => {
            const pts = bresenhamLine(...line);
            const indices = pointsToIndices(width, height, 1)(pts);
            fillIndices(indices, buffer, color);
        };
        const strokeTri = (tri, color) => {
            const line0 = [tri[0][0], tri[0][1], tri[1][0], tri[1][1]];
            const line1 = [tri[1][0], tri[1][1], tri[2][0], tri[2][1]];
            const line2 = [tri[2][0], tri[2][1], tri[0][0], tri[0][1]];
            strokeLine(line0, color);
            strokeLine(line1, color);
            strokeLine(line2, color);
        };
        for (let i = 0; i < polySides; i++) {
            const color = fillColors[i % fillColors.length];
            const tri = shape[i];
            const ptriRows = triangleToRows(...tri);
            fillRows(ptriRows, buffer, color);
        }
        const strokeColors = strokePoly ? generateHues(polySides, 50) : fillColors;
        for (let i = 0; i < polySides; i++) {
            const color = strokeColors[i % strokeColors.length];
            const tri = shape[i];
            strokeTri(tri, color);
        }
        //
        if (state.mouse.inBounds) {
            composite(cursor, buffer, [0, 0, cursor.width, cursor.height, state.mouse.x, state.mouse.y]);
        }
        //
        polyRotation += rotateBy;
        frame++;
    };
    const quit = async (state) => {
        console.log('quitting debug scene');
        state.debug = false;
        releaseMouse();
    };
    const setActive = (active) => {
        // we just got focus
        if (active && !isActive) {
            takeMouse();
        }
        // we just lost focus 
        if (!active && isActive) {
            releaseMouse();
        }
        isActive = active;
    };
    return { init, update, quit, setActive };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVidWctc2NlbmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvc2NlbmVzL2RlYnVnLXNjZW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLGNBQWMsRUFBRSxNQUFNLHNCQUFzQixDQUFBO0FBQzdFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG9CQUFvQixDQUFBO0FBQ3JELE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUE7QUFDMUQsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQTtBQUNyRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMkJBQTJCLENBQUE7QUFDekQsT0FBTyxFQUNMLFdBQVcsRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLGNBQWMsRUFDdkQsTUFBTSx1QkFBdUIsQ0FBQTtBQUM5QixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sMkJBQTJCLENBQUE7QUFDckQsT0FBTyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxNQUFNLHNCQUFzQixDQUFBO0FBQzNFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQTtBQUNoRCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sd0JBQXdCLENBQUE7QUFDcEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFBO0FBRXRELE9BQU8sRUFDTCxrQkFBa0IsRUFBRSx1QkFBdUIsRUFDNUMsTUFBTSxzQkFBc0IsQ0FBQTtBQUU3QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUE7QUFDaEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHdCQUF3QixDQUFBO0FBQ3BELE9BQU8sRUFBRSxhQUFhLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUE7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LCB0cmlhbmdsZVRvUm93cyB9IGZyb20gJy4uL2xpYi9pbWFnZS9yb3dzLmpzJ1xyXG5pbXBvcnQgeyBwb2x5Z29uVHJpYW5nbGVzIH0gZnJvbSAnLi4vc2FuZGJveC91dGlsLmpzJ1xyXG5pbXBvcnQgeyB0YWtlTW91c2UsIHJlbGVhc2VNb3VzZSB9IGZyb20gJy4uL2xpYi9lbmdpbmUuanMnXHJcbmltcG9ydCB7IGJsaXQsIGJsaXRSb3dzIH0gZnJvbSAnLi4vbGliL2ltYWdlL2JsaXQuanMnXHJcbmltcG9ydCB7IGJyZXNlbmhhbUxpbmUgfSBmcm9tICcuLi9saWIvaW1hZ2UvYnJlc2VuaGFtLmpzJ1xyXG5pbXBvcnQge1xyXG4gIGNvbG9yVG9SZ2JhLCBjcmVhdGVDb2xvciwgZ2VuZXJhdGVIdWVzLCBzYW1wbGVHcmFkaWVudFxyXG59IGZyb20gJy4uL2xpYi9pbWFnZS9jb2xvci5qcydcclxuaW1wb3J0IHsgY29tcG9zaXRlIH0gZnJvbSAnLi4vbGliL2ltYWdlL2NvbXBvc2l0ZS5qcydcclxuaW1wb3J0IHsgZmlsbCwgZmlsbENvbCwgZmlsbEluZGljZXMsIGZpbGxSb3dzIH0gZnJvbSAnLi4vbGliL2ltYWdlL2ZpbGwuanMnXHJcbmltcG9ydCB7IGxvYWRJbWFnZSB9IGZyb20gJy4uL2xpYi9pbWFnZS9sb2FkLmpzJ1xyXG5pbXBvcnQgeyBkcmF3Um90YXRlZCB9IGZyb20gJy4uL2xpYi9pbWFnZS9yb3RhdGUuanMnXHJcbmltcG9ydCB7IHBvaW50c1RvSW5kaWNlcyB9IGZyb20gJy4uL2xpYi9pbWFnZS91dGlsLmpzJ1xyXG5pbXBvcnQgeyBNYXliZSwgU2NlbmUsIFN0YXRlLCBUMiwgVDMsIFQ0LCBUNSB9IGZyb20gJy4uL2xpYi90eXBlcy5qcydcclxuaW1wb3J0IHtcclxuICBnZW5lcmF0ZUdyaWRMYXlvdXQsIGdlbmVyYXRlTmFtZWRHcmlkTGF5b3V0XHJcbn0gZnJvbSAnLi4vbGliL2dyaWQvaW5kZXguanMnXHJcbmltcG9ydCB7IFJvdyB9IGZyb20gJy4uL2xpYi9pbWFnZS90eXBlcy5qcydcclxuaW1wb3J0IHsgcm93UXVlcnkgfSBmcm9tICcuLi9saWIvaW1hZ2UvcXVlcnkuanMnXHJcbmltcG9ydCB7IGNyZWF0ZUltYWdlIH0gZnJvbSAnLi4vbGliL2ltYWdlL2NyZWF0ZS5qcydcclxuaW1wb3J0IHsgbGltaXRlZExvZ2dlciwgbWF5YmUgfSBmcm9tICcuLi9saWIvdXRpbC5qcydcclxuXHJcbmNvbnN0IHJlYWRBbHBoYSA9IChzdGF0ZTogU3RhdGUsIGNoOiBzdHJpbmcsIGRlc3Ryb3kgPSBmYWxzZSkgPT4ge1xyXG4gIGNvbnN0IHVwcGVyID0gY2gudG9VcHBlckNhc2UoKVxyXG4gIGNvbnN0IGxvd2VyID0gY2gudG9Mb3dlckNhc2UoKVxyXG5cclxuICBjb25zdCBhbHBoYSA9IHN0YXRlLmtleXNbdXBwZXJdID8gdXBwZXIgOiBzdGF0ZS5rZXlzW2xvd2VyXSA/IGxvd2VyIDogbnVsbFxyXG5cclxuICBpZiAoZGVzdHJveSAmJiBhbHBoYSkge1xyXG4gICAgc3RhdGUua2V5c1thbHBoYV0gPSBmYWxzZVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGFscGhhXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBkZWJ1Z1NjZW5lID0gKCk6IFNjZW5lID0+IHtcclxuICBsZXQgdGVzdEltZzA6IEltYWdlRGF0YVxyXG4gIGxldCBwYXR0ZXJuMDogSW1hZ2VEYXRhXHJcbiAgbGV0IGN1cnNvcjogSW1hZ2VEYXRhXHJcblxyXG4gIGxldCBwYXR0ZXJuMFJvd3M6IFJvdzxuZXZlcj5bXVxyXG4gIGNvbnN0IHBhdHRlcm5Db2xvcnMgPSBnZW5lcmF0ZUh1ZXMoOClcclxuICBjb25zdCBwYXR0ZXJuQ29sb3JJbWFnZSA9IGNyZWF0ZUltYWdlKDgsIDgpXHJcblxyXG4gIGZvciAobGV0IHggPSAwOyB4IDwgODsgeCsrKSB7XHJcbiAgICBjb25zdCBjb2xvciA9IHBhdHRlcm5Db2xvcnNbeF1cclxuXHJcbiAgICBmaWxsQ29sKHBhdHRlcm5Db2xvckltYWdlLCBjb2xvciwgeClcclxuICB9XHJcblxyXG4gIGNvbnN0IG1pblBvbHlTaWRlcyA9IDNcclxuICBjb25zdCBtYXhQb2x5U2lkZXMgPSAxMjhcclxuXHJcbiAgLy8gZW5vdWdoIGZvciBvbmUgcnVuIHRocm91Z2gsIHRoZW4gc3RvcCBsb2dnaW5nLCBvdGhlcndpc2Ugd2UgZmxvb2QgY29uc29sZVxyXG4gIC8vIGNhbGxpbmcgKmV2ZXJ5KiBmcmFtZVxyXG4gIGNvbnN0IGdyYWRpZW50TG9nZ2VyID0gbGltaXRlZExvZ2dlcigzMilcclxuXHJcbiAgbGV0IHBvbHlTaWRlcyA9IDVcclxuICBsZXQgcG9seVJvdGF0aW9uID0gMFxyXG4gIGxldCBzdHJva2VQb2x5ID0gZmFsc2VcclxuXHJcbiAgbGV0IGlzQWN0aXZlID0gdHJ1ZVxyXG5cclxuICBjb25zdCBpbml0ID0gYXN5bmMgKF9zdGF0ZTogU3RhdGUpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKCdzdGFydGluZyBkZWJ1ZyBzY2VuZScpXHJcblxyXG4gICAgdGVzdEltZzAgPSBhd2FpdCBsb2FkSW1hZ2UoJ3NjZW5lcy9kZWJ1Zy90ZXN0LTAucG5nJylcclxuICAgIHBhdHRlcm4wID0gYXdhaXQgbG9hZEltYWdlKCdzY2VuZXMvZGVidWcvcGF0dGVybi0wLnBuZycpXHJcbiAgICBjdXJzb3IgPSBhd2FpdCBsb2FkSW1hZ2UoJ3NjZW5lcy9kZWJ1Zy9jdXJzb3IucG5nJylcclxuXHJcbiAgICBwb2x5Um90YXRpb24gPSAwXHJcblxyXG4gICAgcGF0dGVybjBSb3dzID0gcm93UXVlcnkocGF0dGVybjAsIHIgPT4gciA9PT0gMClcclxuXHJcbiAgICBjb25zb2xlLmxvZygncGF0dGVybjBSb3dzJywgcGF0dGVybjBSb3dzKVxyXG5cclxuICAgIHRha2VNb3VzZSgpXHJcbiAgfVxyXG5cclxuICBjb25zdCBiZ0NvbG9yMDogVDMgPSBbMHgzMywgMHg5OSwgMHhmZl1cclxuICBjb25zdCBiZ0NvbG9yMTogVDMgPSBbMHgxMSwgMHg3NywgMHhkZF1cclxuXHJcbiAgY29uc3QgcGFpbnRDb2xvcjogVDMgPSBbMHhmZiwgMHg4OCwgMHgwMF1cclxuICBsZXQgcGFpbnRpbmcgPSBmYWxzZVxyXG4gIGxldCBsYXN0UGFpbnRYOiBNYXliZTxudW1iZXI+ID0gbnVsbFxyXG4gIGxldCBsYXN0UGFpbnRZOiBNYXliZTxudW1iZXI+ID0gbnVsbFxyXG5cclxuICAvLyBuYiAtIHRoZXNlIGFyZSByZXRhaW5lZCBldmVuIHdoZW4gdGhlIHNjZW5lIGV4aXRzIGFuZCByZXN0YXJ0c1xyXG4gIC8vIGFzIGEgdGVzdCBmb3Igc2NlbmVzIGhvbGRpbmcgc3RhdGUgYmV0d2VlbiBydW5zXHJcbiAgLy9cclxuICAvLyBpZiB0aGlzIGlzIG5vdCBkZXNpcmVkLCBzdGF0ZSBzaG91bGQgYmUgcmVzZXQgaW4gaW5pdCBvciBxdWl0IG9uIGVhY2ggcnVuXHJcbiAgLy9cclxuICBjb25zdCBwYWludFB0czogUmVjb3JkPG51bWJlciwgTWF5YmU8UmVjb3JkPG51bWJlciwgTWF5YmU8Ym9vbGVhbj4+Pj4gPSB7fVxyXG5cclxuICBjb25zdCBnZXRQYWludFJvdyA9ICh5OiBudW1iZXIpID0+IChwYWludFB0c1t5XSB8fCAocGFpbnRQdHNbeV0gPSB7fSkpXHJcblxyXG4gIGNvbnN0IGFkZFBhaW50UHQgPSAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IHtcclxuICAgIGlmIChtYXliZShsYXN0UGFpbnRYKSAmJiBtYXliZShsYXN0UGFpbnRZKSkge1xyXG4gICAgICBjb25zdCBsaW5lID0gYnJlc2VuaGFtTGluZShsYXN0UGFpbnRYLCBsYXN0UGFpbnRZLCB4LCB5KVxyXG5cclxuICAgICAgZm9yKCBjb25zdCBbIHgsIHkgXSBvZiBsaW5lICkge1xyXG4gICAgICAgIGdldFBhaW50Um93KHkpW3hdID0gdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBnZXRQYWludFJvdyh5KVt4XSA9IHRydWVcclxuICAgIH1cclxuXHJcbiAgICBsYXN0UGFpbnRYID0geFxyXG4gICAgbGFzdFBhaW50WSA9IHlcclxuICB9XHJcblxyXG4gIGxldCBmcmFtZSA9IDBcclxuXHJcbiAgY29uc3QgX2hhbmRsZUtleXMgPSAoc3RhdGU6IFN0YXRlKSA9PiB7XHJcbiAgICBpZiAoc3RhdGUua2V5c1snRXNjYXBlJ10pIHtcclxuICAgICAgc3RhdGUucnVubmluZyA9IGZhbHNlXHJcbiAgICAgIC8vIGNvbnN1bWUgdGhlIGtleVxyXG4gICAgICBzdGF0ZS5rZXlzWydFc2NhcGUnXSA9IGZhbHNlXHJcblxyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuXHJcbiAgICBpZiAoc3RhdGUua2V5c1snQXJyb3dVcCddKSB7XHJcbiAgICAgIHBvbHlTaWRlcy0tXHJcblxyXG4gICAgICBzdGF0ZS5rZXlzWydBcnJvd1VwJ10gPSBmYWxzZVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChzdGF0ZS5rZXlzWydBcnJvd0Rvd24nXSkge1xyXG4gICAgICBwb2x5U2lkZXMrK1xyXG5cclxuICAgICAgc3RhdGUua2V5c1snQXJyb3dEb3duJ10gPSBmYWxzZVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHNTdGF0ZSA9IHJlYWRBbHBoYShzdGF0ZSwgJ1MnLCB0cnVlKVxyXG5cclxuICAgIGlmIChzU3RhdGUpIHtcclxuICAgICAgc3Ryb2tlUG9seSA9ICFzdHJva2VQb2x5XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCB1cGRhdGUgPSAoc3RhdGU6IFN0YXRlKSA9PiB7XHJcbiAgICBpZiAoaXNBY3RpdmUpIHtcclxuICAgICAgX2hhbmRsZUtleXMoc3RhdGUpXHJcblxyXG4gICAgICBwb2x5U2lkZXMgPSBNYXRoLm1pbihNYXRoLm1heChwb2x5U2lkZXMsIG1pblBvbHlTaWRlcyksIG1heFBvbHlTaWRlcylcclxuXHJcbiAgICAgIC8vIGNhcHR1cmUgYSByZWZlcmVuY2UgLSBpdCBpcyBhIGRlc3RydWN0aXZlIHJlYWRcclxuICAgICAgY29uc3Qgd2hlZWwgPSBzdGF0ZS5tb3VzZS53aGVlbFxyXG5cclxuICAgICAgaWYgKHdoZWVsIDwgMCkge1xyXG4gICAgICAgIHN0YXRlLnZpZXcuem9vbSArPSAxXHJcbiAgICAgIH0gZWxzZSBpZiAod2hlZWwgPiAwKSB7XHJcbiAgICAgICAgc3RhdGUudmlldy56b29tIC09IDFcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHN0YXRlLm1vdXNlLmJ1dHRvbnNbMF0pIHtcclxuICAgICAgICBhZGRQYWludFB0KHN0YXRlLm1vdXNlLngsIHN0YXRlLm1vdXNlLnkpXHJcbiAgICAgICAgcGFpbnRpbmcgPSB0cnVlXHJcbiAgICAgIH0gZWxzZSBpZiAocGFpbnRpbmcpIHtcclxuICAgICAgICBwYWludGluZyA9IGZhbHNlXHJcbiAgICAgICAgbGFzdFBhaW50WCA9IG51bGxcclxuICAgICAgICBsYXN0UGFpbnRZID0gbnVsbFxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgeyBidWZmZXIgfSA9IHN0YXRlLnZpZXdcclxuICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gYnVmZmVyXHJcblxyXG4gICAgLy8gbm90IHZlcnkgZWZmaWNlbnQgLSBwbGVudHkgb2YgZmFzdGVyIHdheXMgdG8gZG8gdGhpcyAtIGJ1dCB0aGF0J3MgYSBnb29kXHJcbiAgICAvLyB0aGluZywgd2UncmUgdHJ5aW5nIHRvIHN0dWZmIGFzIG11Y2ggaW50byB0aGUgZGVidWcgc2NlbmUgYXMgcG9zc2libGVcclxuICAgIC8vIHNvIHdlIGNhbiBnaXZlIGl0IGEgYml0IG9mIGEgc3RyZXNzIHRlc3RcclxuICAgIC8vXHJcbiAgICAvLyBldmVuIHdpdGggZXZlcnl0aGluZyB3ZSdyZSBkb2luZyBzdGlsbCBjb21mb3J0YWJseSBydW5zIGF0IDYwZnBzIHRobyFcclxuXHJcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7XHJcbiAgICAgIGNvbnN0IHJvdyA9IHkgKiB3aWR0aFxyXG5cclxuICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSByb3cgKyB4XHJcbiAgICAgICAgY29uc3QgZGF0YUluZGV4ID0gaW5kZXggKiA0XHJcblxyXG4gICAgICAgIGNvbnN0IGlzUGFpbnQgPSBwYWludFB0c1t5XSAmJiBwYWludFB0c1t5XSFbeF1cclxuXHJcbiAgICAgICAgaWYgKGlzUGFpbnQpIHtcclxuICAgICAgICAgIGJ1ZmZlci5kYXRhW2RhdGFJbmRleF0gPSBwYWludENvbG9yWzBdXHJcbiAgICAgICAgICBidWZmZXIuZGF0YVtkYXRhSW5kZXggKyAxXSA9IHBhaW50Q29sb3JbMV1cclxuICAgICAgICAgIGJ1ZmZlci5kYXRhW2RhdGFJbmRleCArIDJdID0gcGFpbnRDb2xvclsyXVxyXG4gICAgICAgICAgYnVmZmVyLmRhdGFbZGF0YUluZGV4ICsgM10gPSAweGZmXHJcblxyXG4gICAgICAgICAgY29udGludWVcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGlzQ2hlY2sgPSAoeCArIHkpICUgMiA9PT0gMFxyXG5cclxuICAgICAgICBidWZmZXIuZGF0YVtkYXRhSW5kZXhdID0gaXNDaGVjayA/IGJnQ29sb3IwWzBdIDogYmdDb2xvcjFbMF1cclxuICAgICAgICBidWZmZXIuZGF0YVtkYXRhSW5kZXggKyAxXSA9IGlzQ2hlY2sgPyBiZ0NvbG9yMFsxXSA6IGJnQ29sb3IxWzFdXHJcbiAgICAgICAgYnVmZmVyLmRhdGFbZGF0YUluZGV4ICsgMl0gPSBpc0NoZWNrID8gYmdDb2xvcjBbMl0gOiBiZ0NvbG9yMVsyXVxyXG4gICAgICAgIGJ1ZmZlci5kYXRhW2RhdGFJbmRleCArIDNdID0gMHhmZlxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gc3ByaXRlcywgYmxpdHRpbmcsIGNvbXBvc2l0ZSBldGNcclxuXHJcbiAgICAvLyBhMC4uYjcgICAgXHJcbiAgICBjb25zdCB0ZXN0R3JpZCA9IGdlbmVyYXRlTmFtZWRHcmlkTGF5b3V0KFxyXG4gICAgICBnZW5lcmF0ZUdyaWRMYXlvdXQoMzIsIDMyLCAyLCA4LCAxLCAxKVxyXG4gICAgKVxyXG5cclxuICAgIGNvbnN0IHsgd2lkdGg6IGd3IH0gPSB0ZXN0R3JpZFxyXG5cclxuICAgIGNvbnN0IG9mZlggPSB3aWR0aCAtIGd3XHJcbiAgICBjb25zdCBvZmZZID0gMFxyXG5cclxuICAgIC8vIHN0cmFpZ2h0IGJsaXRcclxuXHJcbiAgICBjb25zdCB7IGEwIH0gPSB0ZXN0R3JpZFxyXG4gICAgY29uc3QgYTBYID0gYTBbMF0gKyBvZmZYXHJcbiAgICBjb25zdCBhMFkgPSBhMFsxXSArIG9mZllcclxuXHJcbiAgICBibGl0KHRlc3RJbWcwLCBidWZmZXIsIFswLCAwLCB0ZXN0SW1nMC53aWR0aCwgdGVzdEltZzAuaGVpZ2h0LCBhMFgsIGEwWV0pXHJcblxyXG4gICAgLy8gdGVzdGluZyBvb2Igb24gc3JjXHJcblxyXG4gICAgY29uc3QgeyBiMCB9ID0gdGVzdEdyaWRcclxuICAgIGNvbnN0IGIwWCA9IGIwWzBdICsgb2ZmWCAtIDE2XHJcbiAgICBjb25zdCBiMFkgPSBiMFsxXSArIG9mZlkgLSAxNlxyXG5cclxuICAgIGJsaXQoXHJcbiAgICAgIHRlc3RJbWcwLCBidWZmZXIsXHJcbiAgICAgIFtcclxuICAgICAgICAtMTYsIC0xNiwgdGVzdEltZzAud2lkdGggKyAzMiwgdGVzdEltZzAuaGVpZ2h0ICsgMzIsXHJcbiAgICAgICAgYjBYLCBiMFlcclxuICAgICAgXVxyXG4gICAgKVxyXG5cclxuICAgIC8vIGFscGhhIGNvbXBvc2l0ZVxyXG5cclxuICAgIGNvbnN0IHsgYTEgfSA9IHRlc3RHcmlkXHJcbiAgICBjb25zdCBhMVggPSBhMVswXSArIG9mZlhcclxuICAgIGNvbnN0IGExWSA9IGExWzFdICsgb2ZmWVxyXG5cclxuICAgIGNvbXBvc2l0ZShcclxuICAgICAgdGVzdEltZzAsIGJ1ZmZlciwgWzAsIDAsIHRlc3RJbWcwLndpZHRoLCB0ZXN0SW1nMC5oZWlnaHQsIGExWCwgYTFZXSwgMC41XHJcbiAgICApXHJcblxyXG4gICAgLy8gb29iIG9uIGRlc3RcclxuXHJcbiAgICBjb25zdCB7IGIxIH0gPSB0ZXN0R3JpZFxyXG4gICAgY29uc3QgYjFYID0gYjFbMF0gKyBvZmZYICsgMTZcclxuICAgIGNvbnN0IGIxWSA9IGIxWzFdICsgb2ZmWVxyXG5cclxuICAgIGJsaXQoXHJcbiAgICAgIHRlc3RJbWcwLCBidWZmZXIsXHJcbiAgICAgIFtcclxuICAgICAgICAwLCAwLCB0ZXN0SW1nMC53aWR0aCwgdGVzdEltZzAuaGVpZ2h0LFxyXG4gICAgICAgIGIxWCwgYjFZXHJcbiAgICAgIF1cclxuICAgIClcclxuXHJcbiAgICAvLyBjb2xvciBmaWxsXHJcblxyXG4gICAgY29uc3QgeyBhMiB9ID0gdGVzdEdyaWRcclxuICAgIGNvbnN0IGEyWCA9IGEyWzBdICsgb2ZmWFxyXG4gICAgY29uc3QgYTJZID0gYTJbMV0gKyBvZmZZXHJcblxyXG4gICAgY29uc3QgY29sb3IgPSBjcmVhdGVDb2xvcigweDZjLCAweDI4LCAweGJjKVxyXG5cclxuICAgIGZpbGwoXHJcbiAgICAgIGJ1ZmZlciwgY29sb3IsXHJcbiAgICAgIFthMlgsIGEyWSwgdGVzdEltZzAud2lkdGgsIHRlc3RJbWcwLmhlaWdodF1cclxuICAgIClcclxuXHJcbiAgICAvLyBzcHJpdGUgcm90YXRpb25cclxuXHJcbiAgICBjb25zdCB7IGIyIH0gPSB0ZXN0R3JpZFxyXG4gICAgY29uc3QgYjJYID0gYjJbMF0gKyBvZmZYICsgdGVzdEltZzAud2lkdGggLyAyXHJcbiAgICBjb25zdCBiMlkgPSBiMlsxXSArIG9mZlkgKyB0ZXN0SW1nMC5oZWlnaHQgLyAyXHJcblxyXG4gICAgZHJhd1JvdGF0ZWQoXHJcbiAgICAgIHRlc3RJbWcwLCB0ZXN0SW1nMC53aWR0aCAvIDIsIHRlc3RJbWcwLmhlaWdodCAvIDIsXHJcbiAgICAgIGJ1ZmZlciwgYjJYLCBiMlksXHJcbiAgICAgIHBvbHlSb3RhdGlvblxyXG4gICAgKVxyXG5cclxuICAgIC8vIGJsaXRSb3dzIHRlc3RcclxuXHJcbiAgICBjb25zdCB7IGEzIH0gPSB0ZXN0R3JpZFxyXG4gICAgY29uc3QgYTNYID0gYTNbMF0gKyBvZmZYXHJcbiAgICBjb25zdCBhM1kgPSBhM1sxXSArIG9mZllcclxuXHJcbiAgICBmaWxsKGJ1ZmZlciwgY3JlYXRlQ29sb3IoMCwgMCwgMCksIFthM1gsIGEzWSwgcGF0dGVybjAud2lkdGgsIHBhdHRlcm4wLmhlaWdodF0pXHJcblxyXG4gICAgYmxpdFJvd3MoXHJcbiAgICAgIHBhdHRlcm5Db2xvckltYWdlLCBwYXR0ZXJuMFJvd3MsIGJ1ZmZlciwgYTNYLCBhM1lcclxuICAgIClcclxuXHJcbiAgICAvLyBncmFkaWVudCB0ZXN0XHJcblxyXG4gICAgY29uc3QgeyBiMyB9ID0gdGVzdEdyaWRcclxuICAgIGNvbnN0IGIzWCA9IGIzWzBdICsgb2ZmWFxyXG4gICAgY29uc3QgYjNZID0gYjNbMV0gKyBvZmZZXHJcblxyXG4gICAgY29uc3QgZ0NvbG9yczAgPSBnZW5lcmF0ZUh1ZXMoNilcclxuXHJcbiAgICBjb25zdCBzdGVwMCA9IDEgLyAoZ0NvbG9yczAubGVuZ3RoIC0gMSlcclxuXHJcbiAgICBjb25zdCBnU3RvcHMwID0gZ0NvbG9yczAubWFwKChjLCBpKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJnYmEgPSBjb2xvclRvUmdiYShjKVxyXG5cclxuICAgICAgcmV0dXJuIFsuLi5yZ2JhLCBpICogc3RlcDBdIGFzIFQ1XHJcbiAgICB9KVxyXG5cclxuICAgIGNvbnN0IGdJbWFnZTAgPSBjcmVhdGVJbWFnZSgzMiwgMzIpXHJcblxyXG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCBnSW1hZ2UwLndpZHRoOyB4KyspIHtcclxuICAgICAgY29uc3QgYXQgPSB4IC8gKGdJbWFnZTAud2lkdGggLSAxKVxyXG4gICAgICBjb25zdCByZ2JhID0gc2FtcGxlR3JhZGllbnQoZ1N0b3BzMCwgYXQpXHJcbiAgICAgIGNvbnN0IGNvbG9yID0gY3JlYXRlQ29sb3IoLi4ucmdiYSlcclxuXHJcbiAgICAgIGZpbGxDb2woZ0ltYWdlMCwgY29sb3IsIHgpXHJcbiAgICB9XHJcblxyXG4gICAgYmxpdChnSW1hZ2UwLCBidWZmZXIsIFswLCAwLCBnSW1hZ2UwLndpZHRoLCBnSW1hZ2UwLmhlaWdodCwgYjNYLCBiM1ldKVxyXG5cclxuICAgIC8vIGdyYWRpZW50IHRlc3QgMiwgYWxwaGEgKyBjb21wb3NpdGVcclxuXHJcbiAgICBjb25zdCB7IGE0IH0gPSB0ZXN0R3JpZFxyXG4gICAgY29uc3QgYTRYID0gYTRbMF0gKyBvZmZYXHJcbiAgICBjb25zdCBhNFkgPSBhNFsxXSArIG9mZllcclxuXHJcbiAgICBjb25zdCBnQ29sb3JzMSA9IGdDb2xvcnMwLnNsaWNlKCkucmV2ZXJzZSgpXHJcblxyXG4gICAgY29uc3Qgc3RlcDEgPSAxIC8gKGdDb2xvcnMxLmxlbmd0aCAtIDEpXHJcblxyXG4gICAgY29uc3QgZ3N0b3BzMSA9IGdDb2xvcnMxLm1hcCgoYywgaSkgPT4ge1xyXG4gICAgICBjb25zdCBbciwgZywgYl0gPSBjb2xvclRvUmdiYShjKVxyXG4gICAgICBjb25zdCBhID0gaSAqIHN0ZXAxICogMjU1XHJcblxyXG4gICAgICByZXR1cm4gW3IsIGcsIGIsIGEsIGkgKiBzdGVwMV0gYXMgVDVcclxuICAgIH0pXHJcblxyXG4gICAgY29uc3QgZ0ltYWdlMSA9IGNyZWF0ZUltYWdlKDMyLCAzMilcclxuXHJcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGdJbWFnZTEud2lkdGg7IHgrKykge1xyXG4gICAgICBjb25zdCBhdCA9IHggLyAoZ0ltYWdlMS53aWR0aCAtIDEpXHJcbiAgICAgIGNvbnN0IHJnYmEgPSBzYW1wbGVHcmFkaWVudChnc3RvcHMxLCBhdClcclxuICAgICAgY29uc3QgY29sb3IgPSBjcmVhdGVDb2xvciguLi5yZ2JhKVxyXG5cclxuICAgICAgZ3JhZGllbnRMb2dnZXIubG9nKCdncmFkaWVudCcsIHgsIHJnYmEpXHJcblxyXG4gICAgICBmaWxsQ29sKGdJbWFnZTEsIGNvbG9yLCB4KVxyXG4gICAgfVxyXG5cclxuICAgIGNvbXBvc2l0ZShcclxuICAgICAgZ0ltYWdlMSwgYnVmZmVyLCBbMCwgMCwgZ0ltYWdlMS53aWR0aCwgZ0ltYWdlMS5oZWlnaHQsIGE0WCwgYTRZXVxyXG4gICAgKVxyXG5cclxuICAgIC8vIGhvcml6b250YWxseSBzbG9waW5nIGxpbmVcclxuXHJcbiAgICBjb25zdCB0ZXN0TGluZUNvbG9yID0gY3JlYXRlQ29sb3IoMHgzMywgMHhmZiwgMHg5OSlcclxuXHJcbiAgICBjb25zdCB0ZXN0TGluZTogVDQgPSBbLTMyLCBoZWlnaHQgLyAyIC0gMzIsIHdpZHRoICsgMzIsIGhlaWdodCAvIDIgKyAzMl1cclxuXHJcbiAgICAvLyBuYiAtIHRoaXMgaXMgb25seSBmYXN0ZXIgd2l0aCB0aGUgcmlnaHQgc2xvcGUgLSBvdGhlcndpc2UgaXQgaXMgc2xvd2VyXHJcbiAgICAvLyBpdCBpcyBiZXR0ZXIgdG8gdXNlIGJyZXNlbmhhbSBmb3IgdGhlIGdlbmVyYWwgY2FzZVxyXG4gICAgY29uc3QgdGVzdExpbmVSb3dzID0gbGluZVRvUm93cyguLi50ZXN0TGluZSlcclxuXHJcbiAgICBmaWxsUm93cyh0ZXN0TGluZVJvd3MsIGJ1ZmZlciwgdGVzdExpbmVDb2xvcilcclxuXHJcbiAgICAvLyByZWN0IHZpYSByb3dzXHJcblxyXG4gICAgY29uc3QgcmVjdENvbG9yID0gY3JlYXRlQ29sb3IoMHhmZiwgMHg5OSwgMHgzMylcclxuXHJcbiAgICBjb25zdCB0ZXN0UmVjdDogVDQgPSBbNDgsIDQ4LCAzMiwgMjRdXHJcbiAgICBjb25zdCB0ZXN0UmVjdFJvd3MgPSByZWN0VG9Sb3dzKC4uLnRlc3RSZWN0KVxyXG5cclxuICAgIGZpbGxSb3dzKHRlc3RSZWN0Um93cywgYnVmZmVyLCByZWN0Q29sb3IpXHJcblxyXG4gICAgLy8gcG9seWdvblxyXG5cclxuICAgIGNvbnN0IG1pblNpZGUgPSBNYXRoLm1pbih3aWR0aCwgaGVpZ2h0KVxyXG4gICAgY29uc3QgZmlsbENvbG9ycyA9IGdlbmVyYXRlSHVlcyhwb2x5U2lkZXMpXHJcblxyXG4gICAgY29uc3Qgc2hhcGUgPSBwb2x5Z29uVHJpYW5nbGVzKFxyXG4gICAgICBwb2x5U2lkZXMsIHdpZHRoIC8gMiwgaGVpZ2h0IC8gMiwgbWluU2lkZSAvIDQsIHBvbHlSb3RhdGlvblxyXG4gICAgKVxyXG5cclxuICAgIGNvbnN0IGZyYW1lVGltZSA9IHN0YXRlLnRpbWUuZnJhbWVUaW1lXHJcbiAgICBjb25zdCByb3RhdGVCeSA9IDAuMDAxICogZnJhbWVUaW1lXHJcblxyXG4gICAgY29uc3Qgc3Ryb2tlTGluZSA9IChsaW5lOiBUNCwgY29sb3I6IG51bWJlcikgPT4ge1xyXG4gICAgICBjb25zdCBwdHMgPSBicmVzZW5oYW1MaW5lKC4uLmxpbmUpXHJcbiAgICAgIGNvbnN0IGluZGljZXMgPSBwb2ludHNUb0luZGljZXMod2lkdGgsIGhlaWdodCwgMSkocHRzKVxyXG5cclxuICAgICAgZmlsbEluZGljZXMoaW5kaWNlcywgYnVmZmVyLCBjb2xvcilcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzdHJva2VUcmkgPSAodHJpOiBUMzxUMj4sIGNvbG9yOiBudW1iZXIpID0+IHtcclxuICAgICAgY29uc3QgbGluZTA6IFQ0ID0gW3RyaVswXVswXSwgdHJpWzBdWzFdLCB0cmlbMV1bMF0sIHRyaVsxXVsxXV1cclxuICAgICAgY29uc3QgbGluZTE6IFQ0ID0gW3RyaVsxXVswXSwgdHJpWzFdWzFdLCB0cmlbMl1bMF0sIHRyaVsyXVsxXV1cclxuICAgICAgY29uc3QgbGluZTI6IFQ0ID0gW3RyaVsyXVswXSwgdHJpWzJdWzFdLCB0cmlbMF1bMF0sIHRyaVswXVsxXV1cclxuXHJcbiAgICAgIHN0cm9rZUxpbmUobGluZTAsIGNvbG9yKVxyXG4gICAgICBzdHJva2VMaW5lKGxpbmUxLCBjb2xvcilcclxuICAgICAgc3Ryb2tlTGluZShsaW5lMiwgY29sb3IpXHJcbiAgICB9XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb2x5U2lkZXM7IGkrKykge1xyXG4gICAgICBjb25zdCBjb2xvciA9IGZpbGxDb2xvcnNbaSAlIGZpbGxDb2xvcnMubGVuZ3RoXVxyXG4gICAgICBjb25zdCB0cmkgPSBzaGFwZVtpXVxyXG5cclxuICAgICAgY29uc3QgcHRyaVJvd3MgPSB0cmlhbmdsZVRvUm93cyguLi50cmkpXHJcbiAgICAgIGZpbGxSb3dzKHB0cmlSb3dzLCBidWZmZXIsIGNvbG9yKVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0cm9rZUNvbG9ycyA9IHN0cm9rZVBvbHkgPyBnZW5lcmF0ZUh1ZXMocG9seVNpZGVzLCA1MCkgOiBmaWxsQ29sb3JzXHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwb2x5U2lkZXM7IGkrKykge1xyXG4gICAgICBjb25zdCBjb2xvciA9IHN0cm9rZUNvbG9yc1tpICUgc3Ryb2tlQ29sb3JzLmxlbmd0aF1cclxuICAgICAgY29uc3QgdHJpID0gc2hhcGVbaV1cclxuXHJcbiAgICAgIHN0cm9rZVRyaSh0cmksIGNvbG9yKVxyXG4gICAgfVxyXG5cclxuICAgIC8vXHJcblxyXG4gICAgaWYgKHN0YXRlLm1vdXNlLmluQm91bmRzKSB7XHJcbiAgICAgIGNvbXBvc2l0ZShcclxuICAgICAgICBjdXJzb3IsIGJ1ZmZlcixcclxuICAgICAgICBbMCwgMCwgY3Vyc29yLndpZHRoLCBjdXJzb3IuaGVpZ2h0LCBzdGF0ZS5tb3VzZS54LCBzdGF0ZS5tb3VzZS55XVxyXG4gICAgICApXHJcbiAgICB9XHJcblxyXG4gICAgLy9cclxuXHJcbiAgICBwb2x5Um90YXRpb24gKz0gcm90YXRlQnlcclxuXHJcbiAgICBmcmFtZSsrXHJcbiAgfVxyXG5cclxuICBjb25zdCBxdWl0ID0gYXN5bmMgKHN0YXRlOiBTdGF0ZSkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ3F1aXR0aW5nIGRlYnVnIHNjZW5lJylcclxuICAgIHN0YXRlLmRlYnVnID0gZmFsc2VcclxuICAgIHJlbGVhc2VNb3VzZSgpXHJcbiAgfVxyXG5cclxuICBjb25zdCBzZXRBY3RpdmUgPSAoYWN0aXZlOiBib29sZWFuKSA9PiB7XHJcbiAgICAvLyB3ZSBqdXN0IGdvdCBmb2N1c1xyXG4gICAgaWYgKGFjdGl2ZSAmJiAhaXNBY3RpdmUpIHtcclxuICAgICAgdGFrZU1vdXNlKClcclxuICAgIH1cclxuXHJcbiAgICAvLyB3ZSBqdXN0IGxvc3QgZm9jdXMgXHJcbiAgICBpZiAoIWFjdGl2ZSAmJiBpc0FjdGl2ZSkge1xyXG4gICAgICByZWxlYXNlTW91c2UoKVxyXG4gICAgfVxyXG5cclxuICAgIGlzQWN0aXZlID0gYWN0aXZlXHJcbiAgfVxyXG5cclxuICByZXR1cm4geyBpbml0LCB1cGRhdGUsIHF1aXQsIHNldEFjdGl2ZSB9XHJcbn1cclxuIl19