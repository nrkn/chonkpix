import { assrt } from '../../lib/util.js';
export const viewState = (width, height, tileW, tileH) => {
    const tileCx = Math.floor(tileW / 2);
    const tileCy = Math.floor(tileH / 2);
    const state = {
        cols: 0,
        rows: 0,
        vLeft: 0,
        vTop: 0,
        colLeft: 0,
        rowTop: 0,
        prevIndices: Array(),
        currIndices: Array(),
        animated: new Set()
    };
    const invalidate = (w, h) => {
        width = w;
        height = h;
        const cx = Math.floor(width / 2);
        const cy = Math.floor(height / 2);
        const availW = width - tileW;
        const availH = height - tileH;
        const colsPerSide = Math.ceil(availW / 2 / tileW);
        const rowsPerSide = Math.ceil(availH / 2 / tileH);
        state.cols = colsPerSide * 2 + 1;
        state.rows = rowsPerSide * 2 + 1;
        state.vLeft = cx - colsPerSide * tileW - tileCx;
        state.vTop = cy - rowsPerSide * tileH - tileCy;
        state.prevIndices = Array(state.cols * state.rows);
        state.currIndices = Array(state.cols * state.rows);
        state.colLeft = -colsPerSide;
        state.rowTop = -rowsPerSide;
        state.animated.clear();
    };
    invalidate(width, height);
    return { state, invalidate };
};
export const setIndices = (tilemap, indices, animated, x, y, w, h, elapsed, emptyId) => {
    for (let j = 0; j < h; j++) {
        const row = j + y;
        for (let i = 0; i < w; i++) {
            const col = i + x;
            const valIndex = j * w + i;
            if (row < 0 || row >= tilemap.height || col < 0 || col >= tilemap.width) {
                indices[valIndex] = emptyId;
                continue;
            }
            const tileIndex = row * tilemap.width + col;
            const tile = tilemap.data[tileIndex];
            let rectIndex;
            if (typeof tile === 'function') {
                rectIndex = assrt(tile(elapsed), 'Expected rectIndex');
                animated.add(valIndex);
            }
            else {
                rectIndex = tile;
            }
            indices[valIndex] = rectIndex;
        }
    }
};
export const clearIndicesForRow = (indices, row, w) => {
    const rowStart = row * w;
    for (let i = 0; i < w; i++) {
        const valIndex = rowStart + i;
        indices[valIndex] = null;
    }
};
export const clearIndicesForCol = (indices, col, w, h) => {
    for (let j = 0; j < h; j++) {
        const valIndex = j * w + col;
        indices[valIndex] = null;
    }
};
export const scrollIndices = (src, dest, w, h, x, y) => {
    for (let destY = 0; destY < h; destY++) {
        const srcY = destY + y;
        for (let destX = 0; destX < w; destX++) {
            const srcX = destX + x;
            if (srcY < 0 || srcY >= h || srcX < 0 || srcX >= w) {
                dest[destY * w + destX] = null;
                continue;
            }
            dest[destY * w + destX] = src[srcY * w + srcX];
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy1zdGF0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9zY2VuZXMvcmFuZ2VyL3ZpZXctc3RhdGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLG1CQUFtQixDQUFBO0FBR3pDLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxDQUN2QixLQUFhLEVBQUUsTUFBYyxFQUM3QixLQUFhLEVBQUUsS0FBYSxFQUM1QixFQUFFO0lBQ0YsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFDcEMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUE7SUFFcEMsTUFBTSxLQUFLLEdBQWM7UUFDdkIsSUFBSSxFQUFFLENBQUM7UUFDUCxJQUFJLEVBQUUsQ0FBQztRQUNQLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxFQUFFLENBQUM7UUFDUCxPQUFPLEVBQUUsQ0FBQztRQUNWLE1BQU0sRUFBRSxDQUFDO1FBQ1QsV0FBVyxFQUFFLEtBQUssRUFBaUI7UUFDbkMsV0FBVyxFQUFFLEtBQUssRUFBaUI7UUFDbkMsUUFBUSxFQUFFLElBQUksR0FBRyxFQUFVO0tBQzVCLENBQUE7SUFFRCxNQUFNLFVBQVUsR0FBRyxDQUFDLENBQVMsRUFBRSxDQUFTLEVBQUUsRUFBRTtRQUMxQyxLQUFLLEdBQUcsQ0FBQyxDQUFBO1FBQ1QsTUFBTSxHQUFHLENBQUMsQ0FBQTtRQUVWLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFBO1FBQ2hDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFBO1FBRWpDLE1BQU0sTUFBTSxHQUFHLEtBQUssR0FBRyxLQUFLLENBQUE7UUFDNUIsTUFBTSxNQUFNLEdBQUcsTUFBTSxHQUFHLEtBQUssQ0FBQTtRQUU3QixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUE7UUFDakQsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFBO1FBRWpELEtBQUssQ0FBQyxJQUFJLEdBQUcsV0FBVyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7UUFDaEMsS0FBSyxDQUFDLElBQUksR0FBRyxXQUFXLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQTtRQUVoQyxLQUFLLENBQUMsS0FBSyxHQUFHLEVBQUUsR0FBRyxXQUFXLEdBQUcsS0FBSyxHQUFHLE1BQU0sQ0FBQTtRQUMvQyxLQUFLLENBQUMsSUFBSSxHQUFHLEVBQUUsR0FBRyxXQUFXLEdBQUcsS0FBSyxHQUFHLE1BQU0sQ0FBQTtRQUU5QyxLQUFLLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBZ0IsS0FBSyxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDakUsS0FBSyxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQWdCLEtBQUssQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBRWpFLEtBQUssQ0FBQyxPQUFPLEdBQUcsQ0FBQyxXQUFXLENBQUE7UUFDNUIsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLFdBQVcsQ0FBQTtRQUUzQixLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFBO0lBQ3hCLENBQUMsQ0FBQTtJQUVELFVBQVUsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFFekIsT0FBTyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsQ0FBQTtBQUM5QixDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsQ0FDeEIsT0FBZ0IsRUFDaEIsT0FBd0IsRUFDeEIsUUFBcUIsRUFDckIsQ0FBUyxFQUFFLENBQVMsRUFBRSxDQUFTLEVBQUUsQ0FBUyxFQUMxQyxPQUFlLEVBQUUsT0FBZSxFQUNoQyxFQUFFO0lBQ0YsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzNCLE1BQU0sR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7UUFFakIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzNCLE1BQU0sR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7WUFFakIsTUFBTSxRQUFRLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUE7WUFFMUIsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLEdBQUcsSUFBSSxPQUFPLENBQUMsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDeEUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLE9BQU8sQ0FBQTtnQkFFM0IsU0FBUTtZQUNWLENBQUM7WUFFRCxNQUFNLFNBQVMsR0FBRyxHQUFHLEdBQUcsT0FBTyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUE7WUFDM0MsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtZQUVwQyxJQUFJLFNBQWlCLENBQUE7WUFFckIsSUFBSSxPQUFPLElBQUksS0FBSyxVQUFVLEVBQUUsQ0FBQztnQkFDL0IsU0FBUyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsb0JBQW9CLENBQUMsQ0FBQTtnQkFDdEQsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQTtZQUN4QixDQUFDO2lCQUFNLENBQUM7Z0JBQ04sU0FBUyxHQUFHLElBQUksQ0FBQTtZQUNsQixDQUFDO1lBRUQsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLFNBQVMsQ0FBQTtRQUMvQixDQUFDO0lBQ0gsQ0FBQztBQUNILENBQUMsQ0FBQTtBQUVELE1BQU0sQ0FBQyxNQUFNLGtCQUFrQixHQUFHLENBQ2hDLE9BQXdCLEVBQ3hCLEdBQVcsRUFDWCxDQUFTLEVBQ1QsRUFBRTtJQUNGLE1BQU0sUUFBUSxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUE7SUFFeEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzNCLE1BQU0sUUFBUSxHQUFHLFFBQVEsR0FBRyxDQUFDLENBQUE7UUFFN0IsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQTtJQUMxQixDQUFDO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsTUFBTSxDQUFDLE1BQU0sa0JBQWtCLEdBQUcsQ0FDaEMsT0FBd0IsRUFDeEIsR0FBVyxFQUNYLENBQVMsRUFBRSxDQUFTLEVBQ3BCLEVBQUU7SUFDRixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDM0IsTUFBTSxRQUFRLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUE7UUFFNUIsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQTtJQUMxQixDQUFDO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLENBQzNCLEdBQW9CLEVBQ3BCLElBQXFCLEVBQ3JCLENBQVMsRUFBRSxDQUFTLEVBQ3BCLENBQVMsRUFBRSxDQUFTLEVBQ3BCLEVBQUU7SUFDRixLQUFLLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUM7UUFDdkMsTUFBTSxJQUFJLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQTtRQUV0QixLQUFLLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUM7WUFDdkMsTUFBTSxJQUFJLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQTtZQUV0QixJQUFJLElBQUksR0FBRyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDbkQsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFBO2dCQUM5QixTQUFRO1lBQ1YsQ0FBQztZQUVELElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQyxHQUFHLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFBO1FBQ2hELENBQUM7SUFDSCxDQUFDO0FBQ0gsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWF5YmUgfSBmcm9tICcuLi8uLi9saWIvdHlwZXMuanMnXHJcbmltcG9ydCB7IGFzc3J0IH0gZnJvbSAnLi4vLi4vbGliL3V0aWwuanMnXHJcbmltcG9ydCB7IFRpbGVNYXAsIFZpZXdTdGF0ZSB9IGZyb20gJy4vdHlwZXMuanMnXHJcblxyXG5leHBvcnQgY29uc3Qgdmlld1N0YXRlID0gKFxyXG4gIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLFxyXG4gIHRpbGVXOiBudW1iZXIsIHRpbGVIOiBudW1iZXJcclxuKSA9PiB7XHJcbiAgY29uc3QgdGlsZUN4ID0gTWF0aC5mbG9vcih0aWxlVyAvIDIpXHJcbiAgY29uc3QgdGlsZUN5ID0gTWF0aC5mbG9vcih0aWxlSCAvIDIpXHJcblxyXG4gIGNvbnN0IHN0YXRlOiBWaWV3U3RhdGUgPSB7XHJcbiAgICBjb2xzOiAwLFxyXG4gICAgcm93czogMCxcclxuICAgIHZMZWZ0OiAwLFxyXG4gICAgdlRvcDogMCxcclxuICAgIGNvbExlZnQ6IDAsXHJcbiAgICByb3dUb3A6IDAsXHJcbiAgICBwcmV2SW5kaWNlczogQXJyYXk8TWF5YmU8bnVtYmVyPj4oKSxcclxuICAgIGN1cnJJbmRpY2VzOiBBcnJheTxNYXliZTxudW1iZXI+PigpLFxyXG4gICAgYW5pbWF0ZWQ6IG5ldyBTZXQ8bnVtYmVyPigpXHJcbiAgfVxyXG5cclxuICBjb25zdCBpbnZhbGlkYXRlID0gKHc6IG51bWJlciwgaDogbnVtYmVyKSA9PiB7XHJcbiAgICB3aWR0aCA9IHdcclxuICAgIGhlaWdodCA9IGhcclxuXHJcbiAgICBjb25zdCBjeCA9IE1hdGguZmxvb3Iod2lkdGggLyAyKVxyXG4gICAgY29uc3QgY3kgPSBNYXRoLmZsb29yKGhlaWdodCAvIDIpXHJcblxyXG4gICAgY29uc3QgYXZhaWxXID0gd2lkdGggLSB0aWxlV1xyXG4gICAgY29uc3QgYXZhaWxIID0gaGVpZ2h0IC0gdGlsZUhcclxuXHJcbiAgICBjb25zdCBjb2xzUGVyU2lkZSA9IE1hdGguY2VpbChhdmFpbFcgLyAyIC8gdGlsZVcpXHJcbiAgICBjb25zdCByb3dzUGVyU2lkZSA9IE1hdGguY2VpbChhdmFpbEggLyAyIC8gdGlsZUgpXHJcblxyXG4gICAgc3RhdGUuY29scyA9IGNvbHNQZXJTaWRlICogMiArIDFcclxuICAgIHN0YXRlLnJvd3MgPSByb3dzUGVyU2lkZSAqIDIgKyAxXHJcblxyXG4gICAgc3RhdGUudkxlZnQgPSBjeCAtIGNvbHNQZXJTaWRlICogdGlsZVcgLSB0aWxlQ3hcclxuICAgIHN0YXRlLnZUb3AgPSBjeSAtIHJvd3NQZXJTaWRlICogdGlsZUggLSB0aWxlQ3lcclxuXHJcbiAgICBzdGF0ZS5wcmV2SW5kaWNlcyA9IEFycmF5PE1heWJlPG51bWJlcj4+KHN0YXRlLmNvbHMgKiBzdGF0ZS5yb3dzKVxyXG4gICAgc3RhdGUuY3VyckluZGljZXMgPSBBcnJheTxNYXliZTxudW1iZXI+PihzdGF0ZS5jb2xzICogc3RhdGUucm93cylcclxuXHJcbiAgICBzdGF0ZS5jb2xMZWZ0ID0gLWNvbHNQZXJTaWRlXHJcbiAgICBzdGF0ZS5yb3dUb3AgPSAtcm93c1BlclNpZGVcclxuXHJcbiAgICBzdGF0ZS5hbmltYXRlZC5jbGVhcigpXHJcbiAgfVxyXG5cclxuICBpbnZhbGlkYXRlKHdpZHRoLCBoZWlnaHQpXHJcblxyXG4gIHJldHVybiB7IHN0YXRlLCBpbnZhbGlkYXRlIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHNldEluZGljZXMgPSAoXHJcbiAgdGlsZW1hcDogVGlsZU1hcCxcclxuICBpbmRpY2VzOiBNYXliZTxudW1iZXI+W10sXHJcbiAgYW5pbWF0ZWQ6IFNldDxudW1iZXI+LFxyXG4gIHg6IG51bWJlciwgeTogbnVtYmVyLCB3OiBudW1iZXIsIGg6IG51bWJlcixcclxuICBlbGFwc2VkOiBudW1iZXIsIGVtcHR5SWQ6IG51bWJlclxyXG4pID0+IHtcclxuICBmb3IgKGxldCBqID0gMDsgaiA8IGg7IGorKykge1xyXG4gICAgY29uc3Qgcm93ID0gaiArIHlcclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHc7IGkrKykge1xyXG4gICAgICBjb25zdCBjb2wgPSBpICsgeFxyXG5cclxuICAgICAgY29uc3QgdmFsSW5kZXggPSBqICogdyArIGlcclxuXHJcbiAgICAgIGlmIChyb3cgPCAwIHx8IHJvdyA+PSB0aWxlbWFwLmhlaWdodCB8fCBjb2wgPCAwIHx8IGNvbCA+PSB0aWxlbWFwLndpZHRoKSB7XHJcbiAgICAgICAgaW5kaWNlc1t2YWxJbmRleF0gPSBlbXB0eUlkXHJcblxyXG4gICAgICAgIGNvbnRpbnVlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHRpbGVJbmRleCA9IHJvdyAqIHRpbGVtYXAud2lkdGggKyBjb2xcclxuICAgICAgY29uc3QgdGlsZSA9IHRpbGVtYXAuZGF0YVt0aWxlSW5kZXhdXHJcblxyXG4gICAgICBsZXQgcmVjdEluZGV4OiBudW1iZXJcclxuXHJcbiAgICAgIGlmICh0eXBlb2YgdGlsZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHJlY3RJbmRleCA9IGFzc3J0KHRpbGUoZWxhcHNlZCksICdFeHBlY3RlZCByZWN0SW5kZXgnKVxyXG4gICAgICAgIGFuaW1hdGVkLmFkZCh2YWxJbmRleClcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZWN0SW5kZXggPSB0aWxlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGluZGljZXNbdmFsSW5kZXhdID0gcmVjdEluZGV4XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgY29uc3QgY2xlYXJJbmRpY2VzRm9yUm93ID0gKFxyXG4gIGluZGljZXM6IE1heWJlPG51bWJlcj5bXSxcclxuICByb3c6IG51bWJlcixcclxuICB3OiBudW1iZXJcclxuKSA9PiB7XHJcbiAgY29uc3Qgcm93U3RhcnQgPSByb3cgKiB3XHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgdzsgaSsrKSB7XHJcbiAgICBjb25zdCB2YWxJbmRleCA9IHJvd1N0YXJ0ICsgaVxyXG5cclxuICAgIGluZGljZXNbdmFsSW5kZXhdID0gbnVsbFxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNsZWFySW5kaWNlc0ZvckNvbCA9IChcclxuICBpbmRpY2VzOiBNYXliZTxudW1iZXI+W10sXHJcbiAgY29sOiBudW1iZXIsXHJcbiAgdzogbnVtYmVyLCBoOiBudW1iZXJcclxuKSA9PiB7XHJcbiAgZm9yIChsZXQgaiA9IDA7IGogPCBoOyBqKyspIHtcclxuICAgIGNvbnN0IHZhbEluZGV4ID0gaiAqIHcgKyBjb2xcclxuXHJcbiAgICBpbmRpY2VzW3ZhbEluZGV4XSA9IG51bGxcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBzY3JvbGxJbmRpY2VzID0gKFxyXG4gIHNyYzogTWF5YmU8bnVtYmVyPltdLFxyXG4gIGRlc3Q6IE1heWJlPG51bWJlcj5bXSxcclxuICB3OiBudW1iZXIsIGg6IG51bWJlcixcclxuICB4OiBudW1iZXIsIHk6IG51bWJlclxyXG4pID0+IHtcclxuICBmb3IgKGxldCBkZXN0WSA9IDA7IGRlc3RZIDwgaDsgZGVzdFkrKykge1xyXG4gICAgY29uc3Qgc3JjWSA9IGRlc3RZICsgeVxyXG5cclxuICAgIGZvciAobGV0IGRlc3RYID0gMDsgZGVzdFggPCB3OyBkZXN0WCsrKSB7XHJcbiAgICAgIGNvbnN0IHNyY1ggPSBkZXN0WCArIHhcclxuXHJcbiAgICAgIGlmIChzcmNZIDwgMCB8fCBzcmNZID49IGggfHwgc3JjWCA8IDAgfHwgc3JjWCA+PSB3KSB7XHJcbiAgICAgICAgZGVzdFtkZXN0WSAqIHcgKyBkZXN0WF0gPSBudWxsXHJcbiAgICAgICAgY29udGludWVcclxuICAgICAgfVxyXG5cclxuICAgICAgZGVzdFtkZXN0WSAqIHcgKyBkZXN0WF0gPSBzcmNbc3JjWSAqIHcgKyBzcmNYXVxyXG4gICAgfVxyXG4gIH1cclxufSJdfQ==