import { assrt } from '../../../lib/util.js';
export const viewState = (width, height, tileW, tileH) => {
    const tileCx = Math.floor(tileW / 2);
    const tileCy = Math.floor(tileH / 2);
    const state = {
        cols: 0,
        rows: 0,
        vLeft: 0,
        vTop: 0,
        colLeft: 0,
        rowTop: 0,
        prevIndices: Array(),
        currIndices: Array()
    };
    const invalidate = (w, h) => {
        width = w;
        height = h;
        const cx = Math.floor(width / 2);
        const cy = Math.floor(height / 2);
        const availW = width - tileW;
        const availH = height - tileH;
        const colsPerSide = Math.ceil(availW / 2 / tileW);
        const rowsPerSide = Math.ceil(availH / 2 / tileH);
        state.cols = colsPerSide * 2 + 1;
        state.rows = rowsPerSide * 2 + 1;
        state.vLeft = cx - colsPerSide * tileW - tileCx;
        state.vTop = cy - rowsPerSide * tileH - tileCy;
        state.prevIndices = Array(state.cols * state.rows);
        state.currIndices = Array(state.cols * state.rows);
        state.colLeft = -colsPerSide;
        state.rowTop = -rowsPerSide;
    };
    invalidate(width, height);
    return { state, invalidate };
};
export const setIndices = (tilemap, indices, x, y, w, h, elapsed, emptyId) => {
    for (let j = 0; j < h; j++) {
        const row = j + y;
        for (let i = 0; i < w; i++) {
            const col = i + x;
            const valIndex = j * w + i;
            if (row < 0 || row >= tilemap.height || col < 0 || col >= tilemap.width) {
                indices[valIndex] = emptyId;
                continue;
            }
            const tileIndex = row * tilemap.width + col;
            const tile = tilemap.data[tileIndex];
            let rectIndex;
            if (typeof tile === 'function') {
                rectIndex = assrt(tile(elapsed), 'Expected rectIndex');
            }
            else {
                rectIndex = tile;
            }
            indices[valIndex] = rectIndex;
        }
    }
};
export const clearIndicesForRow = (indices, row, w) => {
    const rowStart = row * w;
    for (let i = 0; i < w; i++) {
        const valIndex = rowStart + i;
        indices[valIndex] = null;
    }
};
export const clearIndicesForCol = (indices, col, w, h) => {
    for (let j = 0; j < h; j++) {
        const valIndex = j * w + col;
        indices[valIndex] = null;
    }
};
export const scrollIndices = (src, dest, w, h, x, y) => {
    for (let destY = 0; destY < h; destY++) {
        const srcY = destY + y;
        for (let destX = 0; destX < w; destX++) {
            const srcX = destX + x;
            if (srcY < 0 || srcY >= h || srcX < 0 || srcX >= w) {
                dest[destY * w + destX] = null;
                continue;
            }
            dest[destY * w + destX] = src[srcY * w + srcX];
        }
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy1zdGF0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9zY2VuZXMvc2FuZGJveC9yYW5nZXIvdmlldy1zdGF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sc0JBQXNCLENBQUE7QUFHNUMsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLENBQ3ZCLEtBQWEsRUFBRSxNQUFjLEVBQzdCLEtBQWEsRUFBRSxLQUFhLEVBQzVCLEVBQUU7SUFDRixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUNwQyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUVwQyxNQUFNLEtBQUssR0FBYztRQUN2QixJQUFJLEVBQUUsQ0FBQztRQUNQLElBQUksRUFBRSxDQUFDO1FBQ1AsS0FBSyxFQUFFLENBQUM7UUFDUixJQUFJLEVBQUUsQ0FBQztRQUNQLE9BQU8sRUFBRSxDQUFDO1FBQ1YsTUFBTSxFQUFFLENBQUM7UUFDVCxXQUFXLEVBQUUsS0FBSyxFQUFpQjtRQUNuQyxXQUFXLEVBQUUsS0FBSyxFQUFpQjtLQUNwQyxDQUFBO0lBRUQsTUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFTLEVBQUUsQ0FBUyxFQUFFLEVBQUU7UUFDMUMsS0FBSyxHQUFHLENBQUMsQ0FBQTtRQUNULE1BQU0sR0FBRyxDQUFDLENBQUE7UUFFVixNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUNoQyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQTtRQUVqQyxNQUFNLE1BQU0sR0FBRyxLQUFLLEdBQUcsS0FBSyxDQUFBO1FBQzVCLE1BQU0sTUFBTSxH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SSxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUNuRCxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUE7Z0JBQzlCLFNBQVE7WUFDVixDQUFDO1lBRUQsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDaEQsQ0FBQztJQUNILENBQUM7QUFDSCxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNYXliZSB9IGZyb20gJy4uLy4uLy4uL2xpYi90eXBlcy5qcydcbmltcG9ydCB7IGFzc3J0IH0gZnJvbSAnLi4vLi4vLi4vbGliL3V0aWwuanMnXG5pbXBvcnQgeyBUaWxlTWFwLCBWaWV3U3RhdGUgfSBmcm9tICcuL3R5cGVzLmpzJ1xuXG5leHBvcnQgY29uc3Qgdmlld1N0YXRlID0gKFxuICB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcixcbiAgdGlsZVc6IG51bWJlciwgdGlsZUg6IG51bWJlclxuKSA9PiB7XG4gIGNvbnN0IHRpbGVDeCA9IE1hdGguZmxvb3IodGlsZVcgLyAyKVxuICBjb25zdCB0aWxlQ3kgPSBNYXRoLmZsb29yKHRpbGVIIC8gMilcblxuICBjb25zdCBzdGF0ZTogVmlld1N0YXRlID0ge1xuICAgIGNvbHM6IDAsXG4gICAgcm93czogMCxcbiAgICB2TGVmdDogMCxcbiAgICB2VG9wOiAwLFxuICAgIGNvbExlZnQ6IDAsXG4gICAgcm93VG9wOiAwLFxuICAgIHByZXZJbmRpY2VzOiBBcnJheTxNYXliZTxudW1iZXI+PigpLFxuICAgIGN1cnJJbmRpY2VzOiBBcnJheTxNYXliZTxudW1iZXI+PigpXG4gIH1cblxuICBjb25zdCBpbnZhbGlkYXRlID0gKHc6IG51bWJlciwgaDogbnVtYmVyKSA9PiB7XG4gICAgd2lkdGggPSB3XG4gICAgaGVpZ2h0ID0gaFxuXG4gICAgY29uc3QgY3ggPSBNYXRoLmZsb29yKHdpZHRoIC8gMilcbiAgICBjb25zdCBjeSA9IE1hdGguZmxvb3IoaGVpZ2h0IC8gMilcblxuICAgIGNvbnN0IGF2YWlsVyA9IHdpZHRoIC0gdGlsZVdcbiAgICBjb25zdCBhdmFpbEggPSBoZWlnaHQgLSB0aWxlSFxuXG4gICAgY29uc3QgY29sc1BlclNpZGUgPSBNYXRoLmNlaWwoYXZhaWxXIC8gMiAvIHRpbGVXKVxuICAgIGNvbnN0IHJvd3NQZXJTaWRlID0gTWF0aC5jZWlsKGF2YWlsSCAvIDIgLyB0aWxlSClcblxuICAgIHN0YXRlLmNvbHMgPSBjb2xzUGVyU2lkZSAqIDIgKyAxXG4gICAgc3RhdGUucm93cyA9IHJvd3NQZXJTaWRlICogMiArIDFcblxuICAgIHN0YXRlLnZMZWZ0ID0gY3ggLSBjb2xzUGVyU2lkZSAqIHRpbGVXIC0gdGlsZUN4XG4gICAgc3RhdGUudlRvcCA9IGN5IC0gcm93c1BlclNpZGUgKiB0aWxlSCAtIHRpbGVDeVxuXG4gICAgc3RhdGUucHJldkluZGljZXMgPSBBcnJheTxNYXliZTxudW1iZXI+PihzdGF0ZS5jb2xzICogc3RhdGUucm93cylcbiAgICBzdGF0ZS5jdXJySW5kaWNlcyA9IEFycmF5PE1heWJlPG51bWJlcj4+KHN0YXRlLmNvbHMgKiBzdGF0ZS5yb3dzKVxuXG4gICAgc3RhdGUuY29sTGVmdCA9IC1jb2xzUGVyU2lkZVxuICAgIHN0YXRlLnJvd1RvcCA9IC1yb3dzUGVyU2lkZVxuICB9XG5cbiAgaW52YWxpZGF0ZSh3aWR0aCwgaGVpZ2h0KVxuXG4gIHJldHVybiB7IHN0YXRlLCBpbnZhbGlkYXRlIH1cbn1cblxuZXhwb3J0IGNvbnN0IHNldEluZGljZXMgPSAoXG4gIHRpbGVtYXA6IFRpbGVNYXAsXG4gIGluZGljZXM6IE1heWJlPG51bWJlcj5bXSxcbiAgeDogbnVtYmVyLCB5OiBudW1iZXIsIHc6IG51bWJlciwgaDogbnVtYmVyLFxuICBlbGFwc2VkOiBudW1iZXIsIGVtcHR5SWQ6IG51bWJlclxuKSA9PiB7XG4gIGZvciAobGV0IGogPSAwOyBqIDwgaDsgaisrKSB7XG4gICAgY29uc3Qgcm93ID0gaiArIHlcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdzsgaSsrKSB7XG4gICAgICBjb25zdCBjb2wgPSBpICsgeFxuXG4gICAgICBjb25zdCB2YWxJbmRleCA9IGogKiB3ICsgaVxuXG4gICAgICBpZiAocm93IDwgMCB8fCByb3cgPj0gdGlsZW1hcC5oZWlnaHQgfHwgY29sIDwgMCB8fCBjb2wgPj0gdGlsZW1hcC53aWR0aCkge1xuICAgICAgICBpbmRpY2VzW3ZhbEluZGV4XSA9IGVtcHR5SWRcblxuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuXG4gICAgICBjb25zdCB0aWxlSW5kZXggPSByb3cgKiB0aWxlbWFwLndpZHRoICsgY29sXG4gICAgICBjb25zdCB0aWxlID0gdGlsZW1hcC5kYXRhW3RpbGVJbmRleF1cblxuICAgICAgbGV0IHJlY3RJbmRleDogbnVtYmVyXG5cbiAgICAgIGlmICh0eXBlb2YgdGlsZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZWN0SW5kZXggPSBhc3NydCh0aWxlKGVsYXBzZWQpLCAnRXhwZWN0ZWQgcmVjdEluZGV4JylcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlY3RJbmRleCA9IHRpbGVcbiAgICAgIH1cblxuICAgICAgaW5kaWNlc1t2YWxJbmRleF0gPSByZWN0SW5kZXhcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNsZWFySW5kaWNlc0ZvclJvdyA9IChcbiAgaW5kaWNlczogTWF5YmU8bnVtYmVyPltdLFxuICByb3c6IG51bWJlcixcbiAgdzogbnVtYmVyXG4pID0+IHtcbiAgY29uc3Qgcm93U3RhcnQgPSByb3cgKiB3XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB3OyBpKyspIHtcbiAgICBjb25zdCB2YWxJbmRleCA9IHJvd1N0YXJ0ICsgaVxuXG4gICAgaW5kaWNlc1t2YWxJbmRleF0gPSBudWxsXG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IGNsZWFySW5kaWNlc0ZvckNvbCA9IChcbiAgaW5kaWNlczogTWF5YmU8bnVtYmVyPltdLFxuICBjb2w6IG51bWJlcixcbiAgdzogbnVtYmVyLCBoOiBudW1iZXJcbikgPT4ge1xuICBmb3IgKGxldCBqID0gMDsgaiA8IGg7IGorKykge1xuICAgIGNvbnN0IHZhbEluZGV4ID0gaiAqIHcgKyBjb2xcblxuICAgIGluZGljZXNbdmFsSW5kZXhdID0gbnVsbFxuICB9XG59XG5cbmV4cG9ydCBjb25zdCBzY3JvbGxJbmRpY2VzID0gKFxuICBzcmM6IE1heWJlPG51bWJlcj5bXSxcbiAgZGVzdDogTWF5YmU8bnVtYmVyPltdLFxuICB3OiBudW1iZXIsIGg6IG51bWJlcixcbiAgeDogbnVtYmVyLCB5OiBudW1iZXJcbikgPT4ge1xuICBmb3IgKGxldCBkZXN0WSA9IDA7IGRlc3RZIDwgaDsgZGVzdFkrKykge1xuICAgIGNvbnN0IHNyY1kgPSBkZXN0WSArIHlcblxuICAgIGZvciAobGV0IGRlc3RYID0gMDsgZGVzdFggPCB3OyBkZXN0WCsrKSB7XG4gICAgICBjb25zdCBzcmNYID0gZGVzdFggKyB4XG5cbiAgICAgIGlmIChzcmNZIDwgMCB8fCBzcmNZID49IGggfHwgc3JjWCA8IDAgfHwgc3JjWCA+PSB3KSB7XG4gICAgICAgIGRlc3RbZGVzdFkgKiB3ICsgZGVzdFhdID0gbnVsbFxuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuXG4gICAgICBkZXN0W2Rlc3RZICogdyArIGRlc3RYXSA9IHNyY1tzcmNZICogdyArIHNyY1hdXG4gICAgfVxuICB9XG59Il19