export const boxOcts = (box) => {
    const [xmin, ymin, zmin] = box[0];
    const [xmax, ymax, zmax] = box[1];
    // center
    const xcen = (xmin + xmax) / 2;
    const ycen = (ymin + ymax) / 2;
    const zcen = (zmin + zmax) / 2;
    return [
        [[xmin, ymin, zmin], [xcen, ycen, zcen]],
        [[xcen, ymin, zmin], [xmax, ycen, zcen]],
        [[xmin, ycen, zmin], [xcen, ymax, zcen]],
        [[xcen, ycen, zmin], [xmax, ymax, zcen]],
        [[xmin, ymin, zcen], [xcen, ycen, zmax]],
        [[xcen, ymin, zcen], [xmax, ycen, zmax]],
        [[xmin, ycen, zcen], [xcen, ymax, zmax]],
        [[xcen, ycen, zcen], [xmax, ymax, zmax]]
    ];
};
export const createOct = (box) => ({
    children: Array(8),
    aabb: box,
    isLeaf: true,
    solid: false,
    width: Math.abs(box[0][0] - box[1][0])
});
export const octSubdivide = (octant) => {
    const x = boxOcts(octant.aabb);
    for (let i = 0; i < x.length; i++) {
        octant.children[i] = createOct(x[i]);
    }
    octant.isLeaf = false;
    octant.solid = false;
};
export const octInsert = (octant, point, width) => {
    const inside = boxContainsP3(octant.aabb, point);
    const tooBig = octant.width > width;
    if (inside && tooBig) {
        if (octant.isLeaf) {
            octSubdivide(octant);
        }
        for (let i = 0; i < octant.children.length; i++) {
            octInsert(octant.children[i], point, width);
        }
    }
    else if (inside && !tooBig) {
        octant.solid = true;
    }
};
export const octIntersects = (root, isInter) => {
    const stack = [root];
    while (stack.length) {
        const octant = stack.pop();
        if (!isInter(octant.aabb))
            continue;
        if (octant.isLeaf) {
            if (octant.solid)
                return true;
        }
        else {
            for (let i = 0; i < octant.children.length; i++) {
                const child = octant.children[i];
                if (child.isLeaf && !child.solid)
                    continue;
                stack.push(child);
            }
        }
    }
    return false;
};
export const boxContainsP3 = (box, p3) => ((p3[0] >= box[0][0] && p3[0] <= box[1][0]) &&
    (p3[1] >= box[0][1] && p3[1] <= box[1][1]) &&
    (p3[2] >= box[0][2] && p3[2] <= box[1][2]));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2N0cmVlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3NhbmRib3gvb2N0cmVlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE1BQU0sQ0FBQyxNQUFNLE9BQU8sR0FBRyxDQUFDLEdBQVcsRUFBYyxFQUFFO0lBQ2pELE1BQU0sQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNqQyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFFakMsU0FBUztJQUNULE1BQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtJQUM5QixNQUFNLElBQUksR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7SUFDOUIsTUFBTSxJQUFJLEdBQUcsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBRTlCLE9BQU87UUFDTCxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3hDLENBQUMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFeEMsQ0FBQyxD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QUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQzNDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUMiwgVDMsIFQ4IH0gZnJvbSAnLi4vbGliL3R5cGVzLmpzJ1xyXG5cclxuZXhwb3J0IGNvbnN0IGJveE9jdHMgPSAoYm94OiBUMjxUMz4pOiBUODxUMjxUMz4+ID0+IHtcclxuICBjb25zdCBbeG1pbiwgeW1pbiwgem1pbl0gPSBib3hbMF1cclxuICBjb25zdCBbeG1heCwgeW1heCwgem1heF0gPSBib3hbMV1cclxuXHJcbiAgLy8gY2VudGVyXHJcbiAgY29uc3QgeGNlbiA9ICh4bWluICsgeG1heCkgLyAyXHJcbiAgY29uc3QgeWNlbiA9ICh5bWluICsgeW1heCkgLyAyXHJcbiAgY29uc3QgemNlbiA9ICh6bWluICsgem1heCkgLyAyXHJcblxyXG4gIHJldHVybiBbXHJcbiAgICBbW3htaW4sIHltaW4sIHptaW5dLCBbeGNlbiwgeWNlbiwgemNlbl1dLFxyXG4gICAgW1t4Y2VuLCB5bWluLCB6bWluXSwgW3htYXgsIHljZW4sIHpjZW5dXSxcclxuICAgIFtbeG1pbiwgeWNlbiwgem1pbl0sIFt4Y2VuLCB5bWF4LCB6Y2VuXV0sXHJcbiAgICBbW3hjZW4sIHljZW4sIHptaW5dLCBbeG1heCwgeW1heCwgemNlbl1dLFxyXG5cclxuICAgIFtbeG1pbiwgeW1pbiwgemNlbl0sIFt4Y2VuLCB5Y2VuLCB6bWF4XV0sXHJcbiAgICBbW3hjZW4sIHltaW4sIHpjZW5dLCBbeG1heCwgeWNlbiwgem1heF1dLFxyXG4gICAgW1t4bWluLCB5Y2VuLCB6Y2VuXSwgW3hjZW4sIHltYXgsIHptYXhdXSxcclxuICAgIFtbeGNlbiwgeWNlbiwgemNlbl0sIFt4bWF4LCB5bWF4LCB6bWF4XV1cclxuICBdXHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIE9jdGFudCA9IHtcclxuICBjaGlsZHJlbjogVDg8T2N0YW50PlxyXG4gIGFhYmI6IFQyPFQzPlxyXG4gIGlzTGVhZjogYm9vbGVhblxyXG4gIHNvbGlkOiBib29sZWFuXHJcbiAgd2lkdGg6IG51bWJlciAvLyBhbHdheXMgY3ViaWNcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGNyZWF0ZU9jdCA9IChib3g6IFQyPFQzPik6IE9jdGFudCA9PiAoe1xyXG4gIGNoaWxkcmVuOiBBcnJheSg4KSBhcyBUODxPY3RhbnQ+LFxyXG4gIGFhYmI6IGJveCxcclxuICBpc0xlYWY6IHRydWUsXHJcbiAgc29saWQ6IGZhbHNlLFxyXG4gIHdpZHRoOiBNYXRoLmFicyhib3hbMF1bMF0gLSBib3hbMV1bMF0pXHJcbn0pXHJcblxyXG5leHBvcnQgY29uc3Qgb2N0U3ViZGl2aWRlID0gKG9jdGFudDogT2N0YW50KSA9PiB7XHJcbiAgY29uc3QgeCA9IGJveE9jdHMob2N0YW50LmFhYmIpXHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgeC5sZW5ndGg7IGkrKykge1xyXG4gICAgb2N0YW50LmNoaWxkcmVuW2ldID0gY3JlYXRlT2N0KHhbaV0pXHJcbiAgfVxyXG5cclxuICBvY3RhbnQuaXNMZWFmID0gZmFsc2VcclxuICBvY3RhbnQuc29saWQgPSBmYWxzZVxyXG59XHJcblxyXG5leHBvcnQgY29uc3Qgb2N0SW5zZXJ0ID0gKG9jdGFudDogT2N0YW50LCBwb2ludDogVDMsIHdpZHRoOiBudW1iZXIpID0+IHtcclxuICBjb25zdCBpbnNpZGUgPSBib3hDb250YWluc1AzKG9jdGFudC5hYWJiLCBwb2ludClcclxuICBjb25zdCB0b29CaWcgPSBvY3RhbnQud2lkdGggPiB3aWR0aFxyXG5cclxuICBpZiAoaW5zaWRlICYmIHRvb0JpZykge1xyXG4gICAgaWYgKG9jdGFudC5pc0xlYWYpIHtcclxuICAgICAgb2N0U3ViZGl2aWRlKG9jdGFudClcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9jdGFudC5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xyXG4gICAgICBvY3RJbnNlcnQob2N0YW50LmNoaWxkcmVuW2ldLCBwb2ludCwgd2lkdGgpXHJcbiAgICB9XHJcbiAgfVxyXG4gIGVsc2UgaWYgKGluc2lkZSAmJiAhdG9vQmlnKSB7XHJcbiAgICBvY3RhbnQuc29saWQgPSB0cnVlXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgdHlwZSBPY3RJbnRlcnNlY3RzID0gKGJveDogVDI8VDM+KSA9PiBib29sZWFuXHJcblxyXG5leHBvcnQgY29uc3Qgb2N0SW50ZXJzZWN0cyA9IChcclxuICByb290OiBPY3RhbnQsIGlzSW50ZXI6IE9jdEludGVyc2VjdHNcclxuKSA9PiB7XHJcbiAgY29uc3Qgc3RhY2sgPSBbcm9vdF1cclxuXHJcbiAgd2hpbGUgKHN0YWNrLmxlbmd0aCkge1xyXG4gICAgY29uc3Qgb2N0YW50ID0gc3RhY2sucG9wKCkhXHJcblxyXG4gICAgaWYgKCFpc0ludGVyKG9jdGFudC5hYWJiKSkgY29udGludWVcclxuXHJcbiAgICBpZiAob2N0YW50LmlzTGVhZikge1xyXG4gICAgICBpZiAob2N0YW50LnNvbGlkKSByZXR1cm4gdHJ1ZVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvY3RhbnQuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBjb25zdCBjaGlsZCA9IG9jdGFudC5jaGlsZHJlbltpXVxyXG5cclxuICAgICAgICBpZiAoY2hpbGQuaXNMZWFmICYmICFjaGlsZC5zb2xpZCkgY29udGludWVcclxuXHJcbiAgICAgICAgc3RhY2sucHVzaChjaGlsZClcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGZhbHNlXHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBib3hDb250YWluc1AzID0gKGJveDogVDI8VDM+LCBwMzogVDMpID0+IChcclxuICAocDNbMF0gPj0gYm94WzBdWzBdICYmIHAzWzBdIDw9IGJveFsxXVswXSkgJiZcclxuICAocDNbMV0gPj0gYm94WzBdWzFdICYmIHAzWzFdIDw9IGJveFsxXVsxXSkgJiZcclxuICAocDNbMl0gPj0gYm94WzBdWzJdICYmIHAzWzJdIDw9IGJveFsxXVsyXSlcclxuKVxyXG4iXX0=